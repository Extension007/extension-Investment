<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ê–¥–º–∏–Ω–∫–∞ ‚Äî –ö–∞—Ç–∞–ª–æ–≥ —É—Å–ª—É–≥</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
  <meta name="csrf-token" content="<%= csrfToken %>">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/styles.css">
  <style>
    .catalog-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    .catalog-item {
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 15px;
      background: #fff;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .item-status {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 0.85rem;
      font-weight: 500;
      margin-bottom: 10px;
    }
    .status-published, .status-approved {
      background: #4caf50;
      color: #fff;
    }
    .status-blocked, .status-rejected {
      background: #f44336;
      color: #fff;
    }
    .status-draft, .status-pending {
      background: #ff9800;
      color: #fff;
    }
    .item-title {
      margin: 10px 0;
      font-size: 1.2rem;
      font-weight: 600;
    }
    .item-description {
      margin: 10px 0;
      color: #666;
      font-size: 0.9rem;
    }
    .item-images {
      margin: 10px 0;
    }
    .item-images img {
      width: 100%;
      max-width: 200px;
      height: auto;
      border-radius: 4px;
      margin-right: 5px;
      margin-bottom: 5px;
    }
    .item-link {
      color: #2196f3;
      text-decoration: none;
    }
    .item-link:hover {
      text-decoration: underline;
    }
    .item-meta {
      margin: 10px 0;
      color: #666;
      font-size: 0.9rem;
    }
    .item-price {
      margin: 10px 0;
      font-weight: 600;
      color: #333;
    }
    .item-rating {
      margin: 10px 0;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .item-rating button {
      background: #4caf50;
      color: #fff;
      border: none;
      padding: 5px 10px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.9rem;
    }
    .item-rating .dislike-btn {
      background: #f44336;
    }
    .item-rating button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    .item-actions {
      margin-top: 15px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    .item-actions button {
      padding: 8px 16px;
      border-radius: 4px;
      border: none;
      cursor: pointer;
      font-size: 0.9rem;
      transition: background 0.2s;
    }
    .btn-block {
      background: #f44336;
      color: #fff;
    }
    .btn-publish {
      background: #4caf50;
      color: #fff;
    }
    .btn-edit {
      background: #2196f3;
      color: #fff;
    }
    .btn-delete {
      background: #f44336;
      color: #fff;
    }
    .btn-outline {
      background: transparent;
      border: 1px solid #ddd;
      color: #333;
    }
    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: #666;
    }
    .back-link {
      display: inline-block;
      margin-bottom: 20px;
      color: #2196f3;
      text-decoration: none;
    }
    .back-link:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <header class="main-header">
    <div class="container header-inner">
      <a class="logo" href="/">EXTO</a>
      <nav class="nav" style="display:none;">
        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è —Å–∫—Ä—ã—Ç–∞ -->
      </nav>
      <div class="header-actions">
        <span class="user-chip">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</span>
        <form id="logoutForm" method="POST" action="/logout" style="display:inline;margin-left:10px;">
          <button type="submit" class="btn outline small">–í—ã—Ö–æ–¥</button>
        </form>
      </div>
    </div>
  </header>

  <main class="container">
    <a href="/admin" class="back-link">‚Üê –ù–∞–∑–∞–¥ –∫ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏</a>
    
    <section class="section">
      <h2>–ö–∞—Ç–∞–ª–æ–≥ —É—Å–ª—É–≥</h2>
      <p style="margin-bottom: 15px; color: #666;">–í—Å–µ–≥–æ: <%= services ? services.length : 0 %></p>
      
      <% if (services && services.length > 0) { %>
        <div class="catalog-grid">
          <% services.forEach(service => { %>
            <%- include('partials/card', { service, itemType: 'service', mode: 'admin' }) %>
          <% }) %>
        </div>
      <% } else { %>
        <div class="empty-state">
          <p>–£—Å–ª—É–≥–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
        </div>
      <% } %>
              <div>
                <% if (service.status === 'approved' || service.status === 'published') { %>
                  <span class="item-status status-published">‚úÖ –û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ</span>
                <% } else if (service.status === 'rejected' || service.status === 'blocked') { %>
                  <span class="item-status status-blocked">üö´ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ</span>
                <% } else { %>
                  <span class="item-status status-pending">‚è≥ –ù–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏</span>
                <% } %>
              </div>
              
              <h3 class="item-title"><%= service.name || `–£—Å–ª—É–≥–∞ ${service._id.toString().substring(0, 8)}` %></h3>
              
              <% if (service.description) { %>
                <p class="item-description"><%= service.description.length > 100 ? service.description.substring(0, 100) + '...' : service.description %></p>
              <% } %>
              
              <!-- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è -->
              <% if (service.images && service.images.length > 0) { %>
                <div class="item-images">
                  <% service.images.slice(0, 3).forEach((img, idx) => { %>
                    <img src="<%= img %>" alt="<%= service.name %>">
                  <% }) %>
                  <% if (service.images.length > 3) { %>
                    <span style="color: #666; font-size: 0.85rem;">+<%= service.images.length - 3 %> –µ—â–µ</span>
                  <% } %>
                </div>
              <% } else if (service.image_url) { %>
                <div class="item-images">
                  <img src="<%= service.image_url %>" alt="<%= service.name %>">
                </div>
              <% } %>
              
              <% if (service.link) { %>
                <p class="item-meta">–°—Å—ã–ª–∫–∞: <a href="<%= service.link %>" target="_blank" rel="noopener" class="item-link"><%= service.link.length > 30 ? service.link.substring(0, 30) + '...' : service.link %></a></p>
              <% } %>
              
              <% if (service.video_url) { %>
                <p class="item-meta">–í–∏–¥–µ–æ: <a href="<%= service.video_url %>" target="_blank" rel="noopener">‚ñ∂Ô∏è <%= service.video_url.length > 30 ? service.video_url.substring(0, 30) + '...' : service.video_url %></a></p>
              <% } %>
              
              <p class="item-meta">–í–ª–∞–¥–µ–ª–µ—Ü: <%= service.owner && service.owner.username ? service.owner.username : 'Admin' %></p>
              
              <% if (service.category) { %>
                <p class="item-meta">–ö–∞—Ç–µ–≥–æ—Ä–∏—è: <%= service.category %></p>
              <% } %>
              
              <% if (service.price && service.price > 0) { %>
                <p class="item-price">–¶–µ–Ω–∞: <%= service.price %> ‚Ç∏</p>
              <% } %>
              
              <!-- –†–µ–π—Ç–∏–Ω–≥ -->
              <div class="item-rating service-rating" data-id="<%= service._id %>" data-type="service">
                <button class="service-like-btn" type="button" aria-label="–õ–∞–π–∫">‚ñ≤</button>
                <span class="service-result" style="font-weight: 600;">
                  <% const likes = service.likes || 0; %>
                  <% const dislikes = service.dislikes || 0; %>
                  <%= likes - dislikes %>
                </span>
                <button class="service-dislike-btn" type="button" aria-label="–î–∏–∑–ª–∞–π–∫">‚ñº</button>
                <span class="service-votes" style="color: #666; font-size: 0.85rem;">
                  (<%= likes + dislikes %> –≥–æ–ª–æ—Å–æ–≤)
                </span>
              </div>
              
              <div class="item-actions">
                <% if (service.status === 'approved' || service.status === 'published') { %>
                  <button class="block-service-btn btn-block" data-id="<%= service._id %>">üö´ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å</button>
                <% } else { %>
                  <button class="publish-service-btn btn-publish" data-id="<%= service._id %>">‚úÖ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
                <% } %>
                <button class="edit-service-btn btn-edit btn-outline" data-id="<%= service._id %>">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                <button class="delete-service-btn btn-delete" data-id="<%= service._id %>">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
              </div>
            </div>
          <% }) %>
        </div>
      <% } else { %>
        <div class="empty-state">
          <p>–£—Å–ª—É–≥–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
        </div>
      <% } %>
    </section>
  </main>

  <footer class="footer">
    <p>¬© 2025 EXTO Ecosystem</p>
  </footer>

  <script src="/js/admin-catalog.js"></script>
</body>
</html>



