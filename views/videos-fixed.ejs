<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–í–∏–¥–µ–æ ‚Äî Albamount</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
  <meta name="csrf-token" content="<%= typeof csrfToken !== 'undefined' ? csrfToken : '' %>">
  <link rel="icon" href="/favicon.ico" type="image/x-icon">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/styles.css?v=1.0.1">
  <link rel="stylesheet" href="/header-tabs.css?v=1.0.1">
</head>
<body>
    <div id="bg-animated" aria-hidden="true"></div>
    <!-- –û–¥–Ω–æ—ç—Ç–∞–∂–Ω—ã–π header –±–µ–∑ –≤–∫–ª–∞–¥–æ–∫ -->
    <header class="main-header">
      <div class="container header-inner">
        <a class="logo" href="/"><img src="/albamount.png" alt="ALBAMOUNT" class="logo-img"></a>
        <div class="header-actions">
          <% if (isAuth) { %>
            <% if (isAdmin) { %>
              <a class="btn outline" href="/admin">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</a>
            <% } else { %>
              <a class="btn outline" href="/cabinet">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</a>
            <% } %>
          <% } else { %>
            <a class="btn outline" href="/user/login">–í—Ö–æ–¥</a>
            <button id="openRegister" type="button" class="btn outline">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
          <% } %>
        </div>
      </div>
    </header>

    <main>
      <section id="videos" class="section">
        <div class="section-header">
          <h2>–ö–∞—Ç–∞–ª–æ–≥ –≤–∏–¥–µ–æ</h2>
          <%
            const isAuthValue = typeof isAuth !== 'undefined' ? isAuth : false;
            const isEmailVerifiedValue = typeof isEmailVerified !== 'undefined' ? isEmailVerified : false;
            
            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤–æ–∑–º–æ–∂–Ω—ã–µ —Å—Ç—Ä–æ–∫–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ –±—É–ª–µ–≤—ã–µ
            const isAuthBool = (isAuthValue === true || isAuthValue === 'true' || isAuthValue === 1 || isAuthValue === '1');
            const isEmailVerifiedBool = (isEmailVerifiedValue === true || isEmailVerifiedValue === 'true' || isEmailVerifiedValue === 1 || isEmailVerifiedValue === '1');
          %>
          <% if (isAuthBool) { %>
            <% if (isEmailVerifiedBool) { %>
              <div class="video-actions">
                <button id="addVideoBtn" class="btn primary">–î–æ–±–∞–≤–∏—Ç—å –≤–∏–¥–µ–æ</button>
              </div>
            <% } else { %>
              <div class="video-actions">
                <button class="btn primary disabled" title="–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –≤–∞—à email, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–ª—è—Ç—å –≤–∏–¥–µ–æ">–î–æ–±–∞–≤–∏—Ç—å –≤–∏–¥–µ–æ</button>
              </div>
            <% } %>
          <% } else { %>
            <div class="video-actions">
              <button id="addVideoBtnUnauth" class="btn primary" onclick="openRegister()">–î–æ–±–∞–≤–∏—Ç—å –≤–∏–¥–µ–æ</button>
            </div>
          <% } %>
        </div>

        <div class="video-grid">
          <% if (videos && videos.length > 0) { %>
            <% videos.forEach(function(video) { %>
              <div class="video-card">
                <div class="video-card-header">
                  <h3 class="video-title"><%= video.title %></h3>
                  <p class="video-author">–ê–≤—Ç–æ—Ä: <%= video.nickname %></p>
                </div>

                <div class="video-container">
                  <button class="btn small video-btn" data-video="<%= video.videoUrl %>" type="button">
                    ‚ñ∂Ô∏è <%= video.videoUrl.length > 30 ? video.videoUrl.substring(0, 30) + '...' : video.videoUrl %>
                  </button>
                </div>

                <% if (video.description) { %>
                  <div class="video-description">
                    <p><%= video.description %></p>
                  </div>
                <% } %>

                <% if (video.genres && video.genres.length > 0) { %>
                  <div class="video-genres">
                    <span class="genre-label">–ñ–∞–Ω—Ä—ã:</span>
                    <span class="genre-tags"><%= video.genres.join(', ') %></span>
                  </div>
                <% } %>

                <div class="video-footer">
                  <div class="video-rating">
                    <button class="btn btn-sm btn-outline-success vote-btn" data-video-id="<%= video._id %>" data-vote="up">üëç <%= video.rating_up %></button>
                    <button class="btn btn-sm btn-outline-danger vote-btn" data-video-id="<%= video._id %>" data-vote="down">üëé <%= video.rating_down %></button>
                  </div>
                  <div class="video-date">
                    <small class="text-muted">–î–æ–±–∞–≤–ª–µ–Ω–æ: <%= new Date(video.createdAt).toLocaleDateString() %></small>
                  </div>
                </div>
              </div>
            <% }); %>
          <% } else { %>
            <p class="empty-state">–ü–æ–∫–∞ –Ω–µ—Ç –≤–∏–¥–µ–æ. –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º!</p>
          <% } %>
        </div>
      </section>
    </main>

    <!-- Footer —Å –≤–∫–ª–∞–¥–∫–∞–º–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ -->
    <footer class="mobile-tabs-footer">
      <div class="mobile-tabs-container">
        <a href="/products" class="mobile-tab-button <%= typeof activeTab !== 'undefined' && activeTab === 'products' ? 'active' : '' %>">
          –¢–æ–≤–∞—Ä—ã
        </a>
        <a href="/services" class="mobile-tab-button <%= typeof activeTab !== 'undefined' && activeTab === 'services' ? 'active' : '' %>">
          –£—Å–ª—É–≥–∏
        </a>
        <a href="/ad" class="mobile-tab-button <%= typeof activeTab !== 'undefined' && activeTab === 'ad' ? 'active' : '' %>">
          –†–µ–∫–ª–∞–º–∞
        </a>
        <a href="/about" class="mobile-tab-button <%= typeof activeTab !== 'undefined' && activeTab === 'about' ? 'active' : '' %>">
          –û –ù–∞—Å
        </a>
        <a href="/contacts" class="mobile-tab-button <%= typeof activeTab !== 'undefined' && activeTab === 'contacts' ? 'active' : '' %>">
          –ö–æ–Ω—Ç–∞–∫—Ç—ã
        </a>
        <a href="/videos" class="mobile-tab-button active">
          –í–∏–¥–µ–æ
        </a>
      </div>
    </footer>

    <!-- FIX: –ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π overlay –¥–ª—è YouTube –≤–∏–¥–µ–æ -->
    <div id="videoOverlay" class="video-overlay" aria-hidden="true" style="display:none;">
      <div class="video-overlay-container">
        <button class="video-overlay-close" data-close-video aria-label="–ó–∞–∫—Ä—ã—Ç—å –≤–∏–¥–µ–æ">&times;</button>
        <div class="video-overlay-iframe-container" id="videoIframeContainer">
          <!-- FIX: iframe —Å–æ–∑–¥–∞–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –ø–æ –∫–ª–∏–∫—É -->
        </div>
      </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
    <%- include('partials/register-modal') %>

    <!-- –ó–∞–≥—Ä—É–∑–∫–∞ YouTube IFrame API -->
    <script>
      var tag = document.createElement('script');
      tag.src = "https://www.youtube.com/iframe_api";
      var firstScriptTag = document.getElementsByTagName('script')[0];
      firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
    </script>

    <!-- FIX: –ü–æ–¥–∫–ª—é—á–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç (–≤–∫–ª—é—á–∞–µ—Ç –≤–µ—Å—å JS: youtube init, –º–æ–¥–∞–ª–∫–∏, —Ä–µ–π—Ç–∏–Ω–≥, –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è) -->
    <script src="/script.js?v=1.0.1"></script>

    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —Ñ—É—Ç–µ—Ä–æ–º -->
    <script src="/fix-footer-overlap.js?v=1.0.1"></script>

    <style>
      /* –°—Ç–∏–ª–∏ –¥–ª—è –≤–∏–¥–µ–æ-–∫–∞—Ç–∞–ª–æ–≥–∞ –≤ –æ–±—â–µ–º —Å—Ç–∏–ª–µ –ø—Ä–æ–µ–∫—Ç–∞ */
      .video-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 20px;
        margin-top: 20px;
      }

      .video-card {
        background: rgba(255, 51, 51, 0.05);
        border: 1px solid rgba(255, 51, 51, 0.2);
        border-radius: 12px;
        padding: 15px;
        transition: all 0.3s ease;
        color: #ddd;
      }

      .video-card:hover {
        background: rgba(255, 51, 51, 0.1);
        transform: translateY(-2px);
      }

      .video-card-header {
        margin-bottom: 10px;
        border-bottom: 1px solid rgba(255, 51, 51, 0.1);
        padding-bottom: 10px;
      }

      .video-title {
        color: #ff9999;
        margin: 0 0 5px 0;
        font-size: 1.1rem;
        font-weight: 600;
      }

      .video-author {
        color: #ccc;
        margin: 0;
        font-size: 0.9rem;
      }

      .video-container {
        margin: 15px 0;
        border-radius: 8px;
        overflow: hidden;
      }

      .video-container iframe {
        background: #000;
        border-radius: 8px;
      }
      
      .video-thumbnail-container {
        position: relative;
        overflow: hidden;
        border-radius: 8px;
        cursor: pointer;
      }
      
      .video-poster {
        width: 100%;
        display: block;
        border-radius: 8px;
      }
      
      .play-button {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 10;
        background: rgba(0, 0, 0, 0.7);
        border-radius: 50%;
        width: 50px;
        height: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        color: white;
        border: none;
        cursor: pointer;
      }

      .video-description {
        color: #ccc;
        font-size: 0.9rem;
        line-height: 1.5;
        margin: 10px 0;
        padding: 10px;
        background: rgba(0, 0, 0, 0.2);
        border-radius: 6px;
      }

      .video-genres {
        margin: 10px 0;
        font-size: 0.85rem;
      }

      .genre-label {
        color: #ff9999;
        font-weight: 500;
      }

      .genre-tags {
        color: #ccc;
      }

      .video-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 15px;
        padding-top: 10px;
        border-top: 1px solid rgba(255, 51, 51, 0.1);
      }

      .video-rating {
        display: flex;
        gap: 8px;
      }

      .video-date {
        color: #999;
        font-size: 0.8rem;
      }

      .video-actions {
        margin-top: 15px;
      }

      /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
      @media (max-width: 768px) {
        .video-grid {
          grid-template-columns: 1fr;
        }

        .video-actions {
          margin-bottom: 20px;
        }
      }
    </style>

    <script>
        document.querySelectorAll('.vote-btn').forEach(btn => {
            btn.addEventListener('click', async function() {
                const videoId = this.getAttribute('data-video-id');
                const vote = this.getAttribute('data-vote');

                try {
                    const response = await fetch(`/api/videos/${videoId}/vote`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Accept': 'application/json'
                        },
                        body: JSON.stringify({ vote })
                    });

                    const result = await response.json();
                    if (result.success) {
                        // Update UI
                        const upBtn = this.parentElement.querySelector('[data-vote="up"]');
                        const downBtn = this.parentElement.querySelector('[data-vote="down"]');
                        upBtn.textContent = `üëç ${result.video.rating_up}`;
                        downBtn.textContent = `üëé ${result.video.rating_down}`;

                        // Disable buttons after voting
                        upBtn.disabled = true;
                        downBtn.disabled = true;
                    } else {
                        alert(result.message || '–û—à–∏–±–∫–∞ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è');
                    }
                } catch (error) {
                    alert('–û—à–∏–±–∫–∞ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è');
                }
            });
        });
    </script>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤–∏–¥–µ–æ -->
    <div id="addVideoModal" class="modal" aria-hidden="true" style="display: none;">
      <div class="modal-content" role="dialog" aria-modal="true" aria-label="–î–æ–±–∞–≤–∏—Ç—å –≤–∏–¥–µ–æ">
        <button class="close" data-close-add-video aria-label="–ó–∞–∫—Ä—ã—Ç—å">&times;</button>
        <h3>–î–æ–±–∞–≤–∏—Ç—å –≤–∏–¥–µ–æ</h3>
        
        <form id="videoForm" class="needs-validation" novalidate>
          <div class="mb-3">
            <label for="videoUrl" class="form-label">–°—Å—ã–ª–∫–∞ –Ω–∞ –≤–∏–¥–µ–æ *</label>
            <input type="url" class="form-control" id="videoUrl" name="videoUrl" required>
            <div class="invalid-feedback">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ –≤–∏–¥–µ–æ</div>
            <small class="form-text text-muted">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è YouTube, Vimeo –∏ –¥—Ä—É–≥–∏–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã</small>
          </div>

          <div class="mb-3" id="nicknameField" style="display:none;">
            <label for="nickname" class="form-label">–û—Ç–æ–±—Ä–∞–∂–∞–µ–º—ã–π –Ω–∏–∫–Ω–µ–π–º</label>
            <input type="text" class="form-control" id="nickname" name="nickname" placeholder="–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º, —á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–∞—à –Ω–∏–∫–Ω–µ–π–º">
            <small class="form-text text-muted">–≠—Ç–æ—Ç –Ω–∏–∫–Ω–µ–π–º –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è –≤—Å–µ—Ö –≤–∞—à–∏—Ö –≤–∏–¥–µ–æ</small>
          </div>

          <div class="mb-3">
            <label for="title" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ *</label>
            <input type="text" class="form-control" id="title" name="title" required>
            <div class="invalid-feedback">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≤–∏–¥–µ–æ</div>
          </div>

          <div class="mb-3">
            <label for="description" class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
            <textarea class="form-control" id="description" name="description" rows="3"></textarea>
          </div>

          <div class="mb-3">
            <label for="genres" class="form-label">–ñ–∞–Ω—Ä—ã (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)</label>
            <input type="text" class="form-control" id="genres" name="genres" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: –º—É–∑—ã–∫–∞, —Å–ø–æ—Ä—Ç, –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ">
          </div>

          <div id="videoSubmitError" class="error" style="color:#b00020;margin-top:10px;display:none;"></div>
          <div id="videoSubmitSuccess" style="color:green;margin-top:10px;display:none;"></div>
          
          <div class="btn-container">
            <button type="submit" class="btn btn-primary">–î–æ–±–∞–≤–∏—Ç—å –≤–∏–¥–µ–æ</button>
            <button type="button" class="btn btn-secondary" data-close-add-video>–û—Ç–º–µ–Ω–∞</button>
          </div>
        </form>
      </div>
    </div>

    <style>
      /* –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤–∏–¥–µ–æ */
      #addVideoModal .modal-content {
        background: #111;
        border-radius: 12px;
        box-shadow: 0 0 20px #ff3333;
        max-width: 600px;
        width: 90%;
        margin: 5% auto;
        padding: 25px;
        position: relative;
        max-height: 90vh;
        overflow-y: auto;
      }
      
      #addVideoModal .close {
        color: #fff;
        font-size: 28px;
        cursor: pointer;
        background: transparent;
        border: none;
        position: absolute;
        top: 10px;
        right: 14px;
        z-index: 10;
      }
      
      #addVideoModal .close:hover {
        color: #ff3333;
      }
      
      #addVideoModal h3 {
        color: #ff9999;
        margin-bottom: 20px;
        text-align: center;
      }
      
      #addVideoModal .form-label {
        color: #ff9999;
        font-weight: 600;
        margin-bottom: 8px;
        display: block;
      }
      
      #addVideoModal .form-control {
        background: #2a2a2a;
        border: 1px solid rgba(255, 51, 51, 0.3);
        border-radius: 8px;
        color: #fff;
        padding: 12px;
        width: 100%;
        font-family: 'Poppins', Arial, sans-serif;
        font-size: 0.95rem;
        box-sizing: border-box;
      }
      
      #addVideoModal .form-control:focus {
        outline: none;
        border-color: #ff3333;
        box-shadow: 0 0 8px rgba(255, 51, 51, 0.3);
      }
      
      #addVideoModal .form-text {
        color: #999;
        font-size: 0.85rem;
        margin-top: 5px;
        display: block;
      }
      
      #addVideoModal textarea.form-control {
        min-height: 100px;
        resize: vertical;
      }
      
      #addVideoModal .btn {
        /* –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—â–∏–µ —Å—Ç–∏–ª–∏ –∫–Ω–æ–ø–æ–∫ –ø—Ä–æ–µ–∫—Ç–∞ */
        background:
          linear-gradient(#3a0e0e, #3a0e0e) padding-box,
          linear-gradient(45deg, var(--color-accent-strong), #ff4d4d) border-box;
        color: var(--color-text);
        border: 2px solid transparent;
        padding: 8px 14px;
        border-radius: var(--radius-md);
        cursor: pointer;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
        height: 36px;
        line-height: 1;
        box-shadow: var(--shadow-accent);
        transition: box-shadow .2s ease, transform .15s ease, filter .2s ease, background .2s ease;
        min-width: 100px;
        font-size: 0.9rem;
      }
      
      #addVideoModal .btn:hover {
        box-shadow: 0 0 14px rgba(255, 0, 0, 0.55), 0 0 28px rgba(255, 0, 0, 0.28);
        transform: translateY(-1px);
        filter: brightness(1.03);
      }
      
      #addVideoModal .btn-primary {
        background:
          linear-gradient(#3a0e0e, #3a0e0e) padding-box,
          linear-gradient(45deg, var(--color-accent-strong), #ff4d4d) border-box;
      }
      
      #addVideoModal .btn-secondary {
        background:
          linear-gradient(#2e0b0b, #2e0b0b) padding-box,
          linear-gradient(45deg, var(--color-accent-strong), #ff4d4d) border-box;
      }
      
      #addVideoModal .invalid-feedback {
        color: #b00020;
        display: block;
        margin-top: 5px;
      }
      
      #addVideoModal .error {
        padding: 12px;
        border-radius: 8px;
        text-align: center;
        font-size: 0.9rem;
        background: rgba(176, 0, 32, 0.1);
        border: 1px solid rgba(176, 0, 32, 0.3);
      }
      
      #addVideoModal .mb-3 {
        margin-bottom: 16px;
      }
      
      #addVideoModal .form-group {
        margin-bottom: 16px;
      }
      
      /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
      @media (max-width: 768px) {
        #addVideoModal .modal-content {
          width: 95%;
          margin: 5% auto 2% auto;
          padding: 20px 15px;
          max-height: 95vh;
        }
        
        #addVideoModal .close {
          top: 5px;
          right: 10px;
          font-size: 24px;
        }
        
        #addVideoModal h3 {
          font-size: 1.2rem;
          margin-bottom: 15px;
        }
        
        #addVideoModal .form-control {
          padding: 10px;
          font-size: 0.9rem;
        }
        
        #addVideoModal textarea.form-control {
          min-height: 80px;
        }
        
        #addVideoModal .btn {
          padding: 8px 12px;
          font-size: 0.85rem;
          height: 34px;
          min-width: 80px;
          margin: 2px;
        }
        
        #addVideoModal .form-label {
          font-size: 0.9rem;
          margin-bottom: 6px;
        }
        
        #addVideoModal .form-text {
          font-size: 0.75rem;
        }
        
        #addVideoModal .invalid-feedback {
          font-size: 0.75rem;
        }
      }
      
      @media (max-width: 480px) {
        #addVideoModal .modal-content {
          width: 98%;
          margin: 2% auto 2% auto;
          padding: 15px 10px;
        }
        
        #addVideoModal .btn {
          width: 100%;
          margin: 5px 0;
        }
        
        #addVideoModal .btn-container {
          display: flex;
          flex-direction: column;
          gap: 8px;
        }
      }
    </style>

    <script>
      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤–∏–¥–µ–æ
      document.addEventListener('DOMContentLoaded', function() {
        const addVideoBtn = document.getElementById('addVideoBtn');
        if (addVideoBtn) {
          addVideoBtn.addEventListener('click', function() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –≤ AppBootstrap
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–Ω–∞—á–∞–ª–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –≤ AppBootstrap.init()
            let isAuth = typeof window.IS_AUTH !== 'undefined' ? window.IS_AUTH : false;
            let isEmailVerified = typeof window.IS_EMAIL_VERIFIED !== 'undefined' ? window.IS_EMAIL_VERIFIED : false;
            
            // –í –∫–∞—á–µ—Å—Ç–≤–µ —Ä–µ–∑–µ—Ä–≤–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ AppBootstrap –æ–±—ä–µ–∫—Ç–∞, –µ—Å–ª–∏ –æ–Ω–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –Ω–∞–ø—Ä—è–º—É—é
            if ((typeof isAuth === 'undefined' || isAuth === null) && typeof window.AppBootstrap !== 'undefined' && typeof window.AppBootstrap.getState === 'function') {
              const appState = window.AppBootstrap.getState();
              isAuth = appState.isAuth || false;
              isEmailVerified = appState.isEmailVerified || false;
            }
            
            // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞: –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω, –Ω–æ –≤–∏–¥–∏—Ç —ç—Ç—É –∫–Ω–æ–ø–∫—É
            if (!isAuth) {
              // –ï—Å–ª–∏ –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω, –æ—Ç–∫—Ä—ã–≤–∞–µ–º –æ–∫–Ω–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
              console.error('–û—à–∏–±–∫–∞: –∫–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤–∏–¥–µ–æ –±—ã–ª–∞ –ø–æ–∫–∞–∑–∞–Ω–∞ –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é');
              console.error('–§–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è: isAuth =', isAuth, ', isEmailVerified =', isEmailVerified);
              openRegister();
              return;
            }
            
            // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω, –Ω–æ email –Ω–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω
            if (!isEmailVerified) {
              // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è email
              console.warn('–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω, –Ω–æ email –Ω–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω');
              console.info('–§–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è: isAuth =', isAuth, ', isEmailVerified =', isEmailVerified);
              alert('–î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤–∏–¥–µ–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –≤–∞—à email. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∞—à—É –ø–æ—á—Ç—É –∏ –ø—Ä–æ–π–¥–∏—Ç–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—É –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.');
              return;
            }
            
            // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –∏ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª email, –æ—Ç–∫—Ä—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤–∏–¥–µ–æ
            const modal = document.getElementById('addVideoModal');
            if (modal) {
              // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π –∫–∞—Å—Ç–æ–º–Ω—ã–π –Ω–∏–∫–Ω–µ–π–º
              const savedNickname = localStorage.getItem('customVideoNickname');
              const nicknameField = document.getElementById('nicknameField');
              const nicknameInput = document.getElementById('nickname');
              
              if (savedNickname) {
                // –ï—Å–ª–∏ –Ω–∏–∫–Ω–µ–π–º —É–∂–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω, —Å–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª–µ
                if (nicknameField) {
                  nicknameField.style.display = 'none';
                }
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª–µ –Ω–∏–∫–Ω–µ–π–º–∞, —á—Ç–æ–±—ã –∑–Ω–∞—á–µ–Ω–∏–µ –ø–µ—Ä–µ–¥–∞–≤–∞–ª–æ—Å—å –≤ formData
                if (nicknameInput) {
                  nicknameInput.value = savedNickname;
                }
              } else {
                // –ï—Å–ª–∏ –Ω–∏–∫–Ω–µ–π–º –Ω–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª–µ
                if (nicknameField) {
                  nicknameField.style.display = 'block';
                }
                // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–µ—à–∏—Ç –≤–≤–µ—Å—Ç–∏ –Ω–æ–≤—ã–π –Ω–∏–∫–Ω–µ–π–º
                if (nicknameInput) {
                  nicknameInput.value = '';
                }
              }
              
              modal.style.display = "block";
              modal.setAttribute("aria-hidden", "false");
              document.body.style.overflow = 'hidden';
            }
          });
        }
      });

      // –î–æ–±–∞–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ email –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
      document.addEventListener('DOMContentLoaded', function() {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ª–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ —Å–æ—Å—Ç–æ—è–Ω–∏—é –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
        const isAuth = window.IS_AUTH || false;
        const isEmailVerified = window.IS_EMAIL_VERIFIED || false;
        
        // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω, –Ω–æ email –Ω–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω, –º–æ–∂–Ω–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
        if (isAuth && !isEmailVerified) {
          // –í –±—É–¥—É—â–µ–º –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —á–µ—Ä–µ–∑ API
          console.log('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω, –Ω–æ email –Ω–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω');
        }
      });

      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
      document.querySelectorAll("[data-close-add-video]").forEach(btn => {
        btn.addEventListener("click", () => {
          const modal = document.getElementById('addVideoModal');
          if (modal) {
            modal.style.display = "none";
            modal.setAttribute("aria-hidden", "true");
            document.body.style.overflow = '';
            
            // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã
            const form = document.getElementById('videoForm');
            if (form) {
              form.reset();
              form.classList.remove('was-validated');
              
              // –°–∫—Ä—ã—Ç–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –æ–± –æ—à–∏–±–∫–∞—Ö/—É—Å–ø–µ—Ö–µ
              document.getElementById('videoSubmitError').style.display = 'none';
              document.getElementById('videoSubmitSuccess').style.display = 'none';
            }
          }
        });
      });

      // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –µ–≥–æ
      window.addEventListener("click", (e) => {
        const modal = document.getElementById('addVideoModal');
        if (e.target === modal) {
          modal.style.display = "none";
          modal.setAttribute("aria-hidden", "true");
          document.body.style.overflow = '';
          
          // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã
          const form = document.getElementById('videoForm');
          if (form) {
            form.reset();
            form.classList.remove('was-validated');
            
            // –°–∫—Ä—ã—Ç–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –æ–± –æ—à–∏–±–∫–∞—Ö/—É—Å–ø–µ—Ö–µ
            document.getElementById('videoSubmitError').style.display = 'none';
            document.getElementById('videoSubmitSuccess').style.display = 'none';
          }
        }
      });

      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
      document.getElementById('videoForm')?.addEventListener('submit', async function(e) {
        e.preventDefault();

        const form = e.target;
        if (!form.checkValidity()) {
          form.classList.add('was-validated');
          return;
        }

        const formData = {
          videoUrl: document.getElementById('videoUrl').value,
          nickname: document.getElementById('nickname').value.trim(),
          title: document.getElementById('title').value,
          description: document.getElementById('description').value,
          genres: document.getElementById('genres').value
        };
        
        // –ï—Å–ª–∏ –≤–≤–µ–¥–µ–Ω –Ω–∏–∫–Ω–µ–π–º –∏ –µ–≥–æ –µ—â–µ –Ω–µ—Ç –≤ localStorage, —Å–æ—Ö—Ä–∞–Ω—è–µ–º –µ–≥–æ
        const nicknameInput = document.getElementById('nickname');
        if (nicknameInput && nicknameInput.value.trim() && !localStorage.getItem('customVideoNickname')) {
          localStorage.setItem('customVideoNickname', nicknameInput.value.trim());
        }

        try {
          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
          const submitBtn = form.querySelector('button[type="submit"]');
          const originalText = submitBtn.textContent;
          submitBtn.textContent = '–î–æ–±–∞–≤–ª–µ–Ω–∏–µ...';
          submitBtn.disabled = true;

          const response = await fetch('/api/p1/videos', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Accept': 'application/json',
              'X-CSRF-Token': document.querySelector('meta[name="csrf-token"]')?.getAttribute('content') || ''
            },
            body: JSON.stringify(formData)
          });

          const result = await response.json();
          if (result.success) {
            document.getElementById('videoSubmitSuccess').textContent = '–í–∏–¥–µ–æ —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ –∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é!';
            document.getElementById('videoSubmitSuccess').style.display = 'block';
            document.getElementById('videoSubmitError').style.display = 'none';
            
            // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã
            form.reset();
            form.classList.remove('was-validated');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
              location.reload();
            }, 2000);
          } else {
            document.getElementById('videoSubmitError').textContent = result.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –≤–∏–¥–µ–æ';
            document.getElementById('videoSubmitError').style.display = 'block';
            document.getElementById('videoSubmitSuccess').style.display = 'none';
          }
        } catch (error) {
          document.getElementById('videoSubmitError').textContent = '–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –≤–∏–¥–µ–æ';
          document.getElementById('videoSubmitError').style.display = 'none';
          document.getElementById('videoSubmitSuccess').style.display = 'none';
        } finally {
          // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
          const submitBtn = form.querySelector('button[type="submit"]');
          if (submitBtn) {
            submitBtn.textContent = '–î–æ–±–∞–≤–∏—Ç—å –≤–∏–¥–µ–æ';
            submitBtn.disabled = false;
          }
        }
      });
    </script>
</body>
</html>