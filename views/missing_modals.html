    </div>
  </div>
</div>

<!-- FIX: Overlay для просмотра изображений в полном размере -->
<div id="imageOverlay" class="image-overlay" aria-hidden="true">
  <div class="image-overlay-container">
    <button class="image-overlay-close" data-close-image aria-label="Закрыть изображение">&times;</button>
    <img id="imageOverlayImg" src="" alt="" class="image-overlay-img">
    <button class="image-overlay-nav image-overlay-prev" data-image-nav="prev" aria-label="Предыдущее изображение">‹</button>
    <button class="image-overlay-nav image-overlay-next" data-image-nav="next" aria-label="Следующее изображение">›</button>
  </div>
</div>

<!-- FIX: Модальное окно для просмотра изображений в полном размере -->
<div id="imageModal" class="modal image-modal" aria-hidden="true" style="display:none;">
  <div class="modal-content image-modal-content" role="dialog" aria-modal="true" aria-label="Просмотр изображения">
    <button class="close" data-close-image aria-label="Закрыть изображение">&times;</button>
    <div class="image-modal-container">
      <button class="image-nav-btn image-nav-prev" aria-label="Предыдущее изображение">‹</button>
      <div class="image-modal-image-wrapper">
        <img id="imageModalImage" src="" alt="" class="image-modal-image">
        <div class="image-modal-counter">
          <span id="imageModalCurrent">1</span> / <span id="imageModalTotal">1</span>
        </div>
        <div class="image-modal-title" id="imageModalTitle"></div>
      </div>
      <button class="image-nav-btn image-nav-next" aria-label="Следующее изображение">›</button>
    </div>
  </div>
</div>

<!-- Модальное окно описания товара -->
<div id="descriptionModal" class="modal description-modal" aria-hidden="true" style="display:none;">
  <div class="modal-content description-modal-content" role="dialog" aria-modal="true" aria-label="Описание товара">
    <button class="close" data-close-description aria-label="Закрыть">&times;</button>
    <h3 id="descriptionModalTitle" style="margin-bottom:20px;font-size:1.5rem;color:#fff;">Описание товара</h3>
    <div id="descriptionModalContent" style="max-height:75vh;overflow-y:auto;padding:20px 0;line-height:1.6;font-size:1.1rem;color:#ddd;">
      <!-- Описание будет вставлено динамически -->
    </div>
  </div>
</div>

<!-- окно регистрации -->
<div id="registerModal" class="modal" aria-hidden="true" style="display:none;">
  <div class="modal-content" role="dialog" aria-modal="true" aria-label="Регистрация">
    <button class="close" data-close-register aria-label="Закрыть">&times;</button>
    <h3>Регистрация</h3>
    <form id="registerForm">
      <input type="text" name="username" placeholder="Никнейм" required>
      <input type="email" name="email" placeholder="Email" required>
      <input type="password" name="password" placeholder="Пароль" minlength="6" required>
      <button type="submit">Создать аккаунт</button>
    </form>
    <div id="registerError" class="error" style="color:#b00020;margin-top:10px;display:none;"></div>
    <div id="registerSuccess" style="color:green;margin-top:10px;display:none;"></div>
  </div>
</div>

<!-- модальное окно для гостей чата -->
<div id="authModal" class="modal" aria-hidden="true" style="display:none;">
  <div class="modal-content" role="dialog" aria-modal="true" aria-label="Авторизация для чата">
    <button class="close" data-close-auth aria-label="Закрыть">&times;</button>
    <h3>Чтобы воспользоваться чатом, войдите в систему</h3>
    <div style="display:flex;gap:10px;margin-top:20px;">
      <a href="/user/login" class="btn">Войти</a>
      <a href="/user/register" class="btn outline">Регистрация</a>
    </div>
  </div>
</div>

<% let isAuthValue = typeof isAuth !== 'undefined' ? isAuth : false; %>
<% if (isAuthValue) { %>
<script>window.IS_AUTH = true;</script>
<% } else { %>
<script>window.IS_AUTH = false;</script>
<% } %>

<% let isAdminValue = typeof isAdmin !== 'undefined' ? isAdmin : false; %>
<% if (isAdminValue) { %>
<script>window.IS_ADMIN = true;</script>
<% } else { %>
<script>window.IS_ADMIN = false;</script>
<% } %>

<% let userRoleValue = typeof userRole !== 'undefined' ? userRole : null; %>
<script>window.USER_ROLE = '<%= userRoleValue %>';</script>

<!-- Загружаем YouTube IFrame API перед основным скриптом -->
<script>
  // Загрузка YouTube IFrame API
  var tag = document.createElement('script');
  tag.src = "https://www.youtube.com/iframe_api";
  var firstScriptTag = document.getElementsByTagName('script')[0];
  firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
</script>

<% if (!process.env.VERCEL) { %>
<% if (!process.env.VERCEL) { %>
<!-- Socket.IO (только если не на Vercel) -->
<script src="/socket.io/socket.io.js"></script>
<% } %>
<% } %>

<!-- Подключаем основной скрипт (включает весь JS: youtube init, модалки, рейтинг, категории, регистрация) -->
<script src="/script.js"></script>
</body>
</html>
