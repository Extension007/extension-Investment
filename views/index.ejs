<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>EXTO ‚Äî –ö–∞—Ç–∞–ª–æ–≥</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" href="/favicon.ico" type="image/x-icon">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <header class="main-header">
    <div class="container header-inner">
      <a class="logo" href="/">EXTO</a>
      <nav class="nav">
        <ul class="nav-list">
          <li><a class="nav-link" href="/">–ö–∞—Ç–∞–ª–æ–≥</a></li>
          <li><a class="nav-link" href="#about">–û –ø—Ä–æ–µ–∫—Ç–µ</a></li>
          <li><a class="nav-link" href="#contacts">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a></li>
        </ul>
      </nav>
      <div class="header-actions">
        <% if (isAuth) { %>
          <% if (isAdmin) { %>
            <a class="btn outline" href="/admin">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</a>
          <% } else { %>
            <a class="btn outline" href="/cabinet">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</a>
          <% } %>
        <% } else { %>
          <a class="btn outline" href="/user/login">–í—Ö–æ–¥</a>
          <button id="openRegister" type="button" class="btn outline">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
        <% } %>
      </div>
    </div>
  </header>

  <main>
    <section id="catalog" class="section">
      <div class="section-header">
        <h2>–ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤</h2>
        <% if (categories) { %>
          <div class="category-dropdown">
            <button id="openCategories" type="button" class="btn small outline">
              –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ <span style="opacity:.8">(<%= selectedCategory === 'all' ? '–≤—Å–µ' : categories[selectedCategory] %>)</span>
            </button>
            <div id="categoriesMenu" class="dropdown-menu" aria-hidden="true">
              <button class="dropdown-item" data-category="all">–í—Å–µ</button>
              <% Object.keys(categories).forEach(key => { %>
                <button class="dropdown-item" data-category="<%= key %>"><%= categories[key] %></button>
              <% }) %>
            </div>
          </div>
        <% } %>
      </div>

      <div id="product-grid" class="product-grid">
        <% if (products && products.length) { %>
          <% products.forEach(p => { %>
            <div class="product-card">
              <h3 class="product-title"><%= p.name %></h3>

              <% if (p.image_url) { %>
                <img src="<%= p.image_url %>" alt="<%= p.name %>">
              <% } else { %>
                <div class="no-image">–ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</div>
              <% } %>

              <div class="product-bottom">
                <p class="product-desc"><%= p.description %></p>
                <span class="price"><%= p.price %> ‚Ç∏</span>

                <div class="product-actions">
                  <a class="btn small outline" href="<%= p.link %>" target="_blank" rel="noopener">–ü–µ—Ä–µ–π—Ç–∏</a>
                  <% if (p.video_url) { %>
                    <button class="btn small" data-video="<%= p.video_url %>">–û–±–∑–æ—Ä</button>
                  <% } %>
                </div>

                <!-- üîπ –ë–ª–æ–∫ —Ä–µ–π—Ç–∏–Ω–≥–∞ -->
                <div class="product-rating" data-id="<%= p._id %>" data-voted="<%= (votedMap && votedMap[p._id.toString()]) ? 'true' : 'false' %>">
                  <button class="like-btn btn icon" type="button" aria-label="–õ–∞–π–∫" <%= (votedMap && votedMap[p._id.toString()]) ? 'disabled' : '' %>>üëç</button>

                  <span class="result">
                    <% const likes = p.likes || 0; %>
                    <% const dislikes = p.dislikes || 0; %>
                    <%= likes - dislikes %>
                  </span>

                  <button class="dislike-btn btn icon" type="button" aria-label="–î–∏–∑–ª–∞–π–∫" <%= (votedMap && votedMap[p._id.toString()]) ? 'disabled' : '' %>>üëé</button>

                  <span class="votes">
                    (<%= (p.likes || 0) + (p.dislikes || 0) %> –≥–æ–ª–æ—Å–æ–≤)
                  </span>
                </div>
              </div>
            </div>
          <% }) %>
        <% } else { %>
          <p class="empty-state">–ü–æ–∫–∞ –Ω–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤</p>
        <% } %>
      </div>
    </section>

    <!-- –†–µ–∫–ª–∞–º–Ω—ã–π –±–ª–æ–∫ -->
    <section id="ad" class="section">
      <h2>–¢—É—Ç –≤–∞—à–∞ —Ä–µ–∫–ª–∞–º–∞</h2>
      <p class="disclaimer" style="text-align:center;margin-top:10px;">
        –ú–µ—Å—Ç–æ –¥–ª—è –ø–∞—Ä—Ç–Ω—ë—Ä—Å–∫–∏—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π, –±–∞–Ω–Ω–µ—Ä–æ–≤ –∏ –ø—Ä–æ–º–æ.
      </p>
    </section>

    <section id="about" class="section">
      <h2>–û –ø—Ä–æ–µ–∫—Ç–µ</h2>
      <p class="disclaimer">
        EXTO ‚Äî —ç—Ç–æ –∫–∞—Ç–∞–ª–æ–≥ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π. –ú—ã —Å—Ç—Ä–µ–º–∏–º—Å—è –∫ –ø—Ä–∏–≤—ã—á–Ω–æ–º—É UX, —á–∏—Å—Ç–æ–π –≤–∏–∑—É–∞–ª—å–Ω–æ–π –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ–π –≤–µ—Ä—Å—Ç–∫–µ.
      </p>
    </section>

    <section id="contacts" class="section">
      <h2>–ö–æ–Ω—Ç–∞–∫—Ç—ã</h2>
      <p class="disclaimer">
        –ü–æ –≤–æ–ø—Ä–æ—Å–∞–º —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–∞ –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π ‚Äî –ø–∏—à–∏—Ç–µ –Ω–∞–º.
      </p>
    </section>
  </main>

  <footer class="footer">
    <p>¬© 2025 EXTO Ecosystem</p>
  </footer>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –≤–∏–¥–µ–æ -->
  <div id="videoModal" class="modal" aria-hidden="true">
    <div class="modal-content" role="dialog" aria-modal="true" aria-label="–í–∏–¥–µ–æ –æ–±–∑–æ—Ä">
      <button class="close" data-close-video aria-label="–ó–∞–∫—Ä—ã—Ç—å –≤–∏–¥–µ–æ">&times;</button>
      <iframe id="videoFrame" 
              width="100%" 
              height="480" 
              frameborder="0" 
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
              allowfullscreen
              loading="eager"
              referrerpolicy="strict-origin-when-cross-origin"
              style="display: block !important; visibility: visible !important; opacity: 1 !important;"></iframe>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
  <div id="registerModal" class="modal" aria-hidden="true">
    <div class="modal-content" role="dialog" aria-modal="true" aria-label="–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è">
      <button class="close" data-close-register aria-label="–ó–∞–∫—Ä—ã—Ç—å">&times;</button>
      <h3>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h3>
      <form id="registerForm">
        <input type="text" name="username" placeholder="–ù–∏–∫–Ω–µ–π–º" required>
        <input type="email" name="email" placeholder="Email" required>
        <input type="password" name="password" placeholder="–ü–∞—Ä–æ–ª—å" minlength="6" required>
        <button type="submit">–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
      </form>
      <div id="registerError" class="error" style="color:#b00020;margin-top:10px;display:none;"></div>
      <div id="registerSuccess" style="color:green;margin-top:10px;display:none;"></div>
    </div>
  </div>

  <script>window.IS_AUTH = <%= JSON.stringify(isAuth) %>;</script>
  <script src="/script.js"></script>
</body>
</html>
