<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–ê–¥–º–∏–Ω–∫–∞ ‚Äî –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="/styles.css?v=1.0.1">
</head>
<body class="admin-page">
  <div id="bg-animated" aria-hidden="true"></div>
<header class="main-header">
<div class="container header-inner">
  <div class="header-top">
    <div class="header-left">
      <a class="logo" href="/"><img src="/albamount.png" alt="ALBAMOUNT" class="logo-img"></a>
      <div class="header-stats">
        <div class="stat-item">
          <span style="opacity: 0.8;">üë•</span>
          <strong style="color: #4caf50;"><%= typeof visitorCount !== 'undefined' ? visitorCount : 0 %></strong>
        </div>
        <div class="stat-item">
          <span style="opacity: 0.8;">üë§</span>
          <strong style="color: #2196f3;"><%= typeof userCount !== 'undefined' ? userCount : 0 %></strong>
        </div>
      </div>
    <div class="header-actions">
<span class="user-chip">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</span>
<form id="logoutForm" method="POST" action="/logout" style="display:inline;margin-left:10px;">
<button type="submit" class="btn outline small">–í—ã—Ö–æ–¥</button>
</form>
</div>
  </div>
</header>

<main style="margin-bottom: 64px;">

<!-- –ú–æ–¥–µ—Ä–∞—Ü–∏—è —Ç–æ–≤–∞—Ä–æ–≤ -->
<section class="section">
<div class="section-header">
<h2>–ú–æ–¥–µ—Ä–∞—Ü–∏—è —Ç–æ–≤–∞—Ä–æ–≤</h2>
<span class="badge" style="background:#ff9800;color:#fff;padding:4px 12px;border-radius:6px;font-size:0.9rem;">
<% if (pendingProducts && pendingProducts.length) { %>
<%= pendingProducts.length %> –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ
<% } else { %>
–ù–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏
<% } %>
</span>
</div>

<% if (pendingProducts && pendingProducts.length) { %>
<div class="product-grid">
<% pendingProducts.forEach(p => { %>
<div class="product-card" style="border:2px solid #ff9800;">
<h3 class="product-title"><%= p.name %></h3>
<% if (p.image_url) { %>
<img src="<%= p.image_url %>" alt="<%= p.name %>">
<% } else { %>
<div class="no-image">–ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</div>
<% } %>

<div class="product-bottom">
<p class="product-desc"><%= p.description || "‚Äî" %></p>
<div class="row" style="justify-content:center; gap:8px;">
<span class="muted">–¶–µ–Ω–∞:</span>
<strong class="price"><%= p.price %></strong>
</div>

<% if (p.owner) { %>
<% if (typeof p.owner === 'object' && p.owner.username) { %>
<p class="muted" style="text-align:center;font-size:0.9rem;">–û—Ç: <%= p.owner.username %></p>
<% } else { %>
<p class="muted" style="text-align:center;font-size:0.9rem;">–û—Ç: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ID <%= p.owner %></p>
<% } %>
<% } else { %>
<p class="muted" style="text-align:center;font-size:0.9rem;color:#f44336;">‚ö†Ô∏è –í–ª–∞–¥–µ–ª–µ—Ü –Ω–µ —É–∫–∞–∑–∞–Ω</p>
<% } %>

<div class="product-actions" style="flex-direction:column;gap:8px;">
<button class="btn small approve-btn" data-id="<%= p._id %>" data-type="product">
‚úÖ –û–¥–æ–±—Ä–∏—Ç—å
</button>
<button class="btn small reject-btn" data-id="<%= p._id %>" data-type="product">
‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å
</button>
<% if (p.link) { %>
<a class="btn small outline" href="<%= p.link %>" target="_blank" rel="noopener">–°—Å—ã–ª–∫–∞</a>
<% } %>
<% if (p.video_url) { %>
<button class="btn small outline" data-video="<%= p.video_url %>">–í–∏–¥–µ–æ</button>
<% } %>
</div>
</div>
</div>
<% }) %>
</div>
<% } else { %>
<p class="empty-state">–ù–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏</p>
<% } %>
</section>

<!-- –ú–æ–¥–µ—Ä–∞—Ü–∏—è —É—Å–ª—É–≥ -->
<section class="section">
<div class="section-header">
<h2>–ú–æ–¥–µ—Ä–∞—Ü–∏—è —É—Å–ª—É–≥</h2>
<span class="badge" style="background:#ff9800;color:#fff;padding:4px 12px;border-radius:6px;font-size:0.9rem;">
<% if (pendingServices && pendingServices.length) { %>
<%= pendingServices.length %> –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ
<% } else { %>
–ù–µ—Ç —É—Å–ª—É–≥ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏
<% } %>
</span>
</div>

<% if (pendingServices && pendingServices.length) { %>
<div class="product-grid">
<% pendingServices.forEach(s => { %>
<div class="product-card" style="border:2px solid #ff9800;">
<h3 class="product-title"><%= s.name %></h3>
<% if (s.image_url) { %>
<img src="<%= s.image_url %>" alt="<%= s.name %>">
<% } else { %>
<div class="no-image">–ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</div>
<% } %>

<div class="product-bottom">
<p class="product-desc"><%= s.description || "‚Äî" %></p>
<div class="row" style="justify-content:center; gap:8px;">
<span class="muted">–¶–µ–Ω–∞:</span>
<strong class="price"><%= s.price %></strong>
</div>

<% if (s.owner) { %>
<% if (typeof s.owner === 'object' && s.owner.username) { %>
<p class="muted" style="text-align:center;font-size:0.9rem;">–û—Ç: <%= s.owner.username %></p>
<% } else { %>
<p class="muted" style="text-align:center;font-size:0.9rem;">–û—Ç: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ID <%= s.owner %></p>
<% } %>
<% } else { %>
<p class="muted" style="text-align:center;font-size:0.9rem;color:#f44336;">‚ö†Ô∏è –í–ª–∞–¥–µ–ª–µ—Ü –Ω–µ —É–∫–∞–∑–∞–Ω</p>
<% } %>

<div class="product-actions" style="flex-direction:column;gap:8px;">
<button class="btn small approve-btn" data-id="<%= s._id %>" data-type="service">
‚úÖ –û–¥–æ–±—Ä–∏—Ç—å
</button>
<button class="btn small reject-btn" data-id="<%= s._id %>" data-type="service">
‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å
</button>
<% if (s.link) { %>
<a class="btn small outline" href="<%= s.link %>" target="_blank" rel="noopener">–°—Å—ã–ª–∫–∞</a>
<% } %>
<% if (s.video_url) { %>
<button class="btn small outline" data-video="<%= s.video_url %>">–í–∏–¥–µ–æ</button>
<% } %>
</div>
</div>
</div>
<% }) %>
</div>
<% } else { %>
<p class="empty-state">–ù–µ—Ç —É—Å–ª—É–≥ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏</p>
<% } %>
</section>

<!-- –ú–æ–¥–µ—Ä–∞—Ü–∏—è –±–∞–Ω–Ω–µ—Ä–æ–≤ -->
<section class="section">
<div class="section-header">
<h2>–ú–æ–¥–µ—Ä–∞—Ü–∏—è –±–∞–Ω–Ω–µ—Ä–æ–≤</h2>
<span class="badge" style="background:#ff9800;color:#fff;padding:4px 12px;border-radius:6px;font-size:0.9rem;">
<% if (pendingBanners && pendingBanners.length) { %>
<%= pendingBanners.length %> –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ
<% } else { %>
–ù–µ—Ç –±–∞–Ω–Ω–µ—Ä–æ–≤ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏
<% } %>
</span>
</div>

<% if (pendingBanners && pendingBanners.length) { %>
<div class="product-grid">
<% pendingBanners.forEach(b => { %>
<div class="product-card" style="border:2px solid #ff9800;">
<h3 class="product-title">–ë–∞–Ω–Ω–µ—Ä</h3>
<% if (b.image_url) { %>
<img src="<%= b.image_url %>" alt="–ë–∞–Ω–Ω–µ—Ä" style="max-height: 200px; object-fit: cover;">
<% } else { %>
<div class="no-image">–ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</div>
<% } %>

<div class="product-bottom">
<% if (b.owner) { %>
<% if (typeof b.owner === 'object' && b.owner.username) { %>
<p class="muted" style="text-align:center;font-size:0.9rem;">–û—Ç: <%= b.owner.username %></p>
<% } else { %>
<p class="muted" style="text-align:center;font-size:0.9rem;">–û—Ç: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ID <%= b.owner %></p>
<% } %>
<% } else { %>
<p class="muted" style="text-align:center;font-size:0.9rem;color:#f44336;">‚ö†Ô∏è –í–ª–∞–¥–µ–ª–µ—Ü –Ω–µ —É–∫–∞–∑–∞–Ω</p>
<% } %>

<% if (b.link) { %>
<p class="muted" style="text-align:center;font-size:0.85rem;margin-top:5px;">
üîó <a href="<%= b.link %>" target="_blank" rel="noopener" style="color:#666;"><%= b.link %></a>
</p>
<% } %>

<div class="product-actions" style="flex-direction:column;gap:8px;">
<button class="btn small approve-btn" data-id="<%= b._id %>" data-type="banner">
‚úÖ –û–¥–æ–±—Ä–∏—Ç—å
</button>
<button class="btn small reject-btn" data-id="<%= b._id %>" data-type="banner">
‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å
</button>
<% if (b.link) { %>
<a class="btn small outline" href="<%= b.link %>" target="_blank" rel="noopener">–°—Å—ã–ª–∫–∞</a>
<% } %>
</div>
</div>
</div>
<% }) %>
</div>
<% } else { %>
<p class="empty-state">–ù–µ—Ç –±–∞–Ω–Ω–µ—Ä–æ–≤ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏</p>
<% } %>
</section>

<!-- –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä/—É—Å–ª—É–≥—É -->
<section class="section">
<div class="section-header">
<h2>–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä/—É—Å–ª—É–≥—É</h2>
</div>
<form id="adminCreateProductForm" method="POST" action="/admin/products" enctype="multipart/form-data" class="form-grid">
<input type="hidden" name="_csrf" value="<%= typeof csrfToken !== 'undefined' ? csrfToken : '' %>">
<!-- –°–µ–ª–µ–∫—Ç–æ—Ä —Ç–∏–ø–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ -->
<div class="form-section">
<label for="adminType">–¢–∏–ø –ø—É–±–ª–∏–∫–∞—Ü–∏–∏:</label>
<select id="adminType" name="type" required>
<option value="product">–¢–æ–≤–∞—Ä</option>
<option value="service">–£—Å–ª—É–≥–∞</option>
</select>
</div>

<input type="text" name="name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" required>
<textarea name="description" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ" rows="4"></textarea>
<input type="text" name="price" placeholder="–¶–µ–Ω–∞" required>
<input type="url" name="link" placeholder="–°—Å—ã–ª–∫–∞">
<input type="url" name="video_url" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ –≤–∏–¥–µ–æ (YouTube, –í–ö–æ–Ω—Ç–∞–∫—Ç–µ, Instagram)">

<!-- –ü–æ–ª—è –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –ø—Ä–æ–¥–∞–≤—Ü–∞ -->
<div class="form-section">
<h3>–ö–æ–Ω—Ç–∞–∫—Ç—ã –ø—Ä–æ–¥–∞–≤—Ü–∞</h3>
<input type="tel" name="phone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω">
<input type="email" name="email" placeholder="Email">
<input type="text" name="telegram" placeholder="Telegram (–Ω–∞–ø—Ä–∏–º–µ—Ä: @username)">
<input type="text" name="whatsapp" placeholder="WhatsApp (–Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞)">
<textarea name="contact_method" placeholder="–°–ø–æ—Å–æ–± —Å–≤—è–∑–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä: –ó–≤–æ–Ω–∏—Ç–µ —Å 9:00 –¥–æ 18:00)" rows="2"></textarea>
</div>

<!-- –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ 5 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π -->
<div class="form-section">
<label for="adminImages">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–¥–æ 5 —à—Ç.):</label>
<input type="file" id="adminImages" name="images" accept="image/*" multiple data-max-files="5">
<div id="adminImagePreview" class="image-preview-container" style="display:none;margin-top:10px;"></div>
<small class="form-hint">–ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –¥–æ 5 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</small>
</div>

<div class="form-section">
<label for="adminCategory">–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
<div id="adminCategorySelectorContainer">
<select name="category" id="adminCategorySelect" required>
<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
<!-- –ë–ª–æ–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
</select>
<div id="adminSubcategorySelector" style="margin-top: 10px; display: none;">
<button class="btn small outline" id="adminBackToBlocks" style="margin-bottom: 10px;">‚Üê –ù–∞–∑–∞–¥ –∫ –±–ª–æ–∫–∞–º</button>
<select id="adminSubcategorySelect" name="subcategory" style="width: 100%;">
<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
</select>
</div>
<!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–æ–≥–æ –≤—ã–±–æ—Ä–∞ -->
<div id="adminHierarchicalCategorySelector" style="margin-top: 10px; display: none;">
<button class="btn small outline" id="adminBackToMain" style="margin-bottom: 10px;">‚Üê –ù–∞–∑–∞–¥ –∫ –æ—Å–Ω–æ–≤–Ω—ã–º –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</button>
</div>
</div>

<button type="submit" class="btn primary">–î–æ–±–∞–≤–∏—Ç—å</button>
</form>
<div id="adminCreateMsg" class="note" style="margin-top:10px;"></div>
</section>

<!-- –î–æ–±–∞–≤–∏—Ç—å –±–∞–Ω–Ω–µ—Ä -->
<section class="section">
<div class="section-header">
<h2>–î–æ–±–∞–≤–∏—Ç—å –±–∞–Ω–Ω–µ—Ä</h2>
</div>
<form id="adminCreateBannerForm" method="POST" action="/admin/banners" enctype="multipart/form-data" class="form-grid">
<input type="hidden" name="_csrf" value="<%= typeof csrfToken !== 'undefined' ? csrfToken : '' %>">
<input type="text" name="title" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –±–∞–Ω–Ω–µ—Ä–∞" required>
<textarea name="description" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ" rows="4"></textarea>
<input type="text" name="price" placeholder="–¶–µ–Ω–∞">
<input type="url" name="link" placeholder="–°—Å—ã–ª–∫–∞">
<input type="url" name="video_url" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ –≤–∏–¥–µ–æ (YouTube, –í–ö–æ–Ω—Ç–∞–∫—Ç–µ, Instagram)">
<input type="text" name="category" placeholder="–ö–∞—Ç–µ–≥–æ—Ä–∏—è (—Ä–µ–∫–ª–∞–º–∞, –ø—Ä–æ–º–æ –∏ —Ç.–¥.)">

<!-- –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ 5 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π -->
<div class="form-section">
<label for="adminBannerImages">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–¥–æ 5 —à—Ç.):</label>
<input type="file" id="adminBannerImages" name="images" accept="image/*" multiple data-max-files="5">
<div id="adminBannerImagePreview" class="image-preview-container" style="display:none;margin-top:10px;"></div>
<small class="form-hint">–ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –¥–æ 5 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</small>
</div>

<select name="status">
<option value="published">–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ</option>
<option value="draft">–ß–µ—Ä–Ω–æ–≤–∏–∫</option>
<option value="pending">–ù–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏</option>
</select>

<button type="submit" class="btn primary">–î–æ–±–∞–≤–∏—Ç—å –±–∞–Ω–Ω–µ—Ä</button>
</form>
<div id="adminCreateBannerMsg" class="note" style="margin-top:10px;"></div>
</section>

<!-- –ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤ -->
<section class="section">
<div class="section-header">
<h2>–ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤</h2>
<span class="badge" style="background:#666;color:#fff;padding:4px 12px;border-radius:6px;font-size:0.9rem;">
–í—Å–µ–≥–æ: <%= products ? products.length : 0 %>
</span>
</div>

<% if (products && products.length) { %>
<div class="product-grid">
<% products.forEach(p => { %>
<div class="product-card status-<%= p.status || 'pending' %>">
<h3 class="product-title"><%= p.name %></h3>
<% if (p.image_url) { %>
<img src="<%= p.image_url %>" alt="<%= p.name %>">
<% } else { %>
<div class="no-image">–ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</div>
<% } %>

<div class="product-bottom">
<!-- –°—Ç–∞—Ç—É—Å –∫–∞—Ä—Ç–æ—á–∫–∏ -->
<div style="text-align:center;margin-bottom:10px;">
<% if (p.status === "pending") { %>
<span class="badge" style="background:#ff9800;color:#fff;padding:4px 12px;border-radius:6px;font-size:0.9rem;">
‚è≥ –ù–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏
</span>
<% } else if (p.status === "approved") { %>
<span class="badge" style="background:#4caf50;color:#fff;padding:4px 12px;border-radius:6px;font-size:0.9rem;">
‚úÖ –û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ
</span>
<% } else if (p.status === "rejected") { %>
<span class="badge" style="background:#f44336;color:#fff;padding:4px 12px;border-radius:6px;font-size:0.9rem;">
‚ùå –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ
</span>
<% } else { %>
<span class="badge" style="background:#666;color:#fff;padding:4px 12px;border-radius:6px;font-size:0.9rem;">
‚ö†Ô∏è –ë–µ–∑ —Å—Ç–∞—Ç—É—Å–∞
</span>
<% } %>
</div>

<p class="product-desc"><%= p.description || "‚Äî" %></p>
<div class="row" style="justify-content:center; gap:8px;">
<span class="muted">–¶–µ–Ω–∞:</span>
<strong class="price"><%= p.price %></strong>
</div>

<!-- –í–ª–∞–¥–µ–ª–µ—Ü -->
<% if (p.owner) { %>
<% if (typeof p.owner === 'object' && p.owner.username) { %>
<p class="muted" style="text-align:center;font-size:0.85rem;margin-top:5px;">
üë§ –í–ª–∞–¥–µ–ª–µ—Ü: <%= p.owner.username %>
</p>
<% } else { %>
<p class="muted" style="text-align:center;font-size:0.85rem;margin-top:5px;">
üë§ –í–ª–∞–¥–µ–ª–µ—Ü: ID <%= p.owner %>
</p>
<% } %>
<% } else { %>
<p class="muted" style="text-align:center;font-size:0.85rem;margin-top:5px;color:#f44336;">
‚ö†Ô∏è –í–ª–∞–¥–µ–ª–µ—Ü –Ω–µ —É–∫–∞–∑–∞–Ω (—Å–æ–∑–¥–∞–Ω–æ –∞–¥–º–∏–Ω–æ–º)
</p>
<% } %>

<!-- –ö–∞—Ç–µ–≥–æ—Ä–∏—è -->
<% if (categories && p.category) { %>
<p class="muted" style="text-align:center;font-size:0.85rem;margin-top:5px;">
üìÅ <%= categories[p.category] || p.category %>
</p>
<% } %>

<div class="product-actions" style="flex-direction:column;gap:6px;margin-top:10px;">
<!-- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞/–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ -->
<button class="btn small toggle-visibility-btn status-<%= p.status %>"
data-id="<%= p._id %>"
data-status="<%= p.status %>">
<%= p.status === 'approved' ? 'üö´ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å' : '‚úÖ –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å' %>
</button>

<a class="btn small outline" href="/admin/products/<%= p._id %>/edit">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>

<form method="POST" action="/admin/products/<%= p._id %>/delete" style="display:inline" onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É?');">
<input type="hidden" name="_csrf" value="<%= typeof csrfToken !== 'undefined' ? csrfToken : '' %>">
<button type="submit" class="btn small outline" style="width:100%;">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
</form>

<% if (p.link) { %>
<a class="btn small outline" href="<%= p.link %>" target="_blank" rel="noopener">üîó –°—Å—ã–ª–∫–∞</a>
<% } %>
<% if (p.video_url) { %>
<button class="btn small outline" data-video="<%= p.video_url %>">‚ñ∂Ô∏è –í–∏–¥–µ–æ</button>
<% } %>
</div>

<!-- –†–µ–π—Ç–∏–Ω–≥ (—Ç–æ–ª—å–∫–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ) -->
<div class="product-rating" data-id="<%= p._id %>" style="margin-top:10px;">
<button class="btn icon" type="button" disabled aria-label="–õ–∞–π–∫">‚ñ≤</button>
<span class="result"><%= (p.likes || 0) - (p.dislikes || 0) %></span>
<button class="btn icon" type="button" disabled aria-label="–î–∏–∑–ª–∞–π–∫">‚ñº</button>
<span class="votes">(<%= (p.likes || 0) + (p.dislikes || 0) %> –≥–æ–ª–æ—Å–æ–≤)</span>
</div>
</div>
</div>
<% }) %>
</div>
<% } else { %>
<p class="empty-state">–ü–æ–∫–∞ –Ω–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤</p>
<% } %>
</section>

<!-- –ö–∞—Ç–∞–ª–æ–≥ —É—Å–ª—É–≥ -->
<section class="section">
<div class="section-header">
<h2>–ö–∞—Ç–∞–ª–æ–≥ —É—Å–ª—É–≥</h2>
<span class="badge" style="background:#666;color:#fff;padding:4px 12px;border-radius:6px;font-size:0.9rem;">
–í—Å–µ–≥–æ: <%= services ? services.length : 0 %>
</span>
</div>

<% if (services && services.length) { %>
<div class="product-grid">
<% services.forEach(s => { %>
<div class="product-card status-<%= s.status || 'pending' %>">
<h3 class="product-title"><%= s.name %></h3>
<% if (s.image_url) { %>
<img src="<%= s.image_url %>" alt="<%= s.name %>">
<% } else { %>
<div class="no-image">–ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</div>
<% } %>

<div class="product-bottom">
<!-- –°—Ç–∞—Ç—É—Å –∫–∞—Ä—Ç–æ—á–∫–∏ -->
<div style="text-align:center;margin-bottom:10px;">
<% if (s.status === "pending") { %>
<span class="badge" style="background:#ff9800;color:#fff;padding:4px 12px;border-radius:6px;font-size:0.9rem;">
‚è≥ –ù–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏
</span>
<% } else if (s.status === "approved") { %>
<span class="badge" style="background:#4caf50;color:#fff;padding:4px 12px;border-radius:6px;font-size:0.9rem;">
‚úÖ –û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ
</span>
<% } else if (s.status === "rejected") { %>
<span class="badge" style="background:#f44336;color:#fff;padding:4px 12px;border-radius:6px;font-size:0.9rem;">
‚ùå –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ
</span>
<% } else { %>
<span class="badge" style="background:#666;color:#fff;padding:4px 12px;border-radius:6px;font-size:0.9rem;">
‚ö†Ô∏è –ë–µ–∑ —Å—Ç–∞—Ç—É—Å–∞
</span>
<% } %>
</div>

<p class="product-desc"><%= s.description || "‚Äî" %></p>
<div class="row" style="justify-content:center; gap:8px;">
<span class="muted">–¶–µ–Ω–∞:</span>
<strong class="price"><%= s.price %></strong>
</div>

<!-- –í–ª–∞–¥–µ–ª–µ—Ü -->
<% if (s.owner) { %>
<% if (typeof s.owner === 'object' && s.owner.username) { %>
<p class="muted" style="text-align:center;font-size:0.85rem;margin-top:5px;">
üë§ –í–ª–∞–¥–µ–ª–µ—Ü: <%= s.owner.username %>
</p>
<% } else { %>
<p class="muted" style="text-align:center;font-size:0.85rem;margin-top:5px;">
üë§ –í–ª–∞–¥–µ–ª–µ—Ü: ID <%= s.owner %>
</p>
<% } %>
<% } else { %>
<p class="muted" style="text-align:center;font-size:0.85rem;margin-top:5px;color:#f44336;">
‚ö†Ô∏è –í–ª–∞–¥–µ–ª–µ—Ü –Ω–µ —É–∫–∞–∑–∞–Ω (—Å–æ–∑–¥–∞–Ω–æ –∞–¥–º–∏–Ω–æ–º)
</p>
<% } %>

<!-- –ö–∞—Ç–µ–≥–æ—Ä–∏—è -->
<% if (categories && s.category) { %>
<p class="muted" style="text-align:center;font-size:0.85rem;margin-top:5px;">
üìÅ <%= categories[s.category] || s.category %>
</p>
<% } %>

<div class="product-actions" style="flex-direction:column;gap:6px;margin-top:10px;">
<!-- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞/–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ -->
<button class="btn small toggle-visibility-btn status-<%= s.status %>"
data-id="<%= s._id %>"
data-status="<%= s.status %>">
<%= s.status === 'approved' ? 'üö´ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å' : '‚úÖ –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å' %>
</button>

<a class="btn small outline" href="/admin/services/<%= s._id %>/edit">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>

<form method="POST" action="/admin/services/<%= s._id %>/delete" style="display:inline" onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É?');">
<input type="hidden" name="_csrf" value="<%= typeof csrfToken !== 'undefined' ? csrfToken : '' %>">
<button type="submit" class="btn small outline" style="width:100%;">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
</form>

<% if (s.link) { %>
<a class="btn small outline" href="<%= s.link %>" target="_blank" rel="noopener">üîó –°—Å—ã–ª–∫–∞</a>
<% } %>
<% if (s.video_url) { %>
<button class="btn small outline" data-video="<%= s.video_url %>">‚ñ∂Ô∏è –í–∏–¥–µ–æ</button>
<% } %>
</div>

<!-- –†–µ–π—Ç–∏–Ω–≥ (—Ç–æ–ª—å–∫–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ) -->
<div class="product-rating" data-id="<%= s._id %>" style="margin-top:10px;">
<button class="btn icon" type="button" disabled aria-label="–õ–∞–π–∫">‚ñ≤</button>
<span class="result"><%= (s.likes || 0) - (s.dislikes || 0) %></span>
<button class="btn icon" type="button" disabled aria-label="–î–∏–∑–ª–∞–π–∫">‚ñº</button>
<span class="votes">(<%= (s.likes || 0) + (s.dislikes || 0) %> –≥–æ–ª–æ—Å–æ–≤)</span>
</div>
</div>
</div>
<% }) %>
</div>
<% } else { %>
<p class="empty-state">–ü–æ–∫–∞ –Ω–µ—Ç —É—Å–ª—É–≥</p>
<% } %>
</section>

<!-- –ö–∞—Ç–∞–ª–æ–≥ –±–∞–Ω–Ω–µ—Ä–æ–≤ -->
<section class="section">
<div class="section-header">
<h2>–ö–∞—Ç–∞–ª–æ–≥ –±–∞–Ω–Ω–µ—Ä–æ–≤</h2>
<span class="badge" style="background:#666;color:#fff;padding:4px 12px;border-radius:6px;font-size:0.9rem;">
–í—Å–µ–≥–æ: <%= banners ? banners.length : 0 %>
</span>
</div>

<% if (banners && banners.length) { %>
<div class="product-grid">
<% banners.forEach(b => { %>
<div class="product-card status-<%= b.status || 'pending' %>">
<h3 class="product-title"><%= b.title || '–ë–∞–Ω–Ω–µ—Ä' %></h3>
<% if (b.image_url || (b.images && b.images.length > 0)) { %>
<img src="<%= b.image_url || b.images[0] %>" alt="<%= b.title || '–ë–∞–Ω–Ω–µ—Ä' %>" style="max-height: 200px; object-fit: cover;">
<% } else { %>
<div class="no-image">–ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</div>
<% } %>

<div class="product-bottom">
<!-- –°—Ç–∞—Ç—É—Å –∫–∞—Ä—Ç–æ—á–∫–∏ -->
<div style="text-align:center;margin-bottom:10px;">
<% if (b.status === "pending") { %>
<span class="badge" style="background:#ff9800;color:#fff;padding:4px 12px;border-radius:6px;font-size:0.9rem;">
‚è≥ –ù–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏
</span>
<% } else if (b.status === "approved" || b.status === "published") { %>
<span class="badge" style="background:#4caf50;color:#fff;padding:4px 12px;border-radius:6px;font-size:0.9rem;">
‚úÖ –û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ
</span>
<% } else if (b.status === "rejected" || b.status === "blocked") { %>
<span class="badge" style="background:#f44336;color:#fff;padding:4px 12px;border-radius:6px;font-size:0.9rem;">
‚ùå –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ
</span>
<% } else { %>
<span class="badge" style="background:#666;color:#fff;padding:4px 12px;border-radius:6px;font-size:0.9rem;">
‚ö†Ô∏è –ë–µ–∑ —Å—Ç–∞—Ç—É—Å–∞
</span>
<% } %>
</div>

<p class="product-desc"><%= b.description || "‚Äî" %></p>
<% if (b.price && b.price > 0) { %>
<div class="row" style="justify-content:center; gap:8px;">
<span class="muted">–¶–µ–Ω–∞:</span>
<strong class="price"><%= b.price %></strong>
</div>
<% } %>

<!-- –í–ª–∞–¥–µ–ª–µ—Ü -->
<% if (b.owner) { %>
<% if (typeof b.owner === 'object' && b.owner.username) { %>
<p class="muted" style="text-align:center;font-size:0.85rem;margin-top:5px;">
üë§ –í–ª–∞–¥–µ–ª–µ—Ü: <%= b.owner.username %>
</p>
<% } else { %>
<p class="muted" style="text-align:center;font-size:0.85rem;margin-top:5px;">
üë§ –í–ª–∞–¥–µ–ª–µ—Ü: ID <%= b.owner %>
</p>
<% } %>
<% } else { %>
<p class="muted" style="text-align:center;font-size:0.85rem;margin-top:5px;color:#f44336;">
‚ö†Ô∏è –í–ª–∞–¥–µ–ª–µ—Ü –Ω–µ —É–∫–∞–∑–∞–Ω (—Å–æ–∑–¥–∞–Ω–æ –∞–¥–º–∏–Ω–æ–º)
</p>
<% } %>

<!-- –ö–∞—Ç–µ–≥–æ—Ä–∏—è -->
<% if (b.category) { %>
<p class="muted" style="text-align:center;font-size:0.85rem;margin-top:5px;">
üìÅ <%= b.category %>
</p>
<% } %>

<div class="product-actions" style="flex-direction:column;gap:6px;margin-top:10px;">
<!-- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞/–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ -->
<button class="btn small toggle-visibility-btn status-<%= b.status %>"
data-id="<%= b._id %>"
data-status="<%= b.status %>"
data-type="banner">
<%= (b.status === 'approved' || b.status === 'published') ? 'üö´ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å' : '‚úÖ –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å' %>
</button>

<a class="btn small outline" href="/admin/banners/<%= b._id %>/edit">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>

<form method="POST" action="/admin/banners/<%= b._id %>/delete" style="display:inline" onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å –±–∞–Ω–Ω–µ—Ä?');">
<input type="hidden" name="_csrf" value="<%= typeof csrfToken !== 'undefined' ? csrfToken : '' %>">
<button type="submit" class="btn small outline" style="width:100%;">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
</form>

<% if (b.link) { %>
<a class="btn small outline" href="<%= b.link %>" target="_blank" rel="noopener">üîó –°—Å—ã–ª–∫–∞</a>
<% } %>
<% if (b.video_url) { %>
<button class="btn small outline" data-video="<%= b.video_url %>">‚ñ∂Ô∏è –í–∏–¥–µ–æ</button>
<% } %>
</div>

<!-- –†–µ–π—Ç–∏–Ω–≥ (—Ç–æ–ª—å–∫–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ) -->
<div class="product-rating" data-id="<%= b._id %>" style="margin-top:10px;">
<button class="btn icon" type="button" disabled aria-label="–õ–∞–π–∫">‚ñ≤</button>
<span class="result"><%= (b.rating_up || 0) - (b.rating_down || 0) %></span>
<button class="btn icon" type="button" disabled aria-label="–î–∏–∑–ª–∞–π–∫">‚ñº</button>
<span class="votes">(<%= (b.rating_up || 0) + (b.rating_down || 0) %> –≥–æ–ª–æ—Å–æ–≤)</span>
</div>
</div>
</div>
<% }) %>
</div>
<% } else { %>
<p class="empty-state">–ü–æ–∫–∞ –Ω–µ—Ç –±–∞–Ω–Ω–µ—Ä–æ–≤</p>
<% } %>
</section>
</main>

<footer class="footer">
  <p></p>
</footer>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è -->
<div id="rejectModal" class="modal" aria-hidden="true" style="display:none;">
<div class="modal-content" role="dialog" aria-modal="true" aria-label="–û—Ç–∫–ª–æ–Ω–∏—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É">
<button class="close" data-close-reject aria-label="–ó–∞–∫—Ä—ã—Ç—å">&times;</button>
<h3>–û—Ç–∫–ª–æ–Ω–∏—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É</h3>
<form id="rejectForm">
<textarea name="reason" placeholder="–ü—Ä–∏—á–∏–Ω–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)" rows="4" style="width:100%;padding:8px;border-radius:6px;border:1px solid #444;background:#2b2b2b;color:#fff;resize:vertical;"></textarea>
<button type="submit" class="btn" style="margin-top:10px;">–û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>
</form>
</div>
</div>

<!-- FIX: –ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π overlay –¥–ª—è YouTube –≤–∏–¥–µ–æ -->
<div id="videoOverlay" class="video-overlay" aria-hidden="true" style="display:none;">
<div class="video-overlay-container">
<button class="video-overlay-close" data-close-video aria-label="–ó–∞–∫—Ä—ã—Ç—å –≤–∏–¥–µ–æ">&times;</button>
<div class="video-overlay-iframe-container" id="videoIframeContainer">
<!-- FIX: iframe —Å–æ–∑–¥–∞–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –ø–æ –∫–ª–∏–∫—É -->
</div>
</div>
</div>

<!-- –ü–µ—Ä–µ–¥–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Socket.IO –Ω–∞ –∫–ª–∏–µ–Ω—Ç -->
 <!-- Bootstrap script for safe EJS ‚Üí JS data transfer -->
  <script src="/utils/bootstrap.js"></script>
  <script>
    // Safe initialization of global variables
    window.AppBootstrap.init(<%- JSON.stringify({
      isAuth: true,
      isAdmin: true,
      socketIoAvailable: typeof socket_io_available !== 'undefined' ? socket_io_available : false,
      userRole: typeof userRole !== 'undefined' ? userRole : 'admin'
    }) %>);
  </script>

<script>
// –ì–ª–æ–±–∞–ª—å–Ω—ã–π CSRF —Ç–æ–∫–µ–Ω
const CSRF_TOKEN = "<%- typeof csrfToken !== 'undefined' ? csrfToken : '' %>";

// Helper —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è POST –∑–∞–ø—Ä–æ—Å–æ–≤ —Å CSRF
async function postJSON(url, data = {}) {
return fetch(url, {
method: "POST",
headers: {
"Content-Type": "application/json",
"X-CSRF-Token": CSRF_TOKEN
},
body: JSON.stringify(data)
});
}

document.addEventListener("DOMContentLoaded", () => {
console.log("üîß –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏");

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã—Ö–æ–¥–∞
const logoutForm = document.getElementById("logoutForm");
if (logoutForm) {
logoutForm.addEventListener("submit", async (e) => {
e.preventDefault();
e.stopPropagation();
if (!confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏?")) return;
try {
const res = await fetch("/logout", { method: "POST" });
if (res.ok) {
window.location.href = "/";
}
} catch (err) {
console.error("–û—à–∏–±–∫–∞ –≤—ã—Ö–æ–¥–∞:", err);
window.location.href = "/";
}
});
}
}

// –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞/–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–∞—Ä—Ç–æ—á–µ–∫ (—Ç–æ–≤–∞—Ä—ã, —É—Å–ª—É–≥–∏, –±–∞–Ω–Ω–µ—Ä—ã)
const toggleBtns = document.querySelectorAll(".toggle-visibility-btn");
toggleBtns.forEach(btn => {
btn.addEventListener("click", async (e) => {
e.preventDefault();
e.stopPropagation();
const id = btn.getAttribute("data-id");
const currentStatus = btn.getAttribute("data-status");
const itemType = btn.getAttribute("data-type") || "product";
const action = (currentStatus === "approved" || currentStatus === "published") ? "–∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å" : "—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å";
if (!confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ ${action} —ç—Ç—É –∫–∞—Ä—Ç–æ—á–∫—É?`)) return;

try {
let endpoint;
if (itemType === "banner") {
endpoint = `/admin/banners/${id}/toggle-visibility`;
} else if (itemType === "service") {
endpoint = `/admin/services/${id}/toggle-visibility`;
} else {
endpoint = `/admin/products/${id}/toggle-visibility`;
}

const res = await postJSON(endpoint);
const data = await res.json();
if (data.success) {
alert(data.message || "–°—Ç–∞—Ç—É—Å –∫–∞—Ä—Ç–æ—á–∫–∏ –∏–∑–º–µ–Ω–µ–Ω");
location.reload();
} else {
alert("–û—à–∏–±–∫–∞: " + (data.message || "–ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å"));
}
} catch (err) {
console.error("‚ùå –û—à–∏–±–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏:", err);
alert("–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: " + err.message);
}
});
});
});

// –ú–æ–¥–µ—Ä–∞—Ü–∏—è: –æ–¥–æ–±—Ä–µ–Ω–∏–µ
const approveBtns = document.querySelectorAll(".approve-btn");
approveBtns.forEach(btn => {
btn.addEventListener("click", async (e) => {
e.preventDefault();
e.stopPropagation();
const id = btn.getAttribute("data-id");
if (!confirm("–û–¥–æ–±—Ä–∏—Ç—å —ç—Ç—É –∫–∞—Ä—Ç–æ—á–∫—É?")) return;
try {
const itemType = btn.getAttribute("data-type") || "product";
let endpoint;
if (itemType === "banner") {
endpoint = `/admin/banners/${id}/approve`;
} else if (itemType === "service") {
endpoint = `/admin/services/${id}/approve`;
} else {
endpoint = `/admin/products/${id}/approve`;
}
const res = await postJSON(endpoint);
const data = await res.json();
if (data.success) {
alert("–ö–∞—Ä—Ç–æ—á–∫–∞ –æ–¥–æ–±—Ä–µ–Ω–∞!");
location.reload();
} else {
alert("–û—à–∏–±–∫–∞: " + (data.message || "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞"));
}
} catch (err) {
console.error("‚ùå –û—à–∏–±–∫–∞ –æ–¥–æ–±—Ä–µ–Ω–∏—è:", err);
alert("–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: " + err.message);
}
});
});
});

// –ú–æ–¥–µ—Ä–∞—Ü–∏—è: –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ
const rejectModal = document.getElementById("rejectModal");
const rejectForm = document.getElementById("rejectForm");
let currentRejectId = null;
let currentRejectType = "product";

document.querySelectorAll(".reject-btn").forEach(btn => {
btn.addEventListener("click", () => {
currentRejectId = btn.getAttribute("data-id");
currentRejectType = btn.getAttribute("data-type") || "product";
rejectModal.style.display = "block";
rejectModal.setAttribute("aria-hidden", "false");
});
});

const closeRejectBtn = document.querySelector("[data-close-reject]");
if (closeRejectBtn) {
closeRejectBtn.addEventListener("click", () => {
rejectModal.style.display = "none";
rejectModal.setAttribute("aria-hidden", "true");
rejectForm && rejectForm.reset();
currentRejectId = null;
currentRejectType = "product";
});
}

if (rejectForm) {
rejectForm.addEventListener("submit", async (e) => {
e.preventDefault();
if (!currentRejectId) return;
const reason = new FormData(rejectForm).get("reason") || "–ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø—Ä–∞–≤–∏–ª–∞–º –ø—É–±–ª–∏–∫–∞—Ü–∏–∏";
try {
let rejectEndpoint;
if (currentRejectType === "banner") {
rejectEndpoint = `/admin/banners/${currentRejectId}/reject`;
} else if (currentRejectType === "service") {
rejectEndpoint = `/admin/services/${currentRejectId}/reject`;
} else {
rejectEndpoint = `/admin/products/${currentRejectId}/reject`;
}
const res = await postJSON(rejectEndpoint, { reason });
const data = await res.json();
if (data.success) {
alert("–ö–∞—Ä—Ç–æ—á–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞");
location.reload();
} else {
alert("–û—à–∏–±–∫–∞: " + (data.message || "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞"));
}
} catch (err) {
console.error("–û—à–∏–±–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è:", err);
alert("–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: " + err.message);
}
});
}
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã —Å–æ–∑–¥–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ –∞–¥–º–∏–Ω–æ–º
const adminCreateForm = document.getElementById('adminCreateProductForm');
const adminCreateMsg = document.getElementById('adminCreateMsg');
const adminImagesInput = document.getElementById('adminImages');
const adminImagePreview = document.getElementById('adminImagePreview');

if (adminCreateForm) {
adminCreateForm.addEventListener('submit', async function(e) {
e.preventDefault();

if (adminImagesInput && adminImagesInput.files.length > 5) {
adminCreateMsg.textContent = '–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π: 5';
adminCreateMsg.style.color = '#b00020';
return;
}

adminCreateMsg.textContent = '–û—Ç–ø—Ä–∞–≤–∫–∞...';
adminCreateMsg.style.color = '#666';

const formData = new FormData(adminCreateForm);

try {
const res = await fetch('/admin/products', {
method: 'POST',
body: formData
});

const contentType = res.headers.get("content-type");
if (contentType && contentType.includes("application/json")) {
const data = await res.json();
if (data.success) {
adminCreateMsg.textContent = '–¢–æ–≤–∞—Ä —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!';
adminCreateMsg.style.color = 'green';
adminCreateForm.reset();
adminImagePreview.innerHTML = '';
adminImagePreview.style.display = 'none';
setTimeout(() => {
location.reload();
}, 1500);
} else {
adminCreateMsg.textContent = data.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞';
adminCreateMsg.style.color = '#b00020';
}
}
} catch (err) {
adminCreateMsg.textContent = '–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + err.message;
adminCreateMsg.style.color = '#b00020';
}
});
}
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã —Å–æ–∑–¥–∞–Ω–∏—è –±–∞–Ω–Ω–µ—Ä–∞ –∞–¥–º–∏–Ω–æ–º
const adminCreateBannerForm = document.getElementById('adminCreateBannerForm');
const adminCreateBannerMsg = document.getElementById('adminCreateBannerMsg');
const adminBannerImagesInput = document.getElementById('adminBannerImages');
const adminBannerImagePreview = document.getElementById('adminBannerImagePreview');

if (adminCreateBannerForm) {
adminCreateBannerForm.addEventListener('submit', async function(e) {
e.preventDefault();

if (adminBannerImagesInput && adminBannerImagesInput.files.length > 5) {
adminCreateBannerMsg.textContent = '–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π: 5';
adminCreateBannerMsg.style.color = '#b00020';
return;
}

adminCreateBannerMsg.textContent = '–û—Ç–ø—Ä–∞–≤–∫–∞...';
adminCreateBannerMsg.style.color = '#666';

const formData = new FormData(adminCreateBannerForm);

try {
const res = await fetch('/admin/banners', {
method: 'POST',
body: formData
});

const contentType = res.headers.get("content-type");
if (contentType && contentType.includes("application/json")) {
const data = await res.json();
if (data.success) {
adminCreateBannerMsg.textContent = '‚úÖ –ë–∞–Ω–Ω–µ—Ä —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!';
adminCreateBannerMsg.style.color = 'green';
adminCreateBannerForm.reset();
adminBannerImagePreview.innerHTML = '';
adminBannerImagePreview.style.display = 'none';
setTimeout(() => {
location.reload();
}, 1500);
} else {
adminCreateBannerMsg.textContent = data.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –±–∞–Ω–Ω–µ—Ä–∞';
adminCreateBannerMsg.style.color = '#b00020';
}
}
} catch (err) {
adminCreateBannerMsg.textContent = '–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + err.message;
adminCreateBannerMsg.style.color = '#b00020';
}
});
}
}

// –ü—Ä–µ–≤—å—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è –∞–¥–º–∏–Ω-—Ñ–æ—Ä–º—ã –±–∞–Ω–Ω–µ—Ä–æ–≤
if (adminBannerImagesInput && adminBannerImagePreview) {
adminBannerImagesInput.addEventListener('change', function(e) {
const files = Array.from(e.target.files);
const maxFiles = 5;

if (files.length > maxFiles) {
alert(`–ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –Ω–µ –±–æ–ª–µ–µ ${maxFiles} –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π`);
e.target.value = '';
adminBannerImagePreview.innerHTML = '';
adminBannerImagePreview.style.display = 'none';
return;
}

adminBannerImagePreview.innerHTML = '';

if (files.length === 0) {
adminBannerImagePreview.style.display = 'none';
return;
}

adminBannerImagePreview.style.display = 'grid';
adminBannerImagePreview.style.gridTemplateColumns = 'repeat(auto-fill, minmax(100px, 1fr))';
adminBannerImagePreview.style.gap = '10px';
adminBannerImagePreview.style.marginTop = '10px';

files.forEach((file) => {
if (file.size > 5 * 1024 * 1024) {
alert(`–§–∞–π–ª "${file.name}" —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π (–º–∞–∫—Å–∏–º—É–º 5MB)`);
return;
}

const reader = new FileReader();
reader.onload = function(e) {
const div = document.createElement('div');
div.style.position = 'relative';
div.style.aspectRatio = '1';
div.style.overflow = 'hidden';
div.style.borderRadius = '8px';
div.style.border = '2px solid #ddd';

const img = document.createElement('img');
img.src = e.target.result;
img.style.width = '100%';
img.style.height = '100%';
img.style.objectFit = 'cover';

div.appendChild(img);
adminBannerImagePreview.appendChild(div);
};
reader.readAsDataURL(file);
});
});
}
}

// –ü—Ä–µ–≤—å—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è –∞–¥–º–∏–Ω-—Ñ–æ—Ä–º—ã
if (adminImagesInput && adminImagePreview) {
adminImagesInput.addEventListener('change', function(e) {
const files = Array.from(e.target.files);
const maxFiles = 5;

if (files.length > maxFiles) {
alert(`–ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –Ω–µ –±–æ–ª–µ–µ ${maxFiles} –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π`);
e.target.value = '';
adminImagePreview.innerHTML = '';
adminImagePreview.style.display = 'none';
return;
}

adminImagePreview.innerHTML = '';

if (files.length === 0) {
adminImagePreview.style.display = 'none';
return;
}

adminImagePreview.style.display = 'grid';

files.forEach((file) => {
if (file.size > 5 * 1024 * 1024) {
alert(`–§–∞–π–ª "${file.name}" —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π (–º–∞–∫—Å–∏–º—É–º 5MB)`);
return;
}

const reader = new FileReader();
reader.onload = function(e) {
const div = document.createElement('div');
div.style.position = 'relative';
div.style.aspectRatio = '1';
div.style.overflow = 'hidden';
div.style.borderRadius = '8px';
div.style.border = '2px solid #ddd';

const img = document.createElement('img');
img.src = e.target.result;
img.style.width = '100%';
img.style.height = '100%';
img.style.objectFit = 'cover';

div.appendChild(img);
adminImagePreview.appendChild(div);
};
reader.readAsDataURL(file);
});
});
}
});
}

// –ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π (—Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –∏–∑ cabinet.ejs)
const hierarchicalCategories = {
  "home": {
    label: "üè† –ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å –∏ –¥–æ–º",
    children: {
      "apartments": {
        label: "–ö–≤–∞—Ä—Ç–∏—Ä—ã",
        children: {
          "sale": { label: "–ü—Ä–æ–¥–∞–∂–∞" },
          "rent": { label: "–ê—Ä–µ–Ω–¥–∞" },
          "new_buildings": { label: "–ù–æ–≤–æ—Å—Ç—Ä–æ–π–∫–∏" }
        }
      },
      "houses": { label: "–î–æ–º–∞ –∏ –∫–æ—Ç—Ç–µ–¥–∂–∏" },
      "commercial": { label: "–ö–æ–º–º–µ—Ä—á–µ—Å–∫–∞—è –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å" },
      "land": { label: "–ó–µ–º–µ–ª—å–Ω—ã–µ —É—á–∞—Å—Ç–∫–∏" },
      "renovation": { label: "–†–µ–º–æ–Ω—Ç –∏ –¥–∏–∑–∞–π–Ω –∏–Ω—Ç–µ—Ä—å–µ—Ä–∞" },
      "smart_home": { label: "–£–º–Ω—ã–π –¥–æ–º –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è" },
      "garden": { label: "–°–∞–¥ –∏ –æ–≥–æ—Ä–æ–¥" },
      "furniture": { label: "–ú–µ–±–µ–ª—å –∏ –∏–Ω—Ç–µ—Ä—å–µ—Ä" }
    }
  },
  "auto": {
    label: "üöó –ê–≤—Ç–æ–º–æ–±–∏–ª–∏ –∏ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç",
    children: {
      "cars": {
        label: "–ê–≤—Ç–æ–º–æ–±–∏–ª–∏",
        children: {
          "new": { label: "–ù–æ–≤—ã–µ" },
          "used": { label: "–ë/—É" },
          "electric": { label: "–≠–ª–µ–∫—Ç—Ä–æ–º–æ–±–∏–ª–∏ –∏ –∑–∞—Ä—è–¥–Ω—ã–µ —Å—Ç–∞–Ω—Ü–∏–∏" }
        }
      },
      "motorcycles": { label: "–ú–æ—Ç–æ—Ü–∏–∫–ª—ã –∏ —Å–∫—É—Ç–µ—Ä—ã" },
      "bicycles": { label: "–í–µ–ª–æ—Å–∏–ø–µ–¥—ã –∏ —ç–ª–µ–∫—Ç—Ä–æ—Å–∞–º–æ–∫–∞—Ç—ã" },
      "parts": { label: "–ó–∞–ø—á–∞—Å—Ç–∏ –∏ –∞–∫—Å–µ—Å—Å—É–∞—Ä—ã" },
      "electronics": {
        label: "–ê–≤—Ç–æ—ç–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞",
        children: {
          "navigators": { label: "–ù–∞–≤–∏–≥–∞—Ç–æ—Ä—ã" },
          "recorders": { label: "–í–∏–¥–µ–æ—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã" },
          "multimedia": { label: "–ú—É–ª—å—Ç–∏–º–µ–¥–∏–∞" }
        }
      },
      "service": { label: "–°–µ—Ä–≤–∏—Å –∏ —Ä–µ–º–æ–Ω—Ç" },
      "carsharing": { label: "–ê—Ä–µ–Ω–¥–∞ –∏ –∫–∞—Ä—à–µ—Ä–∏–Ω–≥" },
      "tuning": { label: "–¢—é–Ω–∏–Ω–≥ –∏ –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è" }
    }
  },
  "electronics": {
    label: "‚ö° –≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞ –∏ —Ç–µ—Ö–Ω–∏–∫–∞",
    children: {
      "phones": { label: "–°–º–∞—Ä—Ç—Ñ–æ–Ω—ã –∏ –∞–∫—Å–µ—Å—Å—É–∞—Ä—ã" },
      "computers": { label: "–ö–æ–º–ø—å—é—Ç–µ—Ä—ã –∏ –ø–µ—Ä–∏—Ñ–µ—Ä–∏—è" },
      "appliances": {
        label: "–ë—ã—Ç–æ–≤–∞—è —Ç–µ—Ö–Ω–∏–∫–∞",
        children: {
          "large": { label: "–ö—Ä—É–ø–Ω–∞—è" },
          "small": { label: "–ú–µ–ª–∫–∞—è" }
        }
      },
      "audio_video": { label: "–ê—É–¥–∏–æ –∏ –≤–∏–¥–µ–æ —Ç–µ—Ö–Ω–∏–∫–∞" },
      "gaming": {
        label: "–ò–≥—Ä–æ–≤–∞—è —ç–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞",
        children: {
          "consoles": { label: "–ö–æ–Ω—Å–æ–ª–∏" },
          "vr_ar": { label: "VR/AR —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞" },
          "gaming_peripherals": { label: "–ì–µ–π–º–µ—Ä—Å–∫–∞—è –ø–µ—Ä–∏—Ñ–µ—Ä–∏—è" }
        }
      },
      "robotics": { label: "–†–æ–±–æ—Ç–æ—Ç–µ—Ö–Ω–∏–∫–∞ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –±—ã—Ç–∞" },
      "drones": { label: "–î—Ä–æ–Ω—ã –∏ –∫–≤–∞–¥—Ä–æ–∫–æ–ø—Ç–µ—Ä—ã" }
    }
  },
  "beauty": {
    label: "üíÑ –ö—Ä–∞—Å–æ—Ç–∞ –∏ –∑–¥–æ—Ä–æ–≤—å–µ",
    children: {
      "cosmetics": { label: "–ö–æ—Å–º–µ—Ç–∏–∫–∞ –∏ —É—Ö–æ–¥" },
      "medical": { label: "–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ —Ç–æ–≤–∞—Ä—ã" },
      "fitness_trackers": { label: "–§–∏—Ç–Ω–µ—Å‚Äë–≥–∞–¥–∂–µ—Ç—ã –∏ —Ç—Ä–µ–∫–µ—Ä—ã" },
      "biohacking": { label: "–ë–∏–æ—Ö–∞–∫–∏–Ω–≥ –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –ø–∏—Ç–∞–Ω–∏–µ" },
      "nutrition": { label: "–°–ø–æ—Ä—Ç–∏–≤–Ω–æ–µ –ø–∏—Ç–∞–Ω–∏–µ –∏ –¥–æ–±–∞–≤–∫–∏" },
      "services": { label: "–£—Å–ª—É–≥–∏ (—Å–∞–ª–æ–Ω—ã, —Ç–µ–ª–µ–º–µ–¥–∏—Ü–∏–Ω–∞, –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏)" }
    }
  },
  "household": {
    label: "üõí –î–ª—è –¥–æ–º–∞ –∏ –±—ã—Ç–∞",
    children: {
      "textiles": { label: "–¢–µ–∫—Å—Ç–∏–ª—å –∏ –¥–µ–∫–æ—Ä" },
      "kitchen": { label: "–ö—É—Ö–æ–Ω–Ω—ã–µ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏" },
      "household_items": { label: "–ë—ã—Ç–æ–≤—ã–µ –º–µ–ª–æ—á–∏" },
      "lighting": { label: "–û—Å–≤–µ—â–µ–Ω–∏–µ –∏ —ç–ª–µ–∫—Ç—Ä–∏–∫–∞" },
      "plumbing": {
        label: "–°–∞–Ω—Ç–µ—Ö–Ω–∏–∫–∞",
        children: {
          "mixers": { label: "–°–º–µ—Å–∏—Ç–µ–ª–∏" },
          "showers": { label: "–î—É—à–µ–≤—ã–µ" },
          "pipes_fittings": { label: "–¢—Ä—É–±—ã –∏ —Ñ–∏—Ç–∏–Ω–≥–∏" },
          "water_supply": { label: "–°–∏—Å—Ç–µ–º—ã –≤–æ–¥–æ—Å–Ω–∞–±–∂–µ–Ω–∏—è" }
        }
      }
    }
  },
  "pets": {
    label: "üêæ –ü–∏—Ç–æ–º—Ü—ã",
    children: {
      "food": { label: "–ö–æ—Ä–º–∞ –∏ –ª–∞–∫–æ–º—Å—Ç–≤–∞" },
      "accessories": { label: "–ê–∫—Å–µ—Å—Å—É–∞—Ä—ã –∏ –∏–≥—Ä—É—à–∫–∏" },
      "smart_devices": { label: "–£–º–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –¥–ª—è –∂–∏–≤–æ—Ç–Ω—ã—Ö" },
      "veterinary": { label: "–í–µ—Ç–µ—Ä–∏–Ω–∞—Ä–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã –∏ —É—Å–ª—É–≥–∏" }
    }
  },
  "hobbies": {
    label: "üé® –•–æ–±–±–∏, –¥–æ—Å—É–≥ –∏ DIY",
    children: {
      "crafts": { label: "–ú–∞—Ç–µ—Ä–∏–∞–ª—ã –¥–ª—è —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–∞" },
      "electronics_diy": { label: "3D‚Äë–ø–µ—á–∞—Ç—å –∏ —ç–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞ –¥–ª—è —Å–±–æ—Ä–∫–∏" },
      "stem": { label: "STEM‚Äë–Ω–∞–±–æ—Ä—ã –∏ —Ä–∞–∑–≤–∏–≤–∞—é—â–∏–µ –∏–≥—Ä—É—à–∫–∏" },
      "instruments": { label: "–ú—É–∑—ã–∫–∞–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã" },
      "tourism": { label: "–¢—É—Ä–∏–∑–º –∏ –∞–∫—Ç–∏–≤–Ω—ã–π –æ—Ç–¥—ã—Ö" }
    }
  },
  "eco": {
    label: "üåç –≠–∫–æ‚Äë—Ç–æ–≤–∞—Ä—ã –∏ —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å",
    children: {
      "solar": { label: "–°–æ–ª–Ω–µ—á–Ω—ã–µ –ø–∞–Ω–µ–ª–∏ –∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è" },
      "efficient": { label: "–≠–Ω–µ—Ä–≥–æ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞" },
      "materials": { label: "–ü–µ—Ä–µ—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º—ã–µ –∏ –±–∏–æ—Ä–∞–∑–ª–∞–≥–∞–µ–º—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã" },
      "transport": { label: "–≠–ª–µ–∫—Ç—Ä–æ—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç" }
    }
  },
  "digital": {
    label: "üíª –¶–∏—Ñ—Ä–æ–≤—ã–µ —Ç–æ–≤–∞—Ä—ã –∏ —É—Å–ª—É–≥–∏",
    children: {
      "licenses": { label: "–õ–∏—Ü–µ–Ω–∑–∏–∏ –∏ –ø–æ–¥–ø–∏—Å–∫–∏" },
      "courses": { label: "–û–Ω–ª–∞–π–Ω‚Äë–∫—É—Ä—Å—ã –∏ –æ–±—É—á–µ–Ω–∏–µ" },
      "microservices": { label: "–ú–∏–∫—Ä–æ‚Äë—É—Å–ª—É–≥–∏ –∏ —Ñ—Ä–∏–ª–∞–Ω—Å" },
      "content": { label: "–¶–∏—Ñ—Ä–æ–≤–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç (—à–∞–±–ª–æ–Ω—ã, –º–µ–¥–∏–∞, NFT)" }
    }
  },
  "additional": {
    label: "üõçÔ∏è –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –±–ª–æ–∫–∏",
    children: {
      "finance": { label: "–§–∏–Ω–∞–Ω—Å—ã –∏ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏" },
      "education": { label: "–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∏ –∫–∞—Ä—å–µ—Ä–∞" },
      "food_delivery": { label: "–ü—Ä–æ–¥—É–∫—Ç—ã –ø–∏—Ç–∞–Ω–∏—è –∏ –¥–æ—Å—Ç–∞–≤–∫–∞" },
      "sports": { label: "–°–ø–æ—Ä—Ç –∏ –∞–∫—Ç–∏–≤–Ω—ã–π –æ–±—Ä–∞–∑ –∂–∏–∑–Ω–∏" },
      "ar_vr": { label: "AR/VR‚Äë–∫–∞—Ç–µ–≥–æ—Ä–∏–∏" },
      "remote_work": { label: "–£–¥–∞–ª—ë–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –∏ –æ—Ñ–∏—Å" }
    }
  }
};

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–æ–≥–æ –≤—ã–±–æ—Ä–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
function buildHierarchicalSelector(parentElement, categories, level = 0, parentPath = '', currentValue = '') {
  parentElement.innerHTML = '';
  
  // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É "–ù–∞–∑–∞–¥ –∫ –æ—Å–Ω–æ–≤–Ω—ã–º –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º", –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ –ø–µ—Ä–≤—ã–π —É—Ä–æ–≤–µ–Ω—å
  if (level > 0) {
    const backButton = document.createElement('button');
    backButton.type = 'button';
    backButton.textContent = '‚Üê –ù–∞–∑–∞–¥ –∫ –æ—Å–Ω–æ–≤–Ω—ã–º –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º';
    backButton.className = 'btn small outline';
    backButton.style.marginBottom = '10px';
    backButton.onclick = function() {
      // –°–∫—Ä—ã–≤–∞–µ–º –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏–π —Å–µ–ª–µ–∫—Ç–æ—Ä –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π
      document.getElementById('adminHierarchicalCategorySelector').style.display = 'none';
      document.getElementById('adminCategorySelect').style.display = 'block';
      document.getElementById('adminSubcategorySelector').style.display = 'none';
    };
    parentElement.appendChild(backButton);
  }

  const container = document.createElement('div');
  container.style.marginLeft = level * 20 + 'px';
  container.style.marginTop = '10px';
  
  const select = document.createElement('select');
  select.className = 'category-select';
  select.setAttribute('data-level', level);
  select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ ' + (level === 0 ? '–æ—Å–Ω–æ–≤–Ω—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é' : '–ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é') + '</option>';
  
  for (const [key, value] of Object.entries(categories)) {
    const option = document.createElement('option');
    const fullKey = parentPath ? `${parentPath}.${key}` : key;
    option.value = fullKey;
    option.textContent = value.label;
    
    // –ï—Å–ª–∏ —ç—Ç–æ —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏–ª–∏ –µ–≥–æ —á–∞—Å—Ç—å, –¥–µ–ª–∞–µ–º –µ–≥–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–º
    if (currentValue === fullKey || currentValue.startsWith(fullKey + '.')) {
      option.selected = true;
    }
    
    select.appendChild(option);
  }
  
  container.appendChild(select);
  parentElement.appendChild(container);
  
  select.addEventListener('change', function() {
    const selectedValue = this.value;
    if (selectedValue) {
      // –û–±–Ω–æ–≤–ª—è–µ–º —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
      document.querySelector('input[name="category"], select[name="category"]').value = selectedValue;
      
      // –£–¥–∞–ª—è–µ–º –≤—Å–µ –¥–æ—á–µ—Ä–Ω–∏–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã
      const childSelectors = parentElement.querySelectorAll(`.category-select[data-level]:not([data-level="${level}"])`);
      childSelectors.forEach(child => {
        if (parseInt(child.getAttribute('data-level')) > level) {
          child.closest('div').remove();
        }
      });
      
      // –ï—Å–ª–∏ —É –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –µ—Å—Ç—å –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏, —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π —Å–µ–ª–µ–∫—Ç–æ—Ä
      const categoryPath = this.value.split('.');
      let currentCategory = hierarchicalCategories;
      
      for (const path of categoryPath) {
        if (currentCategory && currentCategory[path]) {
          currentCategory = currentCategory[path].children;
        } else {
          currentCategory = null;
          break;
        }
      }
      
      if (currentCategory) {
        buildHierarchicalSelector(parentElement, currentCategory, level + 1, selectedValue, '');
      }
    }
  });
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –¥–ª—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
const adminCategorySelect = document.getElementById('adminCategorySelect');
const adminSubcategorySelector = document.getElementById('adminSubcategorySelector');
const adminSubcategorySelect = document.getElementById('adminSubcategorySelect');
const adminBackToBlocksBtn = document.getElementById('adminBackToBlocks');
const adminHierarchicalCategorySelector = document.getElementById('adminHierarchicalCategorySelector');
const adminBackToMainBtn = document.getElementById('adminBackToMain');

let adminCurrentCategories = [];

// –ó–∞–≥—Ä—É–∂–∞–µ–º –±–ª–æ–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
loadAdminCategoryBlocks();

async function loadAdminCategoryBlocks() {
  try {
    const response = await fetch('/api/categories/tree/all');
    const data = await response.json();

    if (data.success && data.categories) {
      adminCurrentCategories = data.categories;
      renderAdminCategoryBlocks(data.categories);
    } else {
      console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–ª–æ–∫–æ–≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–π:', data.message);
    }
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –±–ª–æ–∫–æ–≤:', error);
  }
}

function renderAdminCategoryBlocks(blocks) {
  if (!adminCategorySelect) return;

  // –û—á–∏—â–∞–µ–º —Å–µ–ª–µ–∫—Ç, –æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—É—é –æ–ø—Ü–∏—é
 adminCategorySelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>';

  blocks.forEach(block => {
    const option = document.createElement('option');
    option.value = block._id;
    option.textContent = `${block.icon || ''} ${block.name}`;
    adminCategorySelect.appendChild(option);
  });
}

async function loadAdminSubcategories(blockId, blockName) {
  try {
    const response = await fetch(`/api/categories/children/${blockId}`);
    const data = await response.json();

    if (data.success && data.categories) {
      renderAdminSubcategories(data.categories, blockName);
    } else {
      console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π:', data.message);
    }
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π:', error);
  }
}

function renderAdminSubcategories(subcategories, blockName) {
  if (!adminSubcategorySelector || !adminSubcategorySelect) return;

  adminSubcategorySelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>';

  subcategories.forEach(sub => {
    const option = document.createElement('option');
    option.value = sub._id;
    option.textContent = `${sub.icon || ''} ${sub.name}`;
    adminSubcategorySelect.appendChild(option);
  });

  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π
  adminSubcategorySelector.style.display = 'block';
}

function hideAdminSubcategories() {
  if (adminSubcategorySelector) {
    adminSubcategorySelector.style.display = 'none';
  }
}

function showAdminHierarchicalSelector() {
  if (adminCategorySelect) adminCategorySelect.style.display = 'none';
  if (adminSubcategorySelector) adminSubcategorySelector.style.display = 'none';
  if (adminHierarchicalCategorySelector) {
    adminHierarchicalCategorySelector.style.display = 'block';
    // –°–æ–∑–¥–∞–µ–º –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏–π —Å–µ–ª–µ–∫—Ç–æ—Ä
    buildHierarchicalSelector(adminHierarchicalCategorySelector, hierarchicalCategories, 0, '');
  }
}

function hideAdminHierarchicalSelector() {
  if (adminHierarchicalCategorySelector) {
    adminHierarchicalCategorySelector.style.display = 'none';
  }
  if (adminCategorySelect) adminCategorySelect.style.display = 'block';
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ –±–ª–æ–∫–∞
if (adminCategorySelect) {
  adminCategorySelect.addEventListener('change', function() {
    const selectedBlockId = this.value;
    if (selectedBlockId) {
      // –ù–∞—Ö–æ–¥–∏–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π –±–ª–æ–∫
      const selectedBlock = adminCurrentCategories.find(block => block._id === selectedBlockId);
      if (selectedBlock) {
        loadAdminSubcategories(selectedBlockId, selectedBlock.name);
      }
    } else {
      hideAdminSubcategories();
    }
  });
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏
if (adminSubcategorySelect) {
  adminSubcategorySelect.addEventListener('change', function() {
    const selectedCategoryId = this.value;
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–æ—Ä–º—ã
    if (selectedCategoryId) {
      adminCategorySelect.value = selectedCategoryId;
    }
  });
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥ –∫ –±–ª–æ–∫–∞–º"
if (adminBackToBlocksBtn) {
  adminBackToBlocksBtn.addEventListener('click', function(e) {
    e.stopPropagation();
    hideAdminSubcategories();
    adminCategorySelect.value = '';
  });
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥ –∫ –æ—Å–Ω–æ–≤–Ω—ã–º –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º" (–¥–ª—è –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–æ–≥–æ –≤—ã–±–æ—Ä–∞)
if (adminBackToMainBtn) {
  adminBackToMainBtn.addEventListener('click', function(e) {
    e.stopPropagation();
    hideAdminHierarchicalSelector();
    if (adminCategorySelect) adminCategorySelect.style.display = 'block';
  });
}

// –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫—É –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤ –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º
const adminHierarchicalToggleBtn = document.createElement('button');
adminHierarchicalToggleBtn.type = 'button';
adminHierarchicalToggleBtn.textContent = '–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä';
adminHierarchicalToggleBtn.className = 'btn small outline';
adminHierarchicalToggleBtn.style.marginTop = '10px';
adminHierarchicalToggleBtn.style.display = 'block';

// –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –ø–æ—Å–ª–µ —Å–µ–ª–µ–∫—Ç–æ—Ä–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
if (adminCategorySelect) {
  adminCategorySelect.parentNode.appendChild(adminHierarchicalToggleBtn);
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤ –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º
if (adminHierarchicalToggleBtn) {
  adminHierarchicalToggleBtn.addEventListener('click', function() {
    adminCategorySelect.value = ''; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–±–æ—Ä –æ–±—ã—á–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    hideAdminSubcategories(); // –°–∫—Ä—ã–≤–∞–µ–º –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    showAdminHierarchicalSelector(); // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏–π —Å–µ–ª–µ–∫—Ç–æ—Ä
    adminHierarchicalToggleBtn.style.display = 'none'; // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è
  });
}
</script>



<style>
/* Status styles for product cards */
.status-approved {
border: 2px solid #4caf50;
}
.status-rejected {
opacity: 0.7;
border: 2px solid #f44336;
}
.status-pending {
border: 2px solid #ff9800;
}

/* Status styles for toggle buttons */
.toggle-visibility-btn.status-approved {
background:#f44336;
color:#fff;
}
.toggle-visibility-btn.status-rejected {
background:#4caf50;
color:#fff;
}
.toggle-visibility-btn.status-pending {
background:#4caf50;
color:#fff;
}

.modal {
display: none;
position: fixed;
z-index: 2000;
left: 0;
top: 0;
width: 100%;
height: 100%;
background-color: rgba(0,0,0,0.8);
}
.modal-content {
background-color: #1a1a1a;
margin: 5% auto;
padding: 20px;
border: 1px solid #444;
border-radius: 12px;
width: 90%;
max-width: 600px;
position: relative;
}
.close {
color: #aaa;
float: right;
font-size: 28px;
font-weight: bold;
cursor: pointer;
background: none;
border: none;
position: absolute;
right: 15px;
top: 10px;
}
.close:hover {
color: #fff;
}
</style>
</body>
</html>
