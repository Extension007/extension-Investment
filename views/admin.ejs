<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–ê–¥–º–∏–Ω–∫–∞ ‚Äî –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="/styles.css?v=1.0.1">
</head>
<body class="admin-page">
  <div id="bg-animated" aria-hidden="true"></div>
<header class="main-header">
<div class="container header-inner">
  <div class="header-top">
    <div class="header-left">
      <a class="logo" href="/"><img src="/albamount.png" alt="ALBAMOUNT" class="logo-img"></a>
      <div class="header-stats">
        <div class="stat-item">
          <span style="opacity: 0.8;">üë•</span>
          <strong style="color: #4caf50;"><%= typeof visitorCount !== 'undefined' ? visitorCount : 0 %></strong>
        </div>
        <div class="stat-item">
          <span style="opacity: 0.8;">üë§</span>
          <strong style="color: #2196f3;"><%= typeof userCount !== 'undefined' ? userCount : 0 %></strong>
        </div>
      </div>
    <div class="header-actions">
<span class="user-chip">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</span>
<form id="logoutForm" method="POST" action="/logout" style="display:inline;margin-left:10px;">
<button type="submit" class="btn outline small">–í—ã—Ö–æ–¥</button>
</form>
</div>
  </div>
</header>

<main style="margin-bottom: 64px;">

<!-- –ú–æ–¥–µ—Ä–∞—Ü–∏—è —Ç–æ–≤–∞—Ä–æ–≤ -->
<section class="section">
<div class="section-header">
<h2>–ú–æ–¥–µ—Ä–∞—Ü–∏—è —Ç–æ–≤–∞—Ä–æ–≤</h2>
<span class="badge" style="background:#ff9800;color:#fff;padding:4px 12px;border-radius:6px;font-size:0.9rem;">
<% if (pendingProducts && pendingProducts.length) { %>
<%= pendingProducts.length %> –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ
<% } else { %>
–ù–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏
<% } %>
</span>
</div>

<% if (pendingProducts && pendingProducts.length) { %>
<div class="product-grid">
<% pendingProducts.forEach(p => { %>
<div class="product-card" style="border:2px solid #ff9800;">
<h3 class="product-title"><%= p.name %></h3>
<% if (p.image_url) { %>
<img src="<%= p.image_url %>" alt="<%= p.name %>">
<% } else { %>
<div class="no-image">–ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</div>
<% } %>

<div class="product-bottom">
<p class="product-desc"><%= p.description || "‚Äî" %></p>
<div class="row" style="justify-content:center; gap:8px;">
<span class="muted">–¶–µ–Ω–∞:</span>
<strong class="price"><%= p.price %></strong>
</div>

<% if (p.owner) { %>
<% if (typeof p.owner === 'object' && p.owner.username) { %>
<p class="muted" style="text-align:center;font-size:0.9rem;">–û—Ç: <%= p.owner.username %></p>
<% } else { %>
<p class="muted" style="text-align:center;font-size:0.9rem;">–û—Ç: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ID <%= p.owner %></p>
<% } %>
<% } else { %>
<p class="muted" style="text-align:center;font-size:0.9rem;color:#f44336;">‚ö†Ô∏è –í–ª–∞–¥–µ–ª–µ—Ü –Ω–µ —É–∫–∞–∑–∞–Ω</p>
<% } %>

<div class="product-actions" style="flex-direction:column;gap:8px;">
<button class="btn small approve-btn" data-id="<%= p._id %>" data-type="product">
‚úÖ –û–¥–æ–±—Ä–∏—Ç—å
</button>
<button class="btn small reject-btn" data-id="<%= p._id %>" data-type="product">
‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å
</button>
<% if (p.link) { %>
<a class="btn small outline" href="<%= p.link %>" target="_blank" rel="noopener">–°—Å—ã–ª–∫–∞</a>
<% } %>
<% if (p.video_url) { %>
<button class="btn small outline" data-video="<%= p.video_url %>">–í–∏–¥–µ–æ</button>
<% } %>
</div>
</div>
</div>
<% }) %>
</div>
<% } else { %>
<p class="empty-state">–ù–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏</p>
<% } %>
</section>

<!-- –ú–æ–¥–µ—Ä–∞—Ü–∏—è —É—Å–ª—É–≥ -->
<section class="section">
<div class="section-header">
<h2>–ú–æ–¥–µ—Ä–∞—Ü–∏—è —É—Å–ª—É–≥</h2>
<span class="badge" style="background:#ff9800;color:#fff;padding:4px 12px;border-radius:6px;font-size:0.9rem;">
<% if (pendingServices && pendingServices.length) { %>
<%= pendingServices.length %> –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ
<% } else { %>
–ù–µ—Ç —É—Å–ª—É–≥ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏
<% } %>
</span>
</div>

<% if (pendingServices && pendingServices.length) { %>
<div class="product-grid">
<% pendingServices.forEach(s => { %>
<div class="product-card" style="border:2px solid #ff9800;">
<h3 class="product-title"><%= s.name %></h3>
<% if (s.image_url) { %>
<img src="<%= s.image_url %>" alt="<%= s.name %>">
<% } else { %>
<div class="no-image">–ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</div>
<% } %>

<div class="product-bottom">
<p class="product-desc"><%= s.description || "‚Äî" %></p>
<div class="row" style="justify-content:center; gap:8px;">
<span class="muted">–¶–µ–Ω–∞:</span>
<strong class="price"><%= s.price %></strong>
</div>

<% if (s.owner) { %>
<% if (typeof s.owner === 'object' && s.owner.username) { %>
<p class="muted" style="text-align:center;font-size:0.9rem;">–û—Ç: <%= s.owner.username %></p>
<% } else { %>
<p class="muted" style="text-align:center;font-size:0.9rem;">–û—Ç: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ID <%= s.owner %></p>
<% } %>
<% } else { %>
<p class="muted" style="text-align:center;font-size:0.9rem;color:#f44336;">‚ö†Ô∏è –í–ª–∞–¥–µ–ª–µ—Ü –Ω–µ —É–∫–∞–∑–∞–Ω</p>
<% } %>

<div class="product-actions" style="flex-direction:column;gap:8px;">
<button class="btn small approve-btn" data-id="<%= s._id %>" data-type="service">
‚úÖ –û–¥–æ–±—Ä–∏—Ç—å
</button>
<button class="btn small reject-btn" data-id="<%= s._id %>" data-type="service">
‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å
</button>
<% if (s.link) { %>
<a class="btn small outline" href="<%= s.link %>" target="_blank" rel="noopener">–°—Å—ã–ª–∫–∞</a>
<% } %>
<% if (s.video_url) { %>
<button class="btn small outline" data-video="<%= s.video_url %>">–í–∏–¥–µ–æ</button>
<% } %>
</div>
</div>
</div>
<% }) %>
</div>
<% } else { %>
<p class="empty-state">–ù–µ—Ç —É—Å–ª—É–≥ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏</p>
<% } %>
</section>

<!-- –ú–æ–¥–µ—Ä–∞—Ü–∏—è –±–∞–Ω–Ω–µ—Ä–æ–≤ -->
<section class="section">
<div class="section-header">
<h2>–ú–æ–¥–µ—Ä–∞—Ü–∏—è –±–∞–Ω–Ω–µ—Ä–æ–≤</h2>
<span class="badge" style="background:#ff9800;color:#fff;padding:4px 12px;border-radius:6px;font-size:0.9rem;">
<% if (pendingBanners && pendingBanners.length) { %>
<%= pendingBanners.length %> –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ
<% } else { %>
–ù–µ—Ç –±–∞–Ω–Ω–µ—Ä–æ–≤ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏
<% } %>
</span>
</div>

<% if (pendingBanners && pendingBanners.length) { %>
<div class="product-grid">
<% pendingBanners.forEach(b => { %>
<div class="product-card" style="border:2px solid #ff9800;">
<h3 class="product-title">–ë–∞–Ω–Ω–µ—Ä</h3>
<% if (b.image_url) { %>
<img src="<%= b.image_url %>" alt="–ë–∞–Ω–Ω–µ—Ä" style="max-height: 200px; object-fit: cover;">
<% } else { %>
<div class="no-image">–ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</div>
<% } %>

<div class="product-bottom">
<% if (b.owner) { %>
<% if (typeof b.owner === 'object' && b.owner.username) { %>
<p class="muted" style="text-align:center;font-size:0.9rem;">–û—Ç: <%= b.owner.username %></p>
<% } else { %>
<p class="muted" style="text-align:center;font-size:0.9rem;">–û—Ç: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ID <%= b.owner %></p>
<% } %>
<% } else { %>
<p class="muted" style="text-align:center;font-size:0.9rem;color:#f44336;">‚ö†Ô∏è –í–ª–∞–¥–µ–ª–µ—Ü –Ω–µ —É–∫–∞–∑–∞–Ω</p>
<% } %>

<% if (b.link) { %>
<p class="muted" style="text-align:center;font-size:0.85rem;margin-top:5px;">
üîó <a href="<%= b.link %>" target="_blank" rel="noopener" style="color:#666;"><%= b.link %></a>
</p>
<% } %>

<div class="product-actions" style="flex-direction:column;gap:8px;">
<button class="btn small approve-btn" data-id="<%= b._id %>" data-type="banner">
‚úÖ –û–¥–æ–±—Ä–∏—Ç—å
</button>
<button class="btn small reject-btn" data-id="<%= b._id %>" data-type="banner">
‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å
</button>
<% if (b.link) { %>
<a class="btn small outline" href="<%= b.link %>" target="_blank" rel="noopener">–°—Å—ã–ª–∫–∞</a>
<% } %>
</div>
</div>
</div>
<% }) %>
</div>
<% } else { %>
<p class="empty-state">–ù–µ—Ç –±–∞–Ω–Ω–µ—Ä–æ–≤ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏</p>
<% } %>
</section>

<!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ ALBA -->
<section class="section">
<div class="section-header">
<h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ ALBA</h2>
</div>
<form id="adminGrantAlbaForm"
      method="POST"
      action="/api/p1/alba/grant-by-login"
      class="form-grid"
      novalidate>

  <input type="hidden" name="_csrf" value="<%= csrfToken || '' %>">

  <input type="text" id="albaUsername" placeholder="–õ–æ–≥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è" required>
  <input type="number" id="albaAmount" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ ALBA" required min="1">
  <input type="text" id="albaComment" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π" required>

  <!-- –ö–†–ò–¢–ò–ß–ù–û -->

  <button type="button" id="albaSubmitBtn" class="btn primary">
    –ù–∞—á–∏—Å–ª–∏—Ç—å ALBA
  </button>
</form>
<div id="albaGrantMsg" class="note" style="margin-top:10px;"></div>

<!-- –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π ALBA -->
<div class="section-header" style="margin-top: 30px;">
<h2>–ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π ALBA</h2>
</div>
<button id="loadTransactionsBtn" class="btn small" style="margin-bottom: 15px;">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é</button>
<div id="albaTransactionsContainer">
<p class="empty-state">–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π</p>
</div>
</section>

<!-- –ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤ -->
<section class="section">
<div class="section-header">
<h2>–ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤</h2>
<span class="badge" style="background:#666;color:#fff;padding:4px 12px;border-radius:6px;font-size:0.9rem;">
–í—Å–µ–≥–æ: <%= products ? products.length : 0 %>
</span>
</div>

<% if (products && products.length) { %>
<div class="product-grid">
<% products.forEach(p => { %>
<div class="product-card status-<%= p.status || 'pending' %>">
<h3 class="product-title"><%= p.name %></h3>
<% if (p.image_url) { %>
<img src="<%= p.image_url %>" alt="<%= p.name %>">
<% } else { %>
<div class="no-image">–ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</div>
<% } %>

<div class="product-bottom">
<!-- –°—Ç–∞—Ç—É—Å –∫–∞—Ä—Ç–æ—á–∫–∏ -->
<div style="text-align:center;margin-bottom:10px;">
<% if (p.status === "pending") { %>
<span class="badge" style="background:#ff9800;color:#fff;padding:4px 12px;border-radius:6px;font-size:0.9rem;">
‚è≥ –ù–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏
</span>
<% } else if (p.status === "approved") { %>
<span class="badge" style="background:#4caf50;color:#fff;padding:4px 12px;border-radius:6px;font-size:0.9rem;">
‚úÖ –û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ
</span>
<% } else if (p.status === "rejected") { %>
<span class="badge" style="background:#f44336;color:#fff;padding:4px 12px;border-radius:6px;font-size:0.9rem;">
‚ùå –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ
</span>
<% } else { %>
<span class="badge" style="background:#666;color:#fff;padding:4px 12px;border-radius:6px;font-size:0.9rem;">
‚ö†Ô∏è –ë–µ–∑ —Å—Ç–∞—Ç—É—Å–∞
</span>
<% } %>
</div>

<p class="product-desc"><%= p.description || "‚Äî" %></p>
<div class="row" style="justify-content:center; gap:8px;">
<span class="muted">–¶–µ–Ω–∞:</span>
<strong class="price"><%= p.price %></strong>
</div>

<!-- –í–ª–∞–¥–µ–ª–µ—Ü -->
<% if (p.owner) { %>
<% if (typeof p.owner === 'object' && p.owner.username) { %>
<p class="muted" style="text-align:center;font-size:0.85rem;margin-top:5px;">
üë§ –í–ª–∞–¥–µ–ª–µ—Ü: <%= p.owner.username %>
</p>
<% } else { %>
<p class="muted" style="text-align:center;font-size:0.85rem;margin-top:5px;">
üë§ –í–ª–∞–¥–µ–ª–µ—Ü: ID <%= p.owner %>
</p>
<% } %>
<% } else { %>
<p class="muted" style="text-align:center;font-size:0.85rem;margin-top:5px;color:#f44336;">
‚ö†Ô∏è –í–ª–∞–¥–µ–ª–µ—Ü –Ω–µ —É–∫–∞–∑–∞–Ω (—Å–æ–∑–¥–∞–Ω–æ –∞–¥–º–∏–Ω–æ–º)
</p>
<% } %>

<!-- –ö–∞—Ç–µ–≥–æ—Ä–∏—è -->
<% if (categories && p.category) { %>
<p class="muted" style="text-align:center;font-size:0.85rem;margin-top:5px;">
üìÅ <%= categories[p.category] || p.category %>
</p>
<% } %>

<div class="product-actions" style="flex-direction:column;gap:6px;margin-top:10px;">
<!-- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞/–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ -->
<button class="btn small toggle-visibility-btn status-<%= p.status %>"
data-id="<%= p._id %>"
data-status="<%= p.status %>">
<%= p.status === 'approved' ? 'üö´ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å' : '‚úÖ –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å' %>
</button>

<a class="btn small outline" href="/admin/products/<%= p._id %>/edit">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>

<form method="POST" action="/admin/products/<%= p._id %>/delete" style="display:inline" onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É?');">
<input type="hidden" name="_csrf" value="<%- JSON.stringify(csrfToken || '') %>">
<button type="submit" class="btn small outline" style="width:100%;">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
</form>

<% if (p.link) { %>
<a class="btn small outline" href="<%= p.link %>" target="_blank" rel="noopener">üîó –°—Å—ã–ª–∫–∞</a>
<% } %>
<% if (p.video_url) { %>
<button class="btn small outline" data-video="<%= p.video_url %>">‚ñ∂Ô∏è –í–∏–¥–µ–æ</button>
<% } %>
</div>

<!-- –†–µ–π—Ç–∏–Ω–≥ (—Ç–æ–ª—å–∫–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ) -->
<div class="product-rating" data-id="<%= p._id %>" style="margin-top:10px;">
<button class="btn icon" type="button" disabled aria-label="–õ–∞–π–∫">‚ñ≤</button>
<span class="result"><%= (p.likes || 0) - (p.dislikes || 0) %></span>
<button class="btn icon" type="button" disabled aria-label="–î–∏–∑–ª–∞–π–∫">‚ñº</button>
<span class="votes">(<%= (p.likes || 0) + (p.dislikes || 0) %> –≥–æ–ª–æ—Å–æ–≤)</span>
</div>
</div>
</div>
<% }) %>
</div>
<% } else { %>
<p class="empty-state">–ü–æ–∫–∞ –Ω–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤</p>
<% } %>
</section>

<!-- –ö–∞—Ç–∞–ª–æ–≥ —É—Å–ª—É–≥ -->
<section class="section">
<div class="section-header">
<h2>–ö–∞—Ç–∞–ª–æ–≥ —É—Å–ª—É–≥</h2>
<span class="badge" style="background:#666;color:#fff;padding:4px 12px;border-radius:6px;font-size:0.9rem;">
–í—Å–µ–≥–æ: <%= services ? services.length : 0 %>
</span>
</div>

<% if (services && services.length) { %>
<div class="product-grid">
<% services.forEach(s => { %>
<div class="product-card status-<%= s.status || 'pending' %>">
<h3 class="product-title"><%= s.name %></h3>
<% if (s.image_url) { %>
<img src="<%= s.image_url %>" alt="<%= s.name %>">
<% } else { %>
<div class="no-image">–ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</div>
<% } %>

<div class="product-bottom">
<!-- –°—Ç–∞—Ç—É—Å –∫–∞—Ä—Ç–æ—á–∫–∏ -->
<div style="text-align:center;margin-bottom:10px;">
<% if (s.status === "pending") { %>
<span class="badge" style="background:#ff9800;color:#fff;padding:4px 12px;border-radius:6px;font-size:0.9rem;">
‚è≥ –ù–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏
</span>
<% } else if (s.status === "approved") { %>
<span class="badge" style="background:#4caf50;color:#fff;padding:4px 12px;border-radius:6px;font-size:0.9rem;">
‚úÖ –û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ
</span>
<% } else if (s.status === "rejected") { %>
<span class="badge" style="background:#f44336;color:#fff;padding:4px 12px;border-radius:6px;font-size:0.9rem;">
‚ùå –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ
</span>
<% } else { %>
<span class="badge" style="background:#666;color:#fff;padding:4px 12px;border-radius:6px;font-size:0.9rem;">
‚ö†Ô∏è –ë–µ–∑ —Å—Ç–∞—Ç—É—Å–∞
</span>
<% } %>
</div>

<p class="product-desc"><%= s.description || "‚Äî" %></p>
<div class="row" style="justify-content:center; gap:8px;">
<span class="muted">–¶–µ–Ω–∞:</span>
<strong class="price"><%= s.price %></strong>
</div>

<!-- –í–ª–∞–¥–µ–ª–µ—Ü -->
<% if (s.owner) { %>
<% if (typeof s.owner === 'object' && s.owner.username) { %>
<p class="muted" style="text-align:center;font-size:0.85rem;margin-top:5px;">
üë§ –í–ª–∞–¥–µ–ª–µ—Ü: <%= s.owner.username %>
</p>
<% } else { %>
<p class="muted" style="text-align:center;font-size:0.85rem;margin-top:5px;">
üë§ –í–ª–∞–¥–µ–ª–µ—Ü: ID <%= s.owner %>
</p>
<% } %>
<% } else { %>
<p class="muted" style="text-align:center;font-size:0.85rem;margin-top:5px;color:#f44336;">
‚ö†Ô∏è –í–ª–∞–¥–µ–ª–µ—Ü –Ω–µ —É–∫–∞–∑–∞–Ω (—Å–æ–∑–¥–∞–Ω–æ –∞–¥–º–∏–Ω–æ–º)
</p>
<% } %>

<!-- –ö–∞—Ç–µ–≥–æ—Ä–∏—è -->
<% if (categories && s.category) { %>
<p class="muted" style="text-align:center;font-size:0.85rem;margin-top:5px;">
üìÅ <%= categories[s.category] || s.category %>
</p>
<% } %>

<div class="product-actions" style="flex-direction:column;gap:6px;margin-top:10px;">
<!-- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞/–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ -->
<button class="btn small toggle-visibility-btn status-<%= s.status %>"
data-id="<%= s._id %>"
data-status="<%= s.status %>">
<%= s.status === 'approved' ? 'üö´ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å' : '‚úÖ –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å' %>
</button>

<a class="btn small outline" href="/admin/services/<%= s._id %>/edit">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>

<form method="POST" action="/admin/services/<%= s._id %>/delete" style="display:inline" onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É?');">
<input type="hidden" name="_csrf" value="<%- JSON.stringify(csrfToken || '') %>">
<button type="submit" class="btn small outline" style="width:100%;">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
</form>

<% if (s.link) { %>
<a class="btn small outline" href="<%= s.link %>" target="_blank" rel="noopener">üîó –°—Å—ã–ª–∫–∞</a>
<% } %>
<% if (s.video_url) { %>
<button class="btn small outline" data-video="<%= s.video_url %>">‚ñ∂Ô∏è –í–∏–¥–µ–æ</button>
<% } %>
</div>

<!-- –†–µ–π—Ç–∏–Ω–≥ (—Ç–æ–ª—å–∫–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ) -->
<div class="product-rating" data-id="<%= s._id %>" style="margin-top:10px;">
<button class="btn icon" type="button" disabled aria-label="–õ–∞–π–∫">‚ñ≤</button>
<span class="result"><%= (s.likes || 0) - (s.dislikes || 0) %></span>
<button class="btn icon" type="button" disabled aria-label="–î–∏–∑–ª–∞–π–∫">‚ñº</button>
<span class="votes">(<%= (s.likes || 0) + (s.dislikes || 0) %> –≥–æ–ª–æ—Å–æ–≤)</span>
</div>
</div>
</div>
<% }) %>
</div>
<% } else { %>
<p class="empty-state">–ü–æ–∫–∞ –Ω–µ—Ç —É—Å–ª—É–≥</p>
<% } %>
</section>

<!-- –ö–∞—Ç–∞–ª–æ–≥ –±–∞–Ω–Ω–µ—Ä–æ–≤ -->
<section class="section">
<div class="section-header">
<h2>–ö–∞—Ç–∞–ª–æ–≥ –±–∞–Ω–Ω–µ—Ä–æ–≤</h2>
<span class="badge" style="background:#666;color:#fff;padding:4px 12px;border-radius:6px;font-size:0.9rem;">
–í—Å–µ–≥–æ: <%= banners ? banners.length : 0 %>
</span>
</div>

<% if (banners && banners.length) { %>
<div class="product-grid">
<% banners.forEach(b => { %>
<div class="product-card status-<%= b.status || 'pending' %>">
<h3 class="product-title"><%= b.title || '–ë–∞–Ω–Ω–µ—Ä' %></h3>
<% if (b.image_url || (b.images && b.images.length > 0)) { %>
<img src="<%= b.image_url || b.images[0] %>" alt="<%= b.title || '–ë–∞–Ω–Ω–µ—Ä' %>" style="max-height: 200px; object-fit: cover;">
<% } else { %>
<div class="no-image">–ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</div>
<% } %>

<div class="product-bottom">
<!-- –°—Ç–∞—Ç—É—Å –∫–∞—Ä—Ç–æ—á–∫–∏ -->
<div style="text-align:center;margin-bottom:10px;">
<% if (b.status === "pending") { %>
<span class="badge" style="background:#ff9800;color:#fff;padding:4px 12px;border-radius:6px;font-size:0.9rem;">
‚è≥ –ù–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏
</span>
<% } else if (b.status === "approved" || b.status === "published") { %>
<span class="badge" style="background:#4caf50;color:#fff;padding:4px 12px;border-radius:6px;font-size:0.9rem;">
‚úÖ –û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ
</span>
<% } else if (b.status === "rejected" || b.status === "blocked") { %>
<span class="badge" style="background:#f44336;color:#fff;padding:4px 12px;border-radius:6px;font-size:0.9rem;">
‚ùå –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ
</span>
<% } else { %>
<span class="badge" style="background:#666;color:#fff;padding:4px 12px;border-radius:6px;font-size:0.9rem;">
‚ö†Ô∏è –ë–µ–∑ —Å—Ç–∞—Ç—É—Å–∞
</span>
<% } %>
</div>

<p class="product-desc"><%= b.description || "‚Äî" %></p>
<% if (b.price && b.price > 0) { %>
<div class="row" style="justify-content:center; gap:8px;">
<span class="muted">–¶–µ–Ω–∞:</span>
<strong class="price"><%= b.price %></strong>
</div>
<% } %>

<!-- –í–ª–∞–¥–µ–ª–µ—Ü -->
<% if (b.owner) { %>
<% if (typeof b.owner === 'object' && b.owner.username) { %>
<p class="muted" style="text-align:center;font-size:0.85rem;margin-top:5px;">
üë§ –í–ª–∞–¥–µ–ª–µ—Ü: <%= b.owner.username %>
</p>
<% } else { %>
<p class="muted" style="text-align:center;font-size:0.85rem;margin-top:5px;">
üë§ –í–ª–∞–¥–µ–ª–µ—Ü: ID <%= b.owner %>
</p>
<% } %>
<% } else { %>
<p class="muted" style="text-align:center;font-size:0.85rem;margin-top:5px;color:#f44336;">
‚ö†Ô∏è –í–ª–∞–¥–µ–ª–µ—Ü –Ω–µ —É–∫–∞–∑–∞–Ω (—Å–æ–∑–¥–∞–Ω–æ –∞–¥–º–∏–Ω–æ–º)
</p>
<% } %>

<!-- –ö–∞—Ç–µ–≥–æ—Ä–∏—è -->
<% if (b.category) { %>
<p class="muted" style="text-align:center;font-size:0.85rem;margin-top:5px;">
üìÅ <%= b.category %>
</p>
<% } %>

<div class="product-actions" style="flex-direction:column;gap:6px;margin-top:10px;">
<!-- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞/–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ -->
<button class="btn small toggle-visibility-btn status-<%= b.status %>"
data-id="<%= b._id %>"
data-status="<%= b.status %>"
data-type="banner">
<%= (b.status === 'approved' || b.status === 'published') ? 'üö´ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å' : '‚úÖ –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å' %>
</button>

<a class="btn small outline" href="/admin/banners/<%= b._id %>/edit">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>

<form method="POST" action="/admin/banners/<%= b._id %>/delete" style="display:inline" onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å –±–∞–Ω–Ω–µ—Ä?');">
<input type="hidden" name="_csrf" value="<%- JSON.stringify(csrfToken || '') %>">
<button type="submit" class="btn small outline" style="width:100%;">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
</form>

<% if (b.link) { %>
<a class="btn small outline" href="<%= b.link %>" target="_blank" rel="noopener">üîó –°—Å—ã–ª–∫–∞</a>
<% } %>
<% if (b.video_url) { %>
<button class="btn small outline" data-video="<%= b.video_url %>">‚ñ∂Ô∏è –í–∏–¥–µ–æ</button>
<% } %>
</div>

<!-- –†–µ–π—Ç–∏–Ω–≥ (—Ç–æ–ª—å–∫–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ) -->
<div class="product-rating" data-id="<%= b._id %>" style="margin-top:10px;">
<button class="btn icon" type="button" disabled aria-label="–õ–∞–π–∫">‚ñ≤</button>
<span class="result"><%= (b.rating_up || 0) - (b.rating_down || 0) %></span>
<button class="btn icon" type="button" disabled aria-label="–î–∏–∑–ª–∞–π–∫">‚ñº</button>
<span class="votes">(<%= (b.rating_up || 0) + (b.rating_down || 0) %> –≥–æ–ª–æ—Å–æ–≤)</span>
</div>
</div>
</div>
<% }) %>
</div>
<% } else { %>
<p class="empty-state">–ü–æ–∫–∞ –Ω–µ—Ç –±–∞–Ω–Ω–µ—Ä–æ–≤</p>
<% } %>
</section>
</main>

<footer class="footer">
  <p></p>
</footer>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è -->
<div id="rejectModal" class="modal" aria-hidden="true" style="display:none;">
<div class="modal-content" role="dialog" aria-modal="true" aria-label="–û—Ç–∫–ª–æ–Ω–∏—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É">
<button class="close" data-close-reject aria-label="–ó–∞–∫—Ä—ã—Ç—å">&times;</button>
<h3>–û—Ç–∫–ª–æ–Ω–∏—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É</h3>
<form id="rejectForm">
<textarea name="reason" placeholder="–ü—Ä–∏—á–∏–Ω–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)" rows="4" style="width:100%;padding:8px;border-radius:6px;border:1px solid #444;background:#2b2b2b;color:#fff;resize:vertical;"></textarea>
<button type="submit" class="btn" style="margin-top:10px;">–û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>
</form>
</div>
</div>

<!-- FIX: –ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π overlay –¥–ª—è YouTube –≤–∏–¥–µ–æ -->
<div id="videoOverlay" class="video-overlay" aria-hidden="true" style="display:none;">
<div class="video-overlay-container">
<button class="video-overlay-close" data-close-video aria-label="–ó–∞–∫—Ä—ã—Ç—å –≤–∏–¥–µ–æ">&times;</button>
<div class="video-overlay-iframe-container" id="videoIframeContainer">
<!-- FIX: iframe —Å–æ–∑–¥–∞–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –ø–æ –∫–ª–∏–∫—É -->
</div>
</div>
</div>

<!-- –ü–µ—Ä–µ–¥–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Socket.IO –Ω–∞ –∫–ª–∏–µ–Ω—Ç -->
 <!-- Bootstrap script for safe EJS ‚Üí JS data transfer -->
  <script src="/utils/bootstrap.js"></script>
  <script>
    // Safe initialization of global variables
    window.AppBootstrap.init(<%- JSON.stringify({
      isAuth: true,
      isAdmin: true,
      socketIoAvailable: typeof socket_io_available !== 'undefined' ? socket_io_available : false,
      userRole: typeof userRole !== 'undefined' ? userRole : 'admin'
    }) %>);
  </script>

<script>
// –ì–ª–æ–±–∞–ª—å–Ω—ã–π CSRF —Ç–æ–∫–µ–Ω
const CSRF_TOKEN = <%- JSON.stringify(csrfToken || '') %>;

// Helper —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è POST –∑–∞–ø—Ä–æ—Å–æ–≤ —Å CSRF
async function postJSON(url, data = {}) {
  return fetch(url, {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "X-CSRF-Token": CSRF_TOKEN
    },
    body: JSON.stringify(data)
  });
}

// –ï–î–ò–ù–°–¢–í–ï–ù–ù–´–ô –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ DOMContentLoaded
document.addEventListener("DOMContentLoaded", () => {

const adminGrantAlbaForm = document.getElementById('adminGrantAlbaForm');
if (adminGrantAlbaForm) {
// –ñ–ï–õ–ï–ó–ù–´–ô –ë–õ–û–ö–ï–† –ù–ê–¢–ò–í–ù–û–ì–û SUBMIT (Enter / –±—Ä–∞—É–∑–µ—Ä / –≥–ª—é–∫–∏)
adminGrantAlbaForm.addEventListener('submit', (e) => e.preventDefault());
}

const albaSubmitBtn = document.getElementById('albaSubmitBtn');
const albaGrantMsg  = document.getElementById('albaGrantMsg');

if (albaSubmitBtn && albaGrantMsg) {
albaSubmitBtn.addEventListener('click', async () => {

const username = document.getElementById('albaUsername').value.trim();
const amount   = document.getElementById('albaAmount').value;
const comment  = document.getElementById('albaComment').value.trim();

if (!username || !amount || !comment) {
  albaGrantMsg.textContent = '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è';
  albaGrantMsg.style.color = '#b00020';
  return;
}

albaGrantMsg.textContent = '–ù–∞—á–∏—Å–ª–µ–Ω–∏–µ...';
albaGrantMsg.style.color = '#666';

try {
  const res = await fetch('/api/p1/alba/grant-by-login', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'X-CSRF-Token': CSRF_TOKEN
    },
    body: JSON.stringify({
      login: username,
      amount: Number(amount),
      reason: 'admin_grant',
      comment: comment
    })
  });

  const data = await res.json();

  if (data.success) {
    albaGrantMsg.textContent = `‚úÖ –ù–∞—á–∏—Å–ª–µ–Ω–æ ${amount} ALBA –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é ${username}`;
    albaGrantMsg.style.color = '#4caf50';
    adminGrantAlbaForm && adminGrantAlbaForm.reset();
  } else {
    albaGrantMsg.textContent = '–û—à–∏–±–∫–∞: ' + (data.message || 'unknown');
    albaGrantMsg.style.color = '#b00020';
  }
} catch (err) {
  albaGrantMsg.textContent = '–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + err.message;
  albaGrantMsg.style.color = '#b00020';
}
});
}

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã—Ö–æ–¥–∞
  const logoutForm = document.getElementById("logoutForm");
  if (logoutForm) {
    logoutForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      e.stopPropagation();
      if (!confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏?")) return;
      try {
        const res = await fetch("/logout", { method: "POST" });
        if (res.ok) {
          window.location.href = "/";
        }
      } catch (err) {
        window.location.href = "/";
      }
    });
  }

  // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞/–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–∞—Ä—Ç–æ—á–µ–∫ (—Ç–æ–≤–∞—Ä—ã, —É—Å–ª—É–≥–∏, –±–∞–Ω–Ω–µ—Ä—ã)
  const toggleBtns = document.querySelectorAll(".toggle-visibility-btn");
  toggleBtns.forEach(btn => {
    btn.addEventListener("click", async (e) => {
      e.preventDefault();
      e.stopPropagation();
      const id = btn.getAttribute("data-id");
      const currentStatus = btn.getAttribute("data-status");
      const itemType = btn.getAttribute("data-type") || "product";
      const action = (currentStatus === "approved" || currentStatus === "published") ? "–∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å" : "—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å";
      if (!confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ ${action} —ç—Ç—É –∫–∞—Ä—Ç–æ—á–∫—É?`)) return;

      try {
        let endpoint;
        if (itemType === "banner") {
          endpoint = `/admin/banners/${id}/toggle-visibility`;
        } else if (itemType === "service") {
          endpoint = `/admin/services/${id}/toggle-visibility`;
        } else {
          endpoint = `/admin/products/${id}/toggle-visibility`;
        }

        const res = await postJSON(endpoint);
        const data = await res.json();
        if (data.success) {
          alert(data.message || "–°—Ç–∞—Ç—É—Å –∫–∞—Ä—Ç–æ—á–∫–∏ –∏–∑–º–µ–Ω–µ–Ω");
          location.reload();
        } else {
          alert("–û—à–∏–±–∫–∞: " + (data.message || "–ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å"));
        }
      } catch (err) {
        alert("–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: " + err.message);
      }
    });
  });

  // –ú–æ–¥–µ—Ä–∞—Ü–∏—è: –æ–¥–æ–±—Ä–µ–Ω–∏–µ
  const approveBtns = document.querySelectorAll(".approve-btn");
  approveBtns.forEach(btn => {
    btn.addEventListener("click", async (e) => {
      e.preventDefault();
      e.stopPropagation();
      const id = btn.getAttribute("data-id");
      if (!confirm("–û–¥–æ–±—Ä–∏—Ç—å —ç—Ç—É –∫–∞—Ä—Ç–æ—á–∫—É?")) return;
      try {
        const itemType = btn.getAttribute("data-type") || "product";
        let endpoint;
        if (itemType === "banner") {
          endpoint = `/admin/banners/${id}/approve`;
        } else if (itemType === "service") {
          endpoint = `/admin/services/${id}/approve`;
        } else {
          endpoint = `/admin/products/${id}/approve`;
        }
        const res = await postJSON(endpoint);
        const data = await res.json();
        if (data.success) {
          alert("–ö–∞—Ä—Ç–æ—á–∫–∞ –æ–¥–æ–±—Ä–µ–Ω–∞!");
          location.reload();
        } else {
          alert("–û—à–∏–±–∫–∞: " + (data.message || "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞"));
        }
      } catch (err) {
        alert("–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: " + err.message);
      }
    });
  });

  // –ú–æ–¥–µ—Ä–∞—Ü–∏—è: –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ
  const rejectModal = document.getElementById("rejectModal");
  const rejectForm = document.getElementById("rejectForm");
  let currentRejectId = null;
  let currentRejectType = "product";

  document.querySelectorAll(".reject-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      currentRejectId = btn.getAttribute("data-id");
      currentRejectType = btn.getAttribute("data-type") || "product";
      rejectModal.style.display = "block";
      rejectModal.setAttribute("aria-hidden", "false");
    });
  });

  const closeRejectBtn = document.querySelector("[data-close-reject]");
  if (closeRejectBtn) {
    closeRejectBtn.addEventListener("click", () => {
      rejectModal.style.display = "none";
      rejectModal.setAttribute("aria-hidden", "true");
      rejectForm && rejectForm.reset();
      currentRejectId = null;
      currentRejectType = "product";
    });
  }

  if (rejectForm) {
    rejectForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      if (!currentRejectId) return;
      const reason = new FormData(rejectForm).get("reason") || "–ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø—Ä–∞–≤–∏–ª–∞–º –ø—É–±–ª–∏–∫–∞—Ü–∏–∏";
      try {
        let rejectEndpoint;
        if (currentRejectType === "banner") {
          rejectEndpoint = `/admin/banners/${currentRejectId}/reject`;
        } else if (currentRejectType === "service") {
          rejectEndpoint = `/admin/services/${currentRejectId}/reject`;
        } else {
          rejectEndpoint = `/admin/products/${currentRejectId}/reject`;
        }
        const res = await postJSON(rejectEndpoint, { reason });
        const data = await res.json();
        if (data.success) {
          alert("–ö–∞—Ä—Ç–æ—á–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞");
          location.reload();
        } else {
          alert("–û—à–∏–±–∫–∞: " + (data.message || "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞"));
        }
      } catch (err) {
        alert("–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: " + err.message);
      }
    });
  }
});
</script>

<style>
/* Status styles for product cards */
.status-approved {
border: 2px solid #4caf50;
}
.status-rejected {
opacity: 0.7;
border: 2px solid #f44336;
}
.status-pending {
border: 2px solid #ff9800;
}

/* Status styles for toggle buttons */
.toggle-visibility-btn.status-approved {
background:#f44336;
color:#fff;
}
.toggle-visibility-btn.status-rejected {
background:#4caf50;
color:#fff;
}
.toggle-visibility-btn.status-pending {
background:#4caf50;
color:#fff;
}

.modal {
display: none;
position: fixed;
z-index: 2000;
left: 0;
top: 0;
width: 100%;
height: 100%;
background-color: rgba(0,0,0,0.8);
}
.modal-content {
background-color: #1a1a1a;
margin: 5% auto;
padding: 20px;
border: 1px solid #444;
border-radius: 12px;
width: 90%;
max-width: 600px;
position: relative;
}
.close {
color: #aaa;
float: right;
font-size: 28px;
font-weight: bold;
cursor: pointer;
background: none;
border: none;
position: absolute;
right: 15px;
top: 10px;
}
.close:hover {
color: #fff;
}
</style>
</body>
</html>
<task_progress>
- [x] –ü—Ä–æ–≤–µ—Å—Ç–∏ –ø–æ–ª–Ω—ã–π –∞—É–¥–∏—Ç JavaScript –∫–æ–¥–∞ –≤ views/admin.ejs
- [x] –ù–∞–π—Ç–∏ –≤—Å–µ –ª–∏—à–Ω–∏–µ –∏ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –∑–∞–∫—Ä—ã–≤–∞—é—â–∏–µ —Å–∫–æ–±–∫–∏
- [x] –£–¥–∞–ª–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫
- [x] –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏
- [x] –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ —Å –æ–¥–Ω–∏–º DOMContentLoaded
- [x] –ó–∞—â–∏—Ç–∏—Ç—å —Ñ–æ—Ä–º—É ALBA –æ—Ç GET –∑–∞–ø—Ä–æ—Å–æ–≤
- [x] –£–±–µ–¥–∏—Ç—å—Å—è –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –ø–µ—Ä–µ–¥–∞—á–µ CSRF —Ç–æ–∫–µ–Ω–∞
- [x] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Ñ–æ—Ä–º–∞ ALBA –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç POST –∑–∞–ø—Ä–æ—Å
</task_progress>
</write_to_file>
