<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–ê–¥–º–∏–Ω–∫–∞ ‚Äî –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="/styles.css">
</head>
<body>
<header class="main-header">
<div class="container header-inner">
  <a class="logo" href="/"><img src="/albamount.png" alt="EXTO" class="logo-img"></a>
  <nav class="nav" style="display:none;">
<!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è —Å–∫—Ä—ã—Ç–∞ -->
</nav>
<div class="header-actions">
<span class="user-chip">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</span>
<form id="logoutForm" method="POST" action="/logout" style="display:inline;margin-left:10px;">
<button type="submit" class="btn outline small">–í—ã—Ö–æ–¥</button>
</form>
</div>
</div>
</header>

<!-- –ú–æ–¥–µ—Ä–∞—Ü–∏—è —Ç–æ–≤–∞—Ä–æ–≤ -->
<section class="section">
<div class="section-header">
<h2>–ú–æ–¥–µ—Ä–∞—Ü–∏—è —Ç–æ–≤–∞—Ä–æ–≤</h2>
<span class="badge" style="background:#ff9800;color:#fff;padding:4px 12px;border-radius:6px;font-size:0.9rem;">
<% if (pendingProducts && pendingProducts.length) { %>
<%= pendingProducts.length %> –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ
<% } else { %>
–ù–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏
<% } %>
</span>
</div>

<% if (pendingProducts && pendingProducts.length) { %>
<div class="product-grid">
<% pendingProducts.forEach(p => { %>
<div class="product-card" style="border:2px solid #ff9800;">
<h3 class="product-title"><%= p.name %></h3>
<% if (p.image_url) { %>
<img src="<%= p.image_url %>" alt="<%= p.name %>">
<% } else { %>
<div class="no-image">–ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</div>
<% } %>

<div class="product-bottom">
<p class="product-desc"><%= p.description || "‚Äî" %></p>
<div class="row" style="justify-content:center; gap:8px;">
<span class="muted">–¶–µ–Ω–∞:</span>
<strong class="price"><%= p.price %></strong>
</div>

<% if (p.owner) { %>
<% if (typeof p.owner === 'object' && p.owner.username) { %>
<p class="muted" style="text-align:center;font-size:0.9rem;">–û—Ç: <%= p.owner.username %></p>
<% } else { %>
<p class="muted" style="text-align:center;font-size:0.9rem;">–û—Ç: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ID <%= p.owner %></p>
<% } %>
<% } else { %>
<p class="muted" style="text-align:center;font-size:0.9rem;color:#f44336;">‚ö†Ô∏è –í–ª–∞–¥–µ–ª–µ—Ü –Ω–µ —É–∫–∞–∑–∞–Ω</p>
<% } %>

<div class="product-actions" style="flex-direction:column;gap:8px;">
<button class="btn small approve-btn" data-id="<%= p._id %>" data-type="product" style="background:#4caf50;color:#fff;">
‚úÖ –û–¥–æ–±—Ä–∏—Ç—å
</button>
<button class="btn small reject-btn" data-id="<%= p._id %>" data-type="product" style="background:#f44336;color:#fff;">
‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å
</button>
<% if (p.link) { %>
<a class="btn small outline" href="<%= p.link %>" target="_blank" rel="noopener">–°—Å—ã–ª–∫–∞</a>
<% } %>
<% if (p.video_url) { %>
<button class="btn small outline" data-video="<%= p.video_url %>">–í–∏–¥–µ–æ</button>
<% } %>
</div>
</div>
</div>
<% }) %>
</div>
<% } else { %>
<p class="empty-state">–ù–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏</p>
<% } %>
</section>

<!-- –ú–æ–¥–µ—Ä–∞—Ü–∏—è —É—Å–ª—É–≥ -->
<section class="section">
<div class="section-header">
<h2>–ú–æ–¥–µ—Ä–∞—Ü–∏—è —É—Å–ª—É–≥</h2>
<span class="badge" style="background:#ff9800;color:#fff;padding:4px 12px;border-radius:6px;font-size:0.9rem;">
<% if (pendingServices && pendingServices.length) { %>
<%= pendingServices.length %> –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ
<% } else { %>
–ù–µ—Ç —É—Å–ª—É–≥ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏
<% } %>
</span>
</div>

<% if (pendingServices && pendingServices.length) { %>
<div class="product-grid">
<% pendingServices.forEach(s => { %>
<div class="product-card" style="border:2px solid #ff9800;">
<h3 class="product-title"><%= s.name %></h3>
<% if (s.image_url) { %>
<img src="<%= s.image_url %>" alt="<%= s.name %>">
<% } else { %>
<div class="no-image">–ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</div>
<% } %>

<div class="product-bottom">
<p class="product-desc"><%= s.description || "‚Äî" %></p>
<div class="row" style="justify-content:center; gap:8px;">
<span class="muted">–¶–µ–Ω–∞:</span>
<strong class="price"><%= s.price %></strong>
</div>

<% if (s.owner) { %>
<% if (typeof s.owner === 'object' && s.owner.username) { %>
<p class="muted" style="text-align:center;font-size:0.9rem;">–û—Ç: <%= s.owner.username %></p>
<% } else { %>
<p class="muted" style="text-align:center;font-size:0.9rem;">–û—Ç: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ID <%= s.owner %></p>
<% } %>
<% } else { %>
<p class="muted" style="text-align:center;font-size:0.9rem;color:#f44336;">‚ö†Ô∏è –í–ª–∞–¥–µ–ª–µ—Ü –Ω–µ —É–∫–∞–∑–∞–Ω</p>
<% } %>

<div class="product-actions" style="flex-direction:column;gap:8px;">
<button class="btn small approve-btn" data-id="<%= s._id %>" data-type="service" style="background:#4caf50;color:#fff;">
‚úÖ –û–¥–æ–±—Ä–∏—Ç—å
</button>
<button class="btn small reject-btn" data-id="<%= s._id %>" data-type="service" style="background:#f44336;color:#fff;">
‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å
</button>
<% if (s.link) { %>
<a class="btn small outline" href="<%= s.link %>" target="_blank" rel="noopener">–°—Å—ã–ª–∫–∞</a>
<% } %>
<% if (s.video_url) { %>
<button class="btn small outline" data-video="<%= s.video_url %>">–í–∏–¥–µ–æ</button>
<% } %>
</div>
</div>
</div>
<% }) %>
</div>
<% } else { %>
<p class="empty-state">–ù–µ—Ç —É—Å–ª—É–≥ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏</p>
<% } %>
</section>

<!-- –ú–æ–¥–µ—Ä–∞—Ü–∏—è –±–∞–Ω–Ω–µ—Ä–æ–≤ -->
<section class="section">
<div class="section-header">
<h2>–ú–æ–¥–µ—Ä–∞—Ü–∏—è –±–∞–Ω–Ω–µ—Ä–æ–≤</h2>
<span class="badge" style="background:#ff9800;color:#fff;padding:4px 12px;border-radius:6px;font-size:0.9rem;">
<% if (pendingBanners && pendingBanners.length) { %>
<%= pendingBanners.length %> –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ
<% } else { %>
–ù–µ—Ç –±–∞–Ω–Ω–µ—Ä–æ–≤ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏
<% } %>
</span>
</div>

<% if (pendingBanners && pendingBanners.length) { %>
<div class="product-grid">
<% pendingBanners.forEach(b => { %>
<div class="product-card" style="border:2px solid #ff9800;">
<h3 class="product-title">–ë–∞–Ω–Ω–µ—Ä</h3>
<% if (b.image_url) { %>
<img src="<%= b.image_url %>" alt="–ë–∞–Ω–Ω–µ—Ä" style="max-height: 200px; object-fit: cover;">
<% } else { %>
<div class="no-image">–ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</div>
<% } %>

<div class="product-bottom">
<% if (b.owner) { %>
<% if (typeof b.owner === 'object' && b.owner.username) { %>
<p class="muted" style="text-align:center;font-size:0.9rem;">–û—Ç: <%= b.owner.username %></p>
<% } else { %>
<p class="muted" style="text-align:center;font-size:0.9rem;">–û—Ç: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ID <%= b.owner %></p>
<% } %>
<% } else { %>
<p class="muted" style="text-align:center;font-size:0.9rem;color:#f44336;">‚ö†Ô∏è –í–ª–∞–¥–µ–ª–µ—Ü –Ω–µ —É–∫–∞–∑–∞–Ω</p>
<% } %>

<% if (b.link) { %>
<p class="muted" style="text-align:center;font-size:0.85rem;margin-top:5px;">
üîó <a href="<%= b.link %>" target="_blank" rel="noopener" style="color:#666;"><%= b.link %></a>
</p>
<% } %>

<div class="product-actions" style="flex-direction:column;gap:8px;">
<button class="btn small approve-banner-btn" data-id="<%= b._id %>" style="background:#4caf50;color:#fff;">
‚úÖ –û–¥–æ–±—Ä–∏—Ç—å
</button>
<button class="btn small reject-banner-btn" data-id="<%= b._id %>" style="background:#f44336;color:#fff;">
‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å
</button>
<% if (b.link) { %>
<a class="btn small outline" href="<%= b.link %>" target="_blank" rel="noopener">–°—Å—ã–ª–∫–∞</a>
<% } %>
</div>
</div>
</div>
<% }) %>
</div>
<% } else { %>
<p class="empty-state">–ù–µ—Ç –±–∞–Ω–Ω–µ—Ä–æ–≤ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏</p>
<% } %>
</section>

<!-- –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä/—É—Å–ª—É–≥—É -->
<section class="section">
<div class="section-header">
<h2>–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä/—É—Å–ª—É–≥—É</h2>
</div>
<form id="adminCreateProductForm" method="POST" action="/admin/products" enctype="multipart/form-data" class="form-grid">
<input type="hidden" name="_csrf" value="<%= typeof csrfToken !== 'undefined' ? csrfToken : '' %>">
<!-- –°–µ–ª–µ–∫—Ç–æ—Ä —Ç–∏–ø–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ -->
<div class="form-section">
<label for="adminType">–¢–∏–ø –ø—É–±–ª–∏–∫–∞—Ü–∏–∏:</label>
<select id="adminType" name="type" required>
<option value="product">–¢–æ–≤–∞—Ä</option>
<option value="service">–£—Å–ª—É–≥–∞</option>
</select>
</div>

<input type="text" name="name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" required>
<textarea name="description" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ" rows="4"></textarea>
<input type="number" name="price" placeholder="–¶–µ–Ω–∞" min="0" step="1" required>
<input type="url" name="link" placeholder="–°—Å—ã–ª–∫–∞">
<input type="url" name="video_url" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ –≤–∏–¥–µ–æ (YouTube, –í–ö–æ–Ω—Ç–∞–∫—Ç–µ, Instagram)">

<!-- –ü–æ–ª—è –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –ø—Ä–æ–¥–∞–≤—Ü–∞ -->
<div class="form-section">
<h3>–ö–æ–Ω—Ç–∞–∫—Ç—ã –ø—Ä–æ–¥–∞–≤—Ü–∞</h3>
<input type="tel" name="phone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω">
<input type="email" name="email" placeholder="Email">
<input type="text" name="telegram" placeholder="Telegram (–Ω–∞–ø—Ä–∏–º–µ—Ä: @username)">
<input type="text" name="whatsapp" placeholder="WhatsApp (–Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞)">
<textarea name="contact_method" placeholder="–°–ø–æ—Å–æ–± —Å–≤—è–∑–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä: –ó–≤–æ–Ω–∏—Ç–µ —Å 9:00 –¥–æ 18:00)" rows="2"></textarea>
</div>

<!-- –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ 5 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π -->
<div class="form-section">
<label for="adminImages">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–¥–æ 5 —à—Ç.):</label>
<input type="file" id="adminImages" name="images" accept="image/*" multiple data-max-files="5">
<div id="adminImagePreview" class="image-preview-container" style="display:none;margin-top:10px;"></div>
<small class="form-hint">–ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –¥–æ 5 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</small>
</div>

<select name="category" required>
<option value="home">–î–ª—è –¥–æ–º–∞</option>
<option value="beauty">–ö—Ä–∞—Å–æ—Ç–∞ –∏ –∑–¥–æ—Ä–æ–≤—å–µ</option>
<option value="auto">–ê–≤—Ç–æ –º–æ—Ç–æ</option>
<option value="electric">–≠–ª–µ–∫—Ç—Ä–∏–∫–∞</option>
<option value="electronics">–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞</option>
<option value="plumbing">–°–∞–Ω—Ç–µ—Ö–Ω–∏–∫–∞</option>
</select>

<button type="submit" class="btn primary">–î–æ–±–∞–≤–∏—Ç—å</button>
</form>
<div id="adminCreateMsg" class="note" style="margin-top:10px;"></div>
</section>

<!-- –î–æ–±–∞–≤–∏—Ç—å –±–∞–Ω–Ω–µ—Ä -->
<section class="section">
<div class="section-header">
<h2>–î–æ–±–∞–≤–∏—Ç—å –±–∞–Ω–Ω–µ—Ä</h2>
</div>
<form id="adminCreateBannerForm" method="POST" action="/admin/banners" enctype="multipart/form-data" class="form-grid">
<input type="hidden" name="_csrf" value="<%= typeof csrfToken !== 'undefined' ? csrfToken : '' %>">
<input type="text" name="title" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –±–∞–Ω–Ω–µ—Ä–∞" required>
<textarea name="description" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ" rows="4"></textarea>
<input type="number" name="price" placeholder="–¶–µ–Ω–∞" min="0" step="1">
<input type="url" name="link" placeholder="–°—Å—ã–ª–∫–∞">
<input type="url" name="video_url" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ –≤–∏–¥–µ–æ (YouTube, –í–ö–æ–Ω—Ç–∞–∫—Ç–µ, Instagram)">
<input type="text" name="category" placeholder="–ö–∞—Ç–µ–≥–æ—Ä–∏—è (—Ä–µ–∫–ª–∞–º–∞, –ø—Ä–æ–º–æ –∏ —Ç.–¥.)">

<!-- –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ 5 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π -->
<div class="form-section">
<label for="adminBannerImages">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–¥–æ 5 —à—Ç.):</label>
<input type="file" id="adminBannerImages" name="images" accept="image/*" multiple data-max-files="5">
<div id="adminBannerImagePreview" class="image-preview-container" style="display:none;margin-top:10px;"></div>
<small class="form-hint">–ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –¥–æ 5 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</small>
</div>

<select name="status">
<option value="published">–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ</option>
<option value="draft">–ß–µ—Ä–Ω–æ–≤–∏–∫</option>
<option value="pending">–ù–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏</option>
</select>

<button type="submit" class="btn primary">–î–æ–±–∞–≤–∏—Ç—å –±–∞–Ω–Ω–µ—Ä</button>
</form>
<div id="adminCreateBannerMsg" class="note" style="margin-top:10px;"></div>
</section>

<!-- –ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤ -->
<section class="section">
<div class="section-header">
<h2>–ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤</h2>
<span class="badge" style="background:#666;color:#fff;padding:4px 12px;border-radius:6px;font-size:0.9rem;">
–í—Å–µ–≥–æ: <%= products ? products.length : 0 %>
</span>
</div>

<% if (products && products.length) { %>
<div class="product-grid">
<% products.forEach(p => { %>
<%
// TODO: –í –±—É–¥—É—â–µ–º –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ CSS-–∫–ª–∞—Å—Å—ã (is-approved, is-rejected, is-pending)
let cardStyle = '';
if (p.status === 'rejected') {
cardStyle = 'opacity:0.7;border:2px solid #f44336;';
} else if (p.status === 'approved') {
cardStyle = 'border:2px solid #4caf50;';
} else {
cardStyle = 'border:2px solid #ff9800;';
}
%>
<div class="product-card" <%- cardStyle ? `style="${cardStyle}"` : '' %>>
<h3 class="product-title"><%= p.name %></h3>
<% if (p.image_url) { %>
<img src="<%= p.image_url %>" alt="<%= p.name %>">
<% } else { %>
<div class="no-image">–ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</div>
<% } %>

<div class="product-bottom">
<!-- –°—Ç–∞—Ç—É—Å –∫–∞—Ä—Ç–æ—á–∫–∏ -->
<div style="text-align:center;margin-bottom:10px;">
<% if (p.status === "pending") { %>
<span class="badge" style="background:#ff9800;color:#fff;padding:4px 12px;border-radius:6px;font-size:0.9rem;">
‚è≥ –ù–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏
</span>
<% } else if (p.status === "approved") { %>
<span class="badge" style="background:#4caf50;color:#fff;padding:4px 12px;border-radius:6px;font-size:0.9rem;">
‚úÖ –û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ
</span>
<% } else if (p.status === "rejected") { %>
<span class="badge" style="background:#f44336;color:#fff;padding:4px 12px;border-radius:6px;font-size:0.9rem;">
‚ùå –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ
</span>
<% } else { %>
<span class="badge" style="background:#666;color:#fff;padding:4px 12px;border-radius:6px;font-size:0.9rem;">
‚ö†Ô∏è –ë–µ–∑ —Å—Ç–∞—Ç—É—Å–∞
</span>
<% } %>
</div>

<p class="product-desc"><%= p.description || "‚Äî" %></p>
<div class="row" style="justify-content:center; gap:8px;">
<span class="muted">–¶–µ–Ω–∞:</span>
<strong class="price"><%= p.price %></strong>
</div>

<!-- –í–ª–∞–¥–µ–ª–µ—Ü -->
<% if (p.owner) { %>
<% if (typeof p.owner === 'object' && p.owner.username) { %>
<p class="muted" style="text-align:center;font-size:0.85rem;margin-top:5px;">
üë§ –í–ª–∞–¥–µ–ª–µ—Ü: <%= p.owner.username %>
</p>
<% } else { %>
<p class="muted" style="text-align:center;font-size:0.85rem;margin-top:5px;">
üë§ –í–ª–∞–¥–µ–ª–µ—Ü: ID <%= p.owner %>
</p>
<% } %>
<% } else { %>
<p class="muted" style="text-align:center;font-size:0.85rem;margin-top:5px;color:#f44336;">
‚ö†Ô∏è –í–ª–∞–¥–µ–ª–µ—Ü –Ω–µ —É–∫–∞–∑–∞–Ω (—Å–æ–∑–¥–∞–Ω–æ –∞–¥–º–∏–Ω–æ–º)
</p>
<% } %>

<!-- –ö–∞—Ç–µ–≥–æ—Ä–∏—è -->
<% if (categories && p.category) { %>
<p class="muted" style="text-align:center;font-size:0.85rem;margin-top:5px;">
üìÅ <%= categories[p.category] || p.category %>
</p>
<% } %>

<div class="product-actions" style="flex-direction:column;gap:6px;margin-top:10px;">
<!-- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞/–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ -->
<button class="btn small toggle-visibility-btn"
data-id="<%= p._id %>"
data-status="<%= p.status %>"
style="<%- p.status === 'approved' ? 'background:#f44336;color:#fff;' : (p.status === 'rejected' ? 'background:#4caf50;color:#fff;' : 'background:#4caf50;color:#fff;') %>">
<%= p.status === 'approved' ? 'üö´ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å' : '‚úÖ –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å' %>
</button>

<a class="btn small outline" href="/admin/products/<%= p._id %>/edit">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>

<form method="POST" action="/admin/products/<%= p._id %>/delete" style="display:inline" onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É?');">
<input type="hidden" name="_csrf" value="<%= typeof csrfToken !== 'undefined' ? csrfToken : '' %>">
<button type="submit" class="btn small outline" style="width:100%;">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
</form>

<% if (p.link) { %>
<a class="btn small outline" href="<%= p.link %>" target="_blank" rel="noopener">üîó –°—Å—ã–ª–∫–∞</a>
<% } %>
<% if (p.video_url) { %>
<button class="btn small outline" data-video="<%= p.video_url %>">‚ñ∂Ô∏è –í–∏–¥–µ–æ</button>
<% } %>
</div>

<!-- –†–µ–π—Ç–∏–Ω–≥ (—Ç–æ–ª—å–∫–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ) -->
<div class="product-rating" data-id="<%= p._id %>" style="margin-top:10px;">
<button class="btn icon" type="button" disabled aria-label="–õ–∞–π–∫">‚ñ≤</button>
<span class="result"><%= (p.likes || 0) - (p.dislikes || 0) %></span>
<button class="btn icon" type="button" disabled aria-label="–î–∏–∑–ª–∞–π–∫">‚ñº</button>
<span class="votes">(<%= (p.likes || 0) + (p.dislikes || 0) %> –≥–æ–ª–æ—Å–æ–≤)</span>
</div>
</div>
</div>
<% }) %>
</div>
<% } else { %>
<p class="empty-state">–ü–æ–∫–∞ –Ω–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤</p>
<% } %>
</section>

<!-- –ö–∞—Ç–∞–ª–æ–≥ —É—Å–ª—É–≥ -->
<section class="section">
<div class="section-header">
<h2>–ö–∞—Ç–∞–ª–æ–≥ —É—Å–ª—É–≥</h2>
<span class="badge" style="background:#666;color:#fff;padding:4px 12px;border-radius:6px;font-size:0.9rem;">
–í—Å–µ–≥–æ: <%= services ? services.length : 0 %>
</span>
</div>

<% if (services && services.length) { %>
<div class="product-grid">
<% services.forEach(s => { %>
<%
let cardStyle = '';
if (s.status === 'rejected') {
cardStyle = 'opacity:0.7;border:2px solid #f44336;';
} else if (s.status === 'approved') {
cardStyle = 'border:2px solid #4caf50;';
} else {
cardStyle = 'border:2px solid #ff9800;';
}
%>
<div class="product-card" <%- cardStyle ? `style="${cardStyle}"` : '' %>>
<h3 class="product-title"><%= s.name %></h3>
<% if (s.image_url) { %>
<img src="<%= s.image_url %>" alt="<%= s.name %>">
<% } else { %>
<div class="no-image">–ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</div>
<% } %>

<div class="product-bottom">
<!-- –°—Ç–∞—Ç—É—Å –∫–∞—Ä—Ç–æ—á–∫–∏ -->
<div style="text-align:center;margin-bottom:10px;">
<% if (s.status === "pending") { %>
<span class="badge" style="background:#ff9800;color:#fff;padding:4px 12px;border-radius:6px;font-size:0.9rem;">
‚è≥ –ù–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏
</span>
<% } else if (s.status === "approved") { %>
<span class="badge" style="background:#4caf50;color:#fff;padding:4px 12px;border-radius:6px;font-size:0.9rem;">
‚úÖ –û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ
</span>
<% } else if (s.status === "rejected") { %>
<span class="badge" style="background:#f44336;color:#fff;padding:4px 12px;border-radius:6px;font-size:0.9rem;">
‚ùå –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ
</span>
<% } else { %>
<span class="badge" style="background:#666;color:#fff;padding:4px 12px;border-radius:6px;font-size:0.9rem;">
‚ö†Ô∏è –ë–µ–∑ —Å—Ç–∞—Ç—É—Å–∞
</span>
<% } %>
</div>

<p class="product-desc"><%= s.description || "‚Äî" %></p>
<div class="row" style="justify-content:center; gap:8px;">
<span class="muted">–¶–µ–Ω–∞:</span>
<strong class="price"><%= s.price %></strong>
</div>

<!-- –í–ª–∞–¥–µ–ª–µ—Ü -->
<% if (s.owner) { %>
<% if (typeof s.owner === 'object' && s.owner.username) { %>
<p class="muted" style="text-align:center;font-size:0.85rem;margin-top:5px;">
üë§ –í–ª–∞–¥–µ–ª–µ—Ü: <%= s.owner.username %>
</p>
<% } else { %>
<p class="muted" style="text-align:center;font-size:0.85rem;margin-top:5px;">
üë§ –í–ª–∞–¥–µ–ª–µ—Ü: ID <%= s.owner %>
</p>
<% } %>
<% } else { %>
<p class="muted" style="text-align:center;font-size:0.85rem;margin-top:5px;color:#f44336;">
‚ö†Ô∏è –í–ª–∞–¥–µ–ª–µ—Ü –Ω–µ —É–∫–∞–∑–∞–Ω (—Å–æ–∑–¥–∞–Ω–æ –∞–¥–º–∏–Ω–æ–º)
</p>
<% } %>

<!-- –ö–∞—Ç–µ–≥–æ—Ä–∏—è -->
<% if (categories && s.category) { %>
<p class="muted" style="text-align:center;font-size:0.85rem;margin-top:5px;">
üìÅ <%= categories[s.category] || s.category %>
</p>
<% } %>

<div class="product-actions" style="flex-direction:column;gap:6px;margin-top:10px;">
<!-- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞/–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ -->
<button class="btn small toggle-visibility-btn"
data-id="<%= s._id %>"
data-status="<%= s.status %>"
style="<%- s.status === 'approved' ? 'background:#f44336;color:#fff;' : (s.status === 'rejected' ? 'background:#4caf50;color:#fff;' : 'background:#4caf50;color:#fff;') %>">
<%= s.status === 'approved' ? 'üö´ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å' : '‚úÖ –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å' %>
</button>

<a class="btn small outline" href="/admin/services/<%= s._id %>/edit">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>

<form method="POST" action="/admin/services/<%= s._id %>/delete" style="display:inline" onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É?');">
<input type="hidden" name="_csrf" value="<%= typeof csrfToken !== 'undefined' ? csrfToken : '' %>">
<button type="submit" class="btn small outline" style="width:100%;">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
</form>

<% if (s.link) { %>
<a class="btn small outline" href="<%= s.link %>" target="_blank" rel="noopener">üîó –°—Å—ã–ª–∫–∞</a>
<% } %>
<% if (s.video_url) { %>
<button class="btn small outline" data-video="<%= s.video_url %>">‚ñ∂Ô∏è –í–∏–¥–µ–æ</button>
<% } %>
</div>

<!-- –†–µ–π—Ç–∏–Ω–≥ (—Ç–æ–ª—å–∫–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ) -->
<div class="product-rating" data-id="<%= s._id %>" style="margin-top:10px;">
<button class="btn icon" type="button" disabled aria-label="–õ–∞–π–∫">‚ñ≤</button>
<span class="result"><%= (s.likes || 0) - (s.dislikes || 0) %></span>
<button class="btn icon" type="button" disabled aria-label="–î–∏–∑–ª–∞–π–∫">‚ñº</button>
<span class="votes">(<%= (s.likes || 0) + (s.dislikes || 0) %> –≥–æ–ª–æ—Å–æ–≤)</span>
</div>
</div>
</div>
<% }) %>
</div>
<% } else { %>
<p class="empty-state">–ü–æ–∫–∞ –Ω–µ—Ç —É—Å–ª—É–≥</p>
<% } %>
</section>

<!-- –ö–∞—Ç–∞–ª–æ–≥ –±–∞–Ω–Ω–µ—Ä–æ–≤ -->
<section class="section">
<div class="section-header">
<h2>–ö–∞—Ç–∞–ª–æ–≥ –±–∞–Ω–Ω–µ—Ä–æ–≤</h2>
<span class="badge" style="background:#666;color:#fff;padding:4px 12px;border-radius:6px;font-size:0.9rem;">
–í—Å–µ–≥–æ: <%= banners ? banners.length : 0 %>
</span>
</div>

<% if (banners && banners.length) { %>
<div class="product-grid">
<% banners.forEach(b => { %>
<%
let cardStyle = '';
if (b.status === 'rejected' || b.status === 'blocked') {
cardStyle = 'opacity:0.7;border:2px solid #f44336;';
} else if (b.status === 'approved' || b.status === 'published') {
cardStyle = 'border:2px solid #4caf50;';
} else {
cardStyle = 'border:2px solid #ff9800;';
}
%>
<div class="product-card" <%- cardStyle ? `style="${cardStyle}"` : '' %>>
<h3 class="product-title"><%= b.title || '–ë–∞–Ω–Ω–µ—Ä' %></h3>
<% if (b.image_url || (b.images && b.images.length > 0)) { %>
<img src="<%= b.image_url || b.images[0] %>" alt="<%= b.title || '–ë–∞–Ω–Ω–µ—Ä' %>" style="max-height: 200px; object-fit: cover;">
<% } else { %>
<div class="no-image">–ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</div>
<% } %>

<div class="product-bottom">
<!-- –°—Ç–∞—Ç—É—Å –∫–∞—Ä—Ç–æ—á–∫–∏ -->
<div style="text-align:center;margin-bottom:10px;">
<% if (b.status === "pending") { %>
<span class="badge" style="background:#ff9800;color:#fff;padding:4px 12px;border-radius:6px;font-size:0.9rem;">
‚è≥ –ù–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏
</span>
<% } else if (b.status === "approved" || b.status === "published") { %>
<span class="badge" style="background:#4caf50;color:#fff;padding:4px 12px;border-radius:6px;font-size:0.9rem;">
‚úÖ –û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ
</span>
<% } else if (b.status === "rejected" || b.status === "blocked") { %>
<span class="badge" style="background:#f44336;color:#fff;padding:4px 12px;border-radius:6px;font-size:0.9rem;">
‚ùå –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ
</span>
<% } else { %>
<span class="badge" style="background:#666;color:#fff;padding:4px 12px;border-radius:6px;font-size:0.9rem;">
‚ö†Ô∏è –ë–µ–∑ —Å—Ç–∞—Ç—É—Å–∞
</span>
<% } %>
</div>

<p class="product-desc"><%= b.description || "‚Äî" %></p>
<% if (b.price && b.price > 0) { %>
<div class="row" style="justify-content:center; gap:8px;">
<span class="muted">–¶–µ–Ω–∞:</span>
<strong class="price"><%= b.price %></strong>
</div>
<% } %>

<!-- –í–ª–∞–¥–µ–ª–µ—Ü -->
<% if (b.owner) { %>
<% if (typeof b.owner === 'object' && b.owner.username) { %>
<p class="muted" style="text-align:center;font-size:0.85rem;margin-top:5px;">
üë§ –í–ª–∞–¥–µ–ª–µ—Ü: <%= b.owner.username %>
</p>
<% } else { %>
<p class="muted" style="text-align:center;font-size:0.85rem;margin-top:5px;">
üë§ –í–ª–∞–¥–µ–ª–µ—Ü: ID <%= b.owner %>
</p>
<% } %>
<% } else { %>
<p class="muted" style="text-align:center;font-size:0.85rem;margin-top:5px;color:#f44336;">
‚ö†Ô∏è –í–ª–∞–¥–µ–ª–µ—Ü –Ω–µ —É–∫–∞–∑–∞–Ω (—Å–æ–∑–¥–∞–Ω–æ –∞–¥–º–∏–Ω–æ–º)
</p>
<% } %>

<!-- –ö–∞—Ç–µ–≥–æ—Ä–∏—è -->
<% if (b.category) { %>
<p class="muted" style="text-align:center;font-size:0.85rem;margin-top:5px;">
üìÅ <%= b.category %>
</p>
<% } %>

<div class="product-actions" style="flex-direction:column;gap:6px;margin-top:10px;">
<!-- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞/–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ -->
<button class="btn small toggle-visibility-btn"
data-id="<%= b._id %>"
data-status="<%= b.status %>"
data-type="banner"
style="<%- (b.status === 'approved' || b.status === 'published') ? 'background:#f44336;color:#fff;' : ((b.status === 'rejected' || b.status === 'blocked') ? 'background:#4caf50;color:#fff;' : 'background:#4caf50;color:#fff;') %>">
<%= (b.status === 'approved' || b.status === 'published') ? 'üö´ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å' : '‚úÖ –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å' %>
</button>

<a class="btn small outline" href="/admin/banners/<%= b._id %>/edit">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>

<form method="POST" action="/admin/banners/<%= b._id %>/delete" style="display:inline" onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å –±–∞–Ω–Ω–µ—Ä?');">
<input type="hidden" name="_csrf" value="<%= typeof csrfToken !== 'undefined' ? csrfToken : '' %>">
<button type="submit" class="btn small outline" style="width:100%;">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
</form>

<% if (b.link) { %>
<a class="btn small outline" href="<%= b.link %>" target="_blank" rel="noopener">üîó –°—Å—ã–ª–∫–∞</a>
<% } %>
<% if (b.video_url) { %>
<button class="btn small outline" data-video="<%= b.video_url %>">‚ñ∂Ô∏è –í–∏–¥–µ–æ</button>
<% } %>
</div>

<!-- –†–µ–π—Ç–∏–Ω–≥ (—Ç–æ–ª—å–∫–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ) -->
<div class="product-rating" data-id="<%= b._id %>" style="margin-top:10px;">
<button class="btn icon" type="button" disabled aria-label="–õ–∞–π–∫">‚ñ≤</button>
<span class="result"><%= (b.rating_up || 0) - (b.rating_down || 0) %></span>
<button class="btn icon" type="button" disabled aria-label="–î–∏–∑–ª–∞–π–∫">‚ñº</button>
<span class="votes">(<%= (b.rating_up || 0) + (b.rating_down || 0) %> –≥–æ–ª–æ—Å–æ–≤)</span>
</div>
</div>
</div>
<% }) %>
</div>
<% } else { %>
<p class="empty-state">–ü–æ–∫–∞ –Ω–µ—Ç –±–∞–Ω–Ω–µ—Ä–æ–≤</p>
<% } %>
</section>
</main>

<footer class="footer">
<p>¬© 2025 EXTO Ecosystem</p>
</footer>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è -->
<div id="rejectModal" class="modal" aria-hidden="true" style="display:none;">
<div class="modal-content" role="dialog" aria-modal="true" aria-label="–û—Ç–∫–ª–æ–Ω–∏—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É">
<button class="close" data-close-reject aria-label="–ó–∞–∫—Ä—ã—Ç—å">&times;</button>
<h3>–û—Ç–∫–ª–æ–Ω–∏—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É</h3>
<form id="rejectForm">
<textarea name="reason" placeholder="–ü—Ä–∏—á–∏–Ω–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)" rows="4" style="width:100%;padding:8px;border-radius:6px;border:1px solid #444;background:#2b2b2b;color:#fff;resize:vertical;"></textarea>
<button type="submit" class="btn" style="background:#f44336;color:#fff;margin-top:10px;">–û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>
</form>
</div>
</div>

<!-- FIX: –ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π overlay –¥–ª—è YouTube –≤–∏–¥–µ–æ -->
<div id="videoOverlay" class="video-overlay" aria-hidden="true" style="display:none;">
<div class="video-overlay-container">
<button class="video-overlay-close" data-close-video aria-label="–ó–∞–∫—Ä—ã—Ç—å –≤–∏–¥–µ–æ">&times;</button>
<div class="video-overlay-iframe-container" id="videoIframeContainer">
<!-- FIX: iframe —Å–æ–∑–¥–∞–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –ø–æ –∫–ª–∏–∫—É -->
</div>
</div>
</div>

<script>
// FIX: –£–î–ê–õ–ï–ù –î–£–ë–õ–ò–†–£–Æ–©–ò–ô –ö–û–î - —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –µ–¥–∏–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∏–∑ public/script.js
// –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≤–∏–¥–µ–æ (getVideoType, extractVideoId, createYouTubeIframe –∏ —Ç.–¥.)
// —Ç–µ–ø–µ—Ä—å –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ public/script.js –∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —á–µ—Ä–µ–∑ –µ–¥–∏–Ω—ã–π API

// –ì–ª–æ–±–∞–ª—å–Ω—ã–π CSRF —Ç–æ–∫–µ–Ω
const CSRF_TOKEN = "<%- typeof csrfToken !== 'undefined' ? csrfToken : '' %>";

// Helper —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è POST –∑–∞–ø—Ä–æ—Å–æ–≤ —Å CSRF
async function postJSON(url, data = {}) {
return fetch(url, {
method: "POST",
headers: {
"Content-Type": "application/json",
"X-CSRF-Token": CSRF_TOKEN
},
body: JSON.stringify(data)
});
}

document.addEventListener("DOMContentLoaded", () => {
console.log("üîß –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏");

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã—Ö–æ–¥–∞
const logoutForm = document.getElementById("logoutForm");
if (logoutForm) {
logoutForm.addEventListener("submit", async (e) => {
e.preventDefault();
if (!confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏?")) return;
try {
const res = await fetch("/logout", { method: "POST" });
if (res.ok) {
window.location.href = "/";
}
} catch (err) {
console.error("–û—à–∏–±–∫–∞ –≤—ã—Ö–æ–¥–∞:", err);
window.location.href = "/";
}
});
}

// –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞/–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–∞—Ä—Ç–æ—á–µ–∫ (—Ç–æ–≤–∞—Ä—ã, —É—Å–ª—É–≥–∏, –±–∞–Ω–Ω–µ—Ä—ã)
const toggleBtns = document.querySelectorAll(".toggle-visibility-btn");
toggleBtns.forEach(btn => {
btn.addEventListener("click", async (e) => {
e.preventDefault();
e.stopPropagation();
const id = btn.getAttribute("data-id");
const currentStatus = btn.getAttribute("data-status");
const itemType = btn.getAttribute("data-type") || "product"; // product, service, banner
const action = (currentStatus === "approved" || currentStatus === "published") ? "–∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å" : "—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å";
if (!confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ ${action} —ç—Ç—É –∫–∞—Ä—Ç–æ—á–∫—É?`)) return;

try {
// –û–ø—Ä–µ–¥–µ–ª—è–µ–º —ç–Ω–¥–ø–æ–∏–Ω—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞
let endpoint;
if (itemType === "banner") {
endpoint = `/admin/banners/${id}/toggle-visibility`;
} else if (itemType === "service") {
endpoint = `/admin/services/${id}/toggle-visibility`;
} else {
endpoint = `/admin/products/${id}/toggle-visibility`;
}

const res = await postJSON(endpoint);
const data = await res.json();
if (data.success) {
alert(data.message || "–°—Ç–∞—Ç—É—Å –∫–∞—Ä—Ç–æ—á–∫–∏ –∏–∑–º–µ–Ω–µ–Ω");
location.reload();
} else {
alert("–û—à–∏–±–∫–∞: " + (data.message || "–ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å"));
}
} catch (err) {
console.error("‚ùå –û—à–∏–±–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏:", err);
alert("–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: " + err.message);
}
});
});

// –ú–æ–¥–µ—Ä–∞—Ü–∏—è: –æ–¥–æ–±—Ä–µ–Ω–∏–µ
const approveBtns = document.querySelectorAll(".approve-btn");
approveBtns.forEach(btn => {
btn.addEventListener("click", async (e) => {
e.preventDefault();
e.stopPropagation();
const id = btn.getAttribute("data-id");
if (!confirm("–û–¥–æ–±—Ä–∏—Ç—å —ç—Ç—É –∫–∞—Ä—Ç–æ—á–∫—É?")) return;
try {
// –û–ø—Ä–µ–¥–µ–ª—è–µ–º —ç–Ω–¥–ø–æ–∏–Ω—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –∫–∞—Ä—Ç–æ—á–∫–∏
const itemType = btn.getAttribute("data-type") || "product";
let endpoint;
if (itemType === "banner") {
endpoint = `/admin/banners/${id}/approve`;
} else if (itemType === "service") {
endpoint = `/admin/services/${id}/approve`;
} else {
endpoint = `/admin/products/${id}/approve`;
}
const res = await postJSON(endpoint);
const data = await res.json();
if (data.success) {
alert("–ö–∞—Ä—Ç–æ—á–∫–∞ –æ–¥–æ–±—Ä–µ–Ω–∞!");
location.reload();
} else {
alert("–û—à–∏–±–∫–∞: " + (data.message || "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞"));
}
} catch (err) {
console.error("‚ùå –û—à–∏–±–∫–∞ –æ–¥–æ–±—Ä–µ–Ω–∏—è:", err);
alert("–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: " + err.message);
}
});
});

// –ú–æ–¥–µ—Ä–∞—Ü–∏—è: –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ
const rejectModal = document.getElementById("rejectModal");
const rejectForm = document.getElementById("rejectForm");
let currentRejectId = null;
let currentRejectType = "product"; // –¢–∏–ø –∫–∞—Ä—Ç–æ—á–∫–∏ –¥–ª—è –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è

document.querySelectorAll(".reject-btn").forEach(btn => {
btn.addEventListener("click", () => {
currentRejectId = btn.getAttribute("data-id");
currentRejectType = btn.getAttribute("data-type") || "product"; // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–∏–ø –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ —Ñ–æ—Ä–º–µ
rejectModal.style.display = "block";
rejectModal.setAttribute("aria-hidden", "false");
});
});

const closeRejectBtn = document.querySelector("[data-close-reject]");
if (closeRejectBtn) {
closeRejectBtn.addEventListener("click", () => {
rejectModal.style.display = "none";
rejectModal.setAttribute("aria-hidden", "true");
rejectForm && rejectForm.reset();
currentRejectId = null;
currentRejectType = "product";
});
}

if (rejectForm) {
rejectForm.addEventListener("submit", async (e) => {
e.preventDefault();
if (!currentRejectId) return;
const reason = new FormData(rejectForm).get("reason") || "–ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø—Ä–∞–≤–∏–ª–∞–º –ø—É–±–ª–∏–∫–∞—Ü–∏–∏";
try {
// –û–ø—Ä–µ–¥–µ–ª—è–µ–º —ç–Ω–¥–ø–æ–∏–Ω—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –∫–∞—Ä—Ç–æ—á–∫–∏
let rejectEndpoint;
if (currentRejectType === "banner") {
rejectEndpoint = `/admin/banners/${currentRejectId}/reject`;
} else if (currentRejectType === "service") {
rejectEndpoint = `/admin/services/${currentRejectId}/reject`;
} else {
rejectEndpoint = `/admin/products/${currentRejectId}/reject`;
}
const res = await postJSON(rejectEndpoint, { reason });
const data = await res.json();
if (data.success) {
alert("–ö–∞—Ä—Ç–æ—á–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞");
location.reload();
} else {
alert("–û—à–∏–±–∫–∞: " + (data.message || "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞"));
}
} catch (err) {
console.error("–û—à–∏–±–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è:", err);
alert("–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: " + err.message);
}
});
}

// –ú–æ–¥–µ—Ä–∞—Ü–∏—è –±–∞–Ω–Ω–µ—Ä–æ–≤: –æ–¥–æ–±—Ä–µ–Ω–∏–µ
const approveBannerBtns = document.querySelectorAll(".approve-banner-btn");
approveBannerBtns.forEach(btn => {
btn.addEventListener("click", async (e) => {
e.preventDefault();
e.stopPropagation();
const id = btn.getAttribute("data-id");
if (!confirm("–û–¥–æ–±—Ä–∏—Ç—å —ç—Ç–æ—Ç –±–∞–Ω–Ω–µ—Ä?")) return;
try {
const res = await postJSON(`/admin/banners/${id}/approve`);
const data = await res.json();
if (data.success) {
alert("–ë–∞–Ω–Ω–µ—Ä –æ–¥–æ–±—Ä–µ–Ω!");
location.reload();
} else {
alert("–û—à–∏–±–∫–∞: " + (data.message || "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞"));
}
} catch (err) {
console.error("‚ùå –û—à–∏–±–∫–∞ –æ–¥–æ–±—Ä–µ–Ω–∏—è –±–∞–Ω–Ω–µ—Ä–∞:", err);
alert("–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: " + err.message);
}
});
});

// –ú–æ–¥–µ—Ä–∞—Ü–∏—è –±–∞–Ω–Ω–µ—Ä–æ–≤: –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ
document.querySelectorAll(".reject-banner-btn").forEach(btn => {
btn.addEventListener("click", () => {
const id = btn.getAttribute("data-id");
const reason = prompt("–£–∫–∞–∂–∏—Ç–µ –ø—Ä–∏—á–∏–Ω—É –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):") || "–ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø—Ä–∞–≤–∏–ª–∞–º –ø—É–±–ª–∏–∫–∞—Ü–∏–∏";
if (reason === null) return; // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–º–µ–Ω–∏–ª

(async () => {
try {
const res = await postJSON(`/admin/banners/${id}/reject`, { reason });
const data = await res.json();
if (data.success) {
alert("–ë–∞–Ω–Ω–µ—Ä –æ—Ç–∫–ª–æ–Ω–µ–Ω");
location.reload();
} else {
alert("–û—à–∏–±–∫–∞: " + (data.message || "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞"));
}
} catch (err) {
console.error("–û—à–∏–±–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –±–∞–Ω–Ω–µ—Ä–∞:", err);
alert("–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: " + err.message);
}
})();
});
});

// FIX: –£–î–ê–õ–ï–ù –î–£–ë–õ–ò–†–£–Æ–©–ò–ô –ö–û–î –í–ò–î–ï–û-–õ–û–ì–ò–ö–ò - —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –µ–¥–∏–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∏–∑ public/script.js
// –§—É–Ω–∫—Ü–∏–∏ openVideoOverlay, closeVideoOverlay –∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–ª–∏–∫–æ–≤ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ public/script.js

// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã —Å–æ–∑–¥–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ –∞–¥–º–∏–Ω–æ–º
const adminCreateForm = document.getElementById('adminCreateProductForm');
const adminCreateMsg = document.getElementById('adminCreateMsg');
const adminImagesInput = document.getElementById('adminImages');
const adminImagePreview = document.getElementById('adminImagePreview');

if (adminCreateForm) {
adminCreateForm.addEventListener('submit', async function(e) {
e.preventDefault();

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
if (adminImagesInput && adminImagesInput.files.length > 5) {
adminCreateMsg.textContent = '–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π: 5';
adminCreateMsg.style.color = '#b00020';
return;
}

adminCreateMsg.textContent = '–û—Ç–ø—Ä–∞–≤–∫–∞...';
adminCreateMsg.style.color = '#666';

const formData = new FormData(adminCreateForm);

try {
const res = await fetch('/admin/products', {
method: 'POST',
body: formData
});

const contentType = res.headers.get("content-type");
if (contentType && contentType.includes("application/json")) {
const data = await res.json();
if (data.success) {
adminCreateMsg.textContent = '–¢–æ–≤–∞—Ä —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!';
adminCreateMsg.style.color = 'green';
adminCreateForm.reset();
adminImagePreview.innerHTML = '';
adminImagePreview.style.display = 'none';
setTimeout(() => {
location.reload();
}, 1500);
} else {
adminCreateMsg.textContent = data.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞';
adminCreateMsg.style.color = '#b00020';
}
} else {
// –ï—Å–ª–∏ –æ—Ç–≤–µ—Ç HTML (redirect), –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É
location.reload();
}
} catch (err) {
adminCreateMsg.textContent = '–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + err.message;
adminCreateMsg.style.color = '#b00020';
}
});
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã —Å–æ–∑–¥–∞–Ω–∏—è –±–∞–Ω–Ω–µ—Ä–∞ –∞–¥–º–∏–Ω–æ–º
const adminCreateBannerForm = document.getElementById('adminCreateBannerForm');
const adminCreateBannerMsg = document.getElementById('adminCreateBannerMsg');
const adminBannerImagesInput = document.getElementById('adminBannerImages');
const adminBannerImagePreview = document.getElementById('adminBannerImagePreview');

if (adminCreateBannerForm) {
adminCreateBannerForm.addEventListener('submit', async function(e) {
e.preventDefault();

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
if (adminBannerImagesInput && adminBannerImagesInput.files.length > 5) {
adminCreateBannerMsg.textContent = '–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π: 5';
adminCreateBannerMsg.style.color = '#b00020';
return;
}

adminCreateBannerMsg.textContent = '–û—Ç–ø—Ä–∞–≤–∫–∞...';
adminCreateBannerMsg.style.color = '#666';

const formData = new FormData(adminCreateBannerForm);

try {
const res = await fetch('/admin/banners', {
method: 'POST',
body: formData
});

const contentType = res.headers.get("content-type");
if (contentType && contentType.includes("application/json")) {
const data = await res.json();
if (data.success) {
adminCreateBannerMsg.textContent = '‚úÖ –ë–∞–Ω–Ω–µ—Ä —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!';
adminCreateBannerMsg.style.color = 'green';
adminCreateBannerForm.reset();
adminBannerImagePreview.innerHTML = '';
adminBannerImagePreview.style.display = 'none';
setTimeout(() => {
location.reload();
}, 1500);
} else {
adminCreateBannerMsg.textContent = data.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –±–∞–Ω–Ω–µ—Ä–∞';
adminCreateBannerMsg.style.color = '#b00020';
}
} else {
// –ï—Å–ª–∏ –æ—Ç–≤–µ—Ç HTML (redirect), –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É
location.reload();
}
} catch (err) {
adminCreateBannerMsg.textContent = '–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + err.message;
adminCreateBannerMsg.style.color = '#b00020';
}
});
}

// –ü—Ä–µ–≤—å—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è –∞–¥–º–∏–Ω-—Ñ–æ—Ä–º—ã –±–∞–Ω–Ω–µ—Ä–æ–≤
if (adminBannerImagesInput && adminBannerImagePreview) {
adminBannerImagesInput.addEventListener('change', function(e) {
const files = Array.from(e.target.files);
const maxFiles = 5;

if (files.length > maxFiles) {
alert(`–ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –Ω–µ –±–æ–ª–µ–µ ${maxFiles} –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π`);
e.target.value = '';
adminBannerImagePreview.innerHTML = '';
adminBannerImagePreview.style.display = 'none';
return;
}

adminBannerImagePreview.innerHTML = '';

if (files.length === 0) {
adminBannerImagePreview.style.display = 'none';
return;
}

adminBannerImagePreview.style.display = 'grid';
adminBannerImagePreview.style.gridTemplateColumns = 'repeat(auto-fill, minmax(100px, 1fr))';
adminBannerImagePreview.style.gap = '10px';
adminBannerImagePreview.style.marginTop = '10px';

files.forEach((file) => {
if (file.size > 5 * 1024 * 1024) {
alert(`–§–∞–π–ª "${file.name}" —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π (–º–∞–∫—Å–∏–º—É–º 5MB)`);
return;
}

const reader = new FileReader();
reader.onload = function(e) {
const div = document.createElement('div');
div.style.position = 'relative';
div.style.aspectRatio = '1';
div.style.overflow = 'hidden';
div.style.borderRadius = '8px';
div.style.border = '2px solid #ddd';

const img = document.createElement('img');
img.src = e.target.result;
img.style.width = '100%';
img.style.height = '100%';
img.style.objectFit = 'cover';

div.appendChild(img);
adminBannerImagePreview.appendChild(div);
};
reader.readAsDataURL(file);
});
});
}

// –ü—Ä–µ–≤—å—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è –∞–¥–º–∏–Ω-—Ñ–æ—Ä–º—ã
if (adminImagesInput && adminImagePreview) {
adminImagesInput.addEventListener('change', function(e) {
const files = Array.from(e.target.files);
const maxFiles = 5;

if (files.length > maxFiles) {
alert(`–ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –Ω–µ –±–æ–ª–µ–µ ${maxFiles} –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π`);
e.target.value = '';
adminImagePreview.innerHTML = '';
adminImagePreview.style.display = 'none';
return;
}

adminImagePreview.innerHTML = '';

if (files.length === 0) {
adminImagePreview.style.display = 'none';
return;
}

adminImagePreview.style.display = 'grid';

files.forEach((file) => {
if (file.size > 5 * 1024 * 1024) {
alert(`–§–∞–π–ª "${file.name}" —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π (–º–∞–∫—Å–∏–º—É–º 5MB)`);
return;
}

const reader = new FileReader();
reader.onload = function(e) {
const div = document.createElement('div');
div.style.position = 'relative';
div.style.aspectRatio = '1';
div.style.overflow = 'hidden';
div.style.borderRadius = '8px';
div.style.border = '2px solid #ddd';

const img = document.createElement('img');
img.src = e.target.result;
img.style.width = '100%';
img.style.height = '100%';
img.style.objectFit = 'cover';

div.appendChild(img);
adminImagePreview.appendChild(div);
};
reader.readAsDataURL(file);
});
});
}
});
</script>

<!-- FIX: –ó–∞–≥—Ä—É–∂–∞–µ–º YouTube IFrame API –ø–µ—Ä–µ–¥ –æ—Å–Ω–æ–≤–Ω—ã–º —Å–∫—Ä–∏–ø—Ç–æ–º –¥–ª—è –µ–¥–∏–Ω–æ–π –ª–æ–≥–∏–∫–∏ –≤–∏–¥–µ–æ -->
<script>
// –ó–∞–≥—Ä—É–∑–∫–∞ YouTube IFrame API
var tag = document.createElement('script');
tag.src = "https://www.youtube.com/iframe_api";
var firstScriptTag = document.getElementsByTagName('script')[0];
firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
</script>

<!-- FIX: –ü–æ–¥–∫–ª—é—á–∞–µ–º –µ–¥–∏–Ω—É—é –ª–æ–≥–∏–∫—É –≤–∏–¥–µ–æ-–ø–ª–µ–µ—Ä–æ–≤ –∏–∑ public/script.js -->
<script src="/script.js"></script>

<style>
.modal {
display: none;
position: fixed;
z-index: 2000;
left: 0;
top: 0;
width: 100%;
height: 100%;
background-color: rgba(0,0,0,0.8);
}
.modal-content {
background-color: #1a1a1a;
margin: 5% auto;
padding: 20px;
border: 1px solid #444;
border-radius: 12px;
width: 90%;
max-width: 600px;
position: relative;
}
.close {
color: #aaa;
float: right;
font-size: 28px;
font-weight: bold;
cursor: pointer;
background: none;
border: none;
position: absolute;
right: 15px;
top: 10px;
}
.close:hover {
color: #fff;
}
</style>
</body>
</html>