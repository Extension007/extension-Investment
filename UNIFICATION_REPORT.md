# –û—Ç—á—ë—Ç –æ–± —É–Ω–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è—Ö

## –î–∞—Ç–∞: 2024-12-19

## –¶–µ–ª—å
–£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –ª–æ–≥–∏–∫–∏ –≤–∏–¥–µ–æ-–ø–ª–µ–µ—Ä–æ–≤, —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä—É—é—â–µ–≥–æ –∫–æ–¥–∞, –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –æ–±—ä—è–≤–ª–µ–Ω–∏–π –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö, —É–ª—É—á—à–µ–Ω–∏–µ CSP –Ω–∞—Å—Ç—Ä–æ–µ–∫.

---

## 1. –ê—É–¥–∏—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `productId`

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞—É–¥–∏—Ç–∞:
- –ù–∞–π–¥–µ–Ω–æ 3 –æ–±—ä—è–≤–ª–µ–Ω–∏—è `const productId` –≤ `public/script.js`:
  1. **–°—Ç—Ä–æ–∫–∞ 148**: –≤–Ω—É—Ç—Ä–∏ `forEach` callback - –æ–±–ª–∞—Å—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∞ callback
  2. **–°—Ç—Ä–æ–∫–∞ 967**: –≤–Ω—É—Ç—Ä–∏ `addEventListener` callback - –æ–±–ª–∞—Å—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∞ callback
  3. **–°—Ç—Ä–æ–∫–∞ 1430**: –≤–Ω—É—Ç—Ä–∏ `addEventListener` callback - –æ–±–ª–∞—Å—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∞ callback

### –í—ã–≤–æ–¥:
‚úÖ **–ö–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –Ω–µ—Ç** - –≤—Å–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ —Ä–∞–∑–Ω—ã—Ö –æ–±–ª–∞—Å—Ç—è—Ö –≤–∏–¥–∏–º–æ—Å—Ç–∏ (—Ä–∞–∑–Ω—ã–µ callback —Ñ—É–Ω–∫—Ü–∏–∏). –≠—Ç–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ JavaScript scope.

---

## 2. –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –ª–æ–≥–∏–∫–∏ –≤–∏–¥–µ–æ-–ø–ª–µ–µ—Ä–æ–≤

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `views/admin.ejs`:

**–£–¥–∞–ª–µ–Ω–æ:**
- –î—É–±–ª–∏—Ä—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏: `getVideoType()`, `extractVideoId()`, `extractVKVideoParams()`, `extractInstagramPostId()`, `getInstagramEmbed()`
- –î—É–±–ª–∏—Ä—É—é—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è `createYouTubeIframe()` (–ø—Ä–æ—Å—Ç–æ–π iframe –±–µ–∑ API)
- –î—É–±–ª–∏—Ä—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ `buildVKEmbedUrl()`, `buildInstagramEmbedUrl()`
- –î—É–±–ª–∏—Ä—É—é—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è `openVideoOverlay()` (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
- –î—É–±–ª–∏—Ä—É—é—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è `createYouTubePlayer()` (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è –≤–µ—Ä—Å–∏—è —Å –∞–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ–º)
- –î—É–±–ª–∏—Ä—É—é—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è `closeVideoOverlay()` (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
- –î—É–±–ª–∏—Ä—É—é—â–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–ª–∏–∫–æ–≤ –¥–ª—è –≤–∏–¥–µ–æ

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ YouTube IFrame API –ø–µ—Ä–µ–¥ –æ—Å–Ω–æ–≤–Ω—ã–º —Å–∫—Ä–∏–ø—Ç–æ–º
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –µ–¥–∏–Ω–æ–π –ª–æ–≥–∏–∫–∏ –∏–∑ `public/script.js`

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `views/cabinet.ejs`:

**–£–¥–∞–ª–µ–Ω–æ:**
- –î—É–±–ª–∏—Ä—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏: `getVideoType()`, `extractVideoId()`, `extractVKVideoParams()`, `extractInstagramPostId()`, `getInstagramEmbed()`
- –î—É–±–ª–∏—Ä—É—é—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è `createYouTubeIframe()` (–ø—Ä–æ—Å—Ç–æ–π iframe –±–µ–∑ API)
- –î—É–±–ª–∏—Ä—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ `buildVKEmbedUrl()`, `buildInstagramEmbedUrl()`
- –î—É–±–ª–∏—Ä—É—é—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è `openVideoOverlay()` (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
- –î—É–±–ª–∏—Ä—É—é—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è `closeVideoOverlay()` (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
- –î—É–±–ª–∏—Ä—É—é—â–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–ª–∏–∫–æ–≤ –¥–ª—è –≤–∏–¥–µ–æ

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ YouTube IFrame API –ø–µ—Ä–µ–¥ –æ—Å–Ω–æ–≤–Ω—ã–º —Å–∫—Ä–∏–ø—Ç–æ–º
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –µ–¥–∏–Ω–æ–π –ª–æ–≥–∏–∫–∏ –∏–∑ `public/script.js`

### –†–µ–∑—É–ª—å—Ç–∞—Ç:
‚úÖ **–ï–¥–∏–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤–∏–¥–µ–æ-–ø–ª–µ–µ—Ä–æ–≤** - –≤—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (`index.ejs`, `admin.ejs`, `cabinet.ejs`) —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É—é—Ç –µ–¥–∏–Ω—É—é –ª–æ–≥–∏–∫—É –∏–∑ `public/script.js` —Å YouTube IFrame API, —á—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:
- –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –Ω–∞ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ 153
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ Play
- –ü–æ–¥–¥–µ—Ä–∂–∫—É YouTube Shorts, VK, Instagram

---

## 3. –£–ª—É—á—à–µ–Ω–∏–µ CSP –Ω–∞—Å—Ç—Ä–æ–µ–∫

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `server.js`:

**–î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:**
- –ü–æ—è—Å–Ω–µ–Ω–∏–µ –¥–ª—è `scriptSrc` - —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ YouTube IFrame API
- –ü–æ—è—Å–Ω–µ–Ω–∏–µ –¥–ª—è `connectSrc` - —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ Instagram oEmbed API
- –ü–æ—è—Å–Ω–µ–Ω–∏–µ –¥–ª—è `frameSrc` - —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –≤—Å–µ—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö iframe –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:**
- ‚úÖ `scriptSrc` –≤–∫–ª—é—á–∞–µ—Ç YouTube IFrame API (`https://www.youtube.com`, `https://youtube.com`, `https://*.youtube.com`)
- ‚úÖ `frameSrc` –≤–∫–ª—é—á–∞–µ—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏:
  - YouTube: `https://www.youtube.com`, `https://youtube.com`, `https://youtu.be`, `https://*.youtube.com`, `https://www.youtube-nocookie.com`, `https://m.youtube.com`
  - VK: `https://vk.com`, `https://*.vk.com`
  - Instagram: `https://www.instagram.com`, `https://*.instagram.com`
- ‚úÖ `connectSrc` –≤–∫–ª—é—á–∞–µ—Ç Instagram oEmbed API (`https://api.instagram.com`)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
‚úÖ **CSP –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ** - –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã –µ–¥–∏–Ω–æ–π –ª–æ–≥–∏–∫–∏ –≤–∏–¥–µ–æ-–ø–ª–µ–µ—Ä–æ–≤ –Ω–∞ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö.

---

## 4. –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ –∫–æ–¥–µ

### –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ FIX:
- –í `views/admin.ejs`: –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –æ —É–¥–∞–ª–µ–Ω–∏–∏ –¥—É–±–ª–∏—Ä—É—é—â–µ–≥–æ –∫–æ–¥–∞
- –í `views/cabinet.ejs`: –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –æ —É–¥–∞–ª–µ–Ω–∏–∏ –¥—É–±–ª–∏—Ä—É—é—â–µ–≥–æ –∫–æ–¥–∞
- –í `server.js`: –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö CSP –¥–ª—è –µ–¥–∏–Ω–æ–π –ª–æ–≥–∏–∫–∏ –≤–∏–¥–µ–æ-–ø–ª–µ–µ—Ä–æ–≤

---

## –ò—Ç–æ–≥–æ–≤—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ:
1. –ü—Ä–æ–≤–µ–¥—ë–Ω –∞—É–¥–∏—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `productId` - –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ
2. –£–¥–∞–ª—ë–Ω –¥—É–±–ª–∏—Ä—É—é—â–∏–π –∫–æ–¥ –∏–∑ `admin.ejs` –∏ `cabinet.ejs`
3. –ü–æ–¥–∫–ª—é—á–µ–Ω–∞ –µ–¥–∏–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∏–∑ `public/script.js` –≤–æ –≤—Å–µ —à–∞–±–ª–æ–Ω—ã
4. –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∞ YouTube IFrame API –≤ `admin.ejs` –∏ `cabinet.ejs`
5. –£–ª—É—á—à–µ–Ω—ã CSP –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏
6. –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ FIX –≤–æ –≤—Å–µ –∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π:
- **–§–∞–π–ª–æ–≤ –∏–∑–º–µ–Ω–µ–Ω–æ**: 3 (`views/admin.ejs`, `views/cabinet.ejs`, `server.js`)
- **–°—Ç—Ä–æ–∫ —É–¥–∞–ª–µ–Ω–æ**: ~500 (–¥—É–±–ª–∏—Ä—É—é—â–∏–π –∫–æ–¥)
- **–°—Ç—Ä–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω–æ**: ~20 (–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –µ–¥–∏–Ω–æ–π –ª–æ–≥–∏–∫–∏ –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏)
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –£–ø—Ä–æ—â–µ–Ω–∏–µ –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã, –µ–¥–∏–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤–∏–¥–µ–æ-–ø–ª–µ–µ—Ä–æ–≤

### üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
- **–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å**: –í—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—É—é –ª–æ–≥–∏–∫—É
- **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å**: –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ª–æ–≥–∏–∫–µ –≤–∏–¥–µ–æ –¥–µ–ª–∞—é—Ç—Å—è –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ
- **–ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ YouTube IFrame API –∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç –æ—à–∏–±–∫—É 153
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –ú–µ–Ω—å—à–µ –¥—É–±–ª–∏—Ä—É—é—â–µ–≥–æ –∫–æ–¥–∞ = –º–µ–Ω—å—à–µ –∑–∞–≥—Ä—É–∂–∞–µ–º–æ–≥–æ JavaScript

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º

1. ‚úÖ –õ–æ–∫–∞–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–∫—Ä—ã—Ç–∏–µ –≤–∏–¥–µ–æ –Ω–∞ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö:
   - `/` (index.ejs)
   - `/admin` (admin.ejs)
   - `/cabinet` (cabinet.ejs)

2. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –≤–∏–¥–µ–æ:
   - YouTube –æ–±—ã—á–Ω—ã–µ –≤–∏–¥–µ–æ
   - YouTube Shorts
   - VK –≤–∏–¥–µ–æ
   - Instagram Reels

3. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö:
   - Desktop
   - Mobile (iOS)
   - Mobile (Android)

4. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å CSP –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ:
   - –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∑–∞–≥–æ–ª–æ–≤–∫–∏ CSP –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `origin` –ø–∞—Ä–∞–º–µ—Ç—Ä —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –¥–æ–º–µ–Ω–æ–º

---

## –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ–±—Ä–∞—Ç–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã
- –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –±–µ–∑ –ø–æ—Ç–µ—Ä—å
- –î—É–±–ª–∏—Ä—É—é—â–∏–π –∫–æ–¥ —É–¥–∞–ª—ë–Ω, –µ–¥–∏–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç

