# Тест-план для проверки исправлений системы загрузки изображений

## Цель
Проверить корректность работы системы загрузки, хранения и отображения изображений после реализации рекомендаций из аудита.

## Подготовка к тестированию

### Тестовая среда
- Локальный сервер Node.js
- Vercel staging среда
- Тестовые аккаунты (пользователь, админ)
- Тестовые изображения различных форматов и размеров

### Тестовые устройства и браузеры
- Desktop: Chrome, Firefox, Safari, Edge
- Mobile: Chrome Mobile, Safari Mobile
- Браузеры с активным Tracking Protection (Safari, Firefox с Enhanced Tracking Protection)

## Тест-кейсы

### 1. Загрузка изображений на Desktop
**Тест-кейс ID:** TC-IMG-001  
**Описание:** Создание карточки с изображениями на desktop устройстве  
**Шаги:**
1. Авторизоваться как пользователь
2. Перейти в личный кабинет
3. Выбрать "Создать карточку"
4. Загрузить 1-5 изображений (JPEG, PNG, WEBP)
5. Заполнить остальные поля
6. Отправить на модерацию
**Ожидаемый результат:** 
- Карточка создается успешно
- Изображения загружаются на Cloudinary
- Изображения отображаются корректно в карточке

### 2. Загрузка изображений на Mobile
**Тест-кейс ID:** TC-IMG-002  
**Описание:** Создание карточки с изображениями на мобильном устройстве  
**Шаги:**
1. Открыть сайт с мобильного устройства
2. Авторизоваться как пользователь
3. Перейти в личный кабинет
4. Выбрать "Создать карточку"
5. Загрузить 1-5 изображений
6. Отправить на модерацию
**Ожидаемый результат:**
- Карточка создается успешно
- Изображения загружаются (на Cloudinary или локально)
- Изображения отображаются корректно

### 3. Работа с Tracking Prevention
**Тест-кейс ID:** TC-IMG-003  
**Описание:** Проверка отображения изображений в браузерах с активным Tracking Prevention  
**Шаги:**
1. Включить Enhanced Tracking Protection в Firefox или Safari
2. Зайти на сайт
3. Просмотреть карточки с изображениями
4. Проверить отображение изображений из Cloudinary
**Ожидаемый результат:**
- Изображения отображаются корректно
- Нет блокировок со стороны Tracking Prevention
- При наличии прокси для Cloudinary URL - изображения грузятся через него

### 4. Обработка ошибок загрузки
**Тест-кейс ID:** TC-IMG-004  
**Описание:** Проверка обработки ошибок при загрузке файлов  
**Шаги:**
1. Попытаться загрузить изображение больше 5MB
2. Попытаться загрузить более 5 изображений
3. Попытаться загрузить файл недопустимого формата
4. Попытаться создать карточку без изображений (если они обязательны)
**Ожидаемый результат:**
- Пользователю отображаются понятные сообщения об ошибках
- Карточка не создается при ошибках валидации
- Нет silent fails

### 5. Редактирование карточки
**Тест-кейс ID:** TC-IMG-005  
**Описание:** Проверка редактирования карточки с сохранением и изменением изображений  
**Шаги:**
1. Создать карточку с несколькими изображениями
2. Перейти в редактирование карточки
3. Удалить одно изображение
4. Добавить новое изображение
5. Сохранить изменения
**Ожидаемый результат:**
- Удаленные изображения удаляются из хранилища
- Новые изображения загружаются
- Старые изображения сохраняются
- Карточка обновляется корректно

### 6. Удаление карточки
**Тест-кейс ID:** TC-IMG-006  
**Описание:** Проверка удаления карточки с очисткой изображений  
**Шаги:**
1. Создать карточку с изображениями
2. Удалить карточку
3. Проверить, удалены ли изображения из Cloudinary/локального хранилища
**Ожидаемый результат:**
- Карточка удаляется из базы данных
- Изображения удаляются из хранилища
- Нет "мусора" в системе хранения

### 7. Работа Cloudinary fallback
**Тест-кейс ID:** TC-IMG-007  
**Описание:** Проверка работы локального хранилища при недоступности Cloudinary  
**Шаги:**
1. Временно отключить Cloudinary (например, неверные env переменные)
2. Создать карточку с изображениями
3. Проверить сохранение изображений в локальной папке uploads
**Ожидаемый результат:**
- Изображения сохраняются локально
- Карточка создается успешно
- Изображения отображаются корректно

### 8. Работа с баннерами
**Тест-кейс ID:** TC-IMG-008  
**Описание:** Проверка загрузки и отображения баннеров  
**Шаги:**
1. Создать баннер с изображением
2. Проверить отображение баннера на главной странице
3. Проверить модерацию баннера
**Ожидаемый результат:**
- Баннер создается с изображением
- Изображение корректно отображается
- Баннер проходит модерацию

### 9. CSRF Protection
**Тест-кейс ID:** TC-IMG-009  
**Описание:** Проверка работы CSRF защиты при загрузке изображений  
**Шаги:**
1. Проверить работу на локальном сервере (с CSRF)
2. Проверить работу на Vercel (без CSRF)
3. Проверить AJAX запросы с токенами
**Ожидаемый результат:**
- На локальном сервере CSRF работает корректно
- На Vercel запросы проходят без CSRF
- Безопасность соблюдается в обоих случаях

### 10. Performance тесты
**Тест-кейс ID:** TC-IMG-010  
**Описание:** Проверка производительности при массовой загрузке  
**Шаги:**
1. Создать несколько карточек одновременно
2. Загрузить максимальное количество изображений
3. Проверить время отклика
**Ожидаемый результат:**
- Система корректно обрабатывает параллельные загрузки
- Нет падений при нагрузке
- Время отклика в пределах допустимого

## Критерии успешного прохождения тестов
- Все функциональные тесты проходят успешно
- Нет regressions в существующем функционале
- Ошибки обрабатываются корректно с понятными сообщениями
- Изображения загружаются и отображаются везде, где должны
- Работа системы не зависит от типа устройства или браузера

## Отчетность
По результатам тестирования необходимо составить отчет с:
- Перечнем пройденных тест-кейсов
- Обнаруженными багами (если есть)
- Рекомендациями по дальнейшим улучшениям
- Заключением о готовности системы к эксплуатации