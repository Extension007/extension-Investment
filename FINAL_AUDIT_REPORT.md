# –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á—ë—Ç –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è—Ö –∏ –∞—É–¥–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç–∞

## –î–∞—Ç–∞: 2024-12-19

---

## ‚úÖ 1. –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ü–ï–†–ï–ú–ï–ù–ù–û–ô `productId`

### –ü—Ä–æ–±–ª–µ–º–∞:
- –ù–∞–π–¥–µ–Ω–æ **3 –æ–±—ä—è–≤–ª–µ–Ω–∏—è** `const productId` –≤ `public/script.js`:
  1. –°—Ç—Ä–æ–∫–∞ 148: –≤–Ω—É—Ç—Ä–∏ `forEach` callback –¥–ª—è —Ä–µ–π—Ç–∏–Ω–≥–∞
  2. –°—Ç—Ä–æ–∫–∞ 967: –≤–Ω—É—Ç—Ä–∏ `addEventListener` callback –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
  3. –°—Ç—Ä–æ–∫–∞ 1430: –≤–Ω—É—Ç—Ä–∏ `addEventListener` callback –¥–ª—è —Ä–µ–π—Ç–∏–Ω–≥–∞

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:
- ‚úÖ –û–±—ä—è–≤–ª–µ–Ω–∞ **–æ–¥–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è** `let productId;` –Ω–∞ —É—Ä–æ–≤–Ω–µ `DOMContentLoaded` (—Å—Ç—Ä–æ–∫–∞ 146)
- ‚úÖ –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –º–µ—Å—Ç–∞ –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ **–ø—Ä–∏—Å–≤–æ–µ–Ω–∏–µ** `productId = ...`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ `// FIX: —É–±—Ä–∞–Ω–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ productId`

### –†–µ–∑—É–ª—å—Ç–∞—Ç:
‚úÖ **–û—à–∏–±–∫–∞ "Identifier 'productId' has already been declared" —É—Å—Ç—Ä–∞–Ω–µ–Ω–∞**

### –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ –º–µ—Å—Ç–∞:
1. **–°—Ç—Ä–æ–∫–∞ 148**: `const productId = ...` ‚Üí `productId = ...` (–≤ forEach callback)
2. **–°—Ç—Ä–æ–∫–∞ 967**: `const productId = ...` ‚Üí `productId = ...` (–≤ addEventListener callback)
3. **–°—Ç—Ä–æ–∫–∞ 1430**: `const productId = ...` ‚Üí `productId = ...` (–≤ addEventListener callback)

---

## ‚úÖ 2. –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –û–®–ò–ë–û–ö postMessage (origin mismatch)

### –ü—Ä–æ–±–ª–µ–º–∞:
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è `encodeURIComponent(window.location.origin)` –¥–ª—è `playerVars.origin`
- –í fallback —Ñ—É–Ω–∫—Ü–∏–∏ `origin` –∫–æ–¥–∏—Ä–æ–≤–∞–ª—Å—è –¥–≤–∞–∂–¥—ã

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:
- ‚úÖ **–°—Ç—Ä–æ–∫–∞ 265**: `'origin': window.location.origin` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é –±–µ–∑ `encodeURIComponent`
- ‚úÖ **–°—Ç—Ä–æ–∫–∞ 252**: –£–¥–∞–ª–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `origin` —Å `encodeURIComponent`
- ‚úÖ **–°—Ç—Ä–æ–∫–∞ 402**: –í fallback —Ñ—É–Ω–∫—Ü–∏–∏ `origin` –∫–æ–¥–∏—Ä—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ URL –ø–∞—Ä–∞–º–µ—Ç—Ä–µ (–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ)

### –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:
- `// FIX: origin –±–µ—Ä—ë—Ç—Å—è –∏–∑ window.location.origin –±–µ–∑ encodeURIComponent`
- `// FIX: origin –±–µ—Ä—ë—Ç—Å—è –∏–∑ window.location.origin (–±–µ–∑ encodeURIComponent) –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã postMessage`

### –†–µ–∑—É–ª—å—Ç–∞—Ç:
‚úÖ **–û—à–∏–±–∫–∏ postMessage origin mismatch —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã**

---

## ‚úÖ 3. –£–ù–ò–§–ò–ö–ê–¶–ò–Ø –í–ò–î–ï–û-–õ–û–ì–ò–ö–ò

### –ü—Ä–æ–≤–µ—Ä–∫–∞ `admin.ejs` –∏ `cabinet.ejs`:
- ‚úÖ **–î—É–±–ª–∏—Ä—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ —É–¥–∞–ª–µ–Ω—ã** (—Ä–∞–Ω–µ–µ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)
- ‚úÖ –í—Å–µ –≤—ã–∑–æ–≤—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ `public/script.js`
- ‚úÖ YouTube IFrame API –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –æ–¥–∏–Ω–∞–∫–æ–≤–æ –≤–æ –≤—Å–µ—Ö —à–∞–±–ª–æ–Ω–∞—Ö

### –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ:
- **`views/admin.ejs`** (—Å—Ç—Ä–æ–∫–∞ 713): –ó–∞–≥—Ä—É–∑–∫–∞ YouTube IFrame API
- **`views/cabinet.ejs`** (—Å—Ç—Ä–æ–∫–∞ 546): –ó–∞–≥—Ä—É–∑–∫–∞ YouTube IFrame API
- **`views/index.ejs`** (—Å—Ç—Ä–æ–∫–∞ 499): –ó–∞–≥—Ä—É–∑–∫–∞ YouTube IFrame API
- –í—Å–µ —Ç—Ä–∏ —Ñ–∞–π–ª–∞ –ø–æ–¥–∫–ª—é—á–∞—é—Ç `public/script.js`

### –†–µ–∑—É–ª—å—Ç–∞—Ç:
‚úÖ **–ï–¥–∏–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤–∏–¥–µ–æ-–ø–ª–µ–µ—Ä–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ**

---

## ‚úÖ 4. CSP –ù–ê–°–¢–†–û–ô–ö–ò

### –ü—Ä–æ–≤–µ—Ä–∫–∞ `server.js`:
- ‚úÖ **`scriptSrc`** —Ä–∞–∑—Ä–µ—à–∞–µ—Ç YouTube IFrame API:
  - `https://www.youtube.com`
  - `https://youtube.com`
  - `https://*.youtube.com`

- ‚úÖ **`frameSrc`** —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏:
  - YouTube: `https://www.youtube.com`, `https://youtube.com`, `https://youtu.be`, `https://*.youtube.com`, `https://www.youtube-nocookie.com`, `https://m.youtube.com`
  - VK: `https://vk.com`, `https://*.vk.com`
  - Instagram: `https://www.instagram.com`, `https://*.instagram.com`

- ‚úÖ **`connectSrc`** —Ä–∞–∑—Ä–µ—à–∞–µ—Ç Instagram oEmbed API:
  - `https://api.instagram.com`

### –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:
- `// FIX: CSP –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è –µ–¥–∏–Ω–æ–π –ª–æ–≥–∏–∫–∏ –≤–∏–¥–µ–æ-–ø–ª–µ–µ—Ä–æ–≤`
- `// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å CSP –∑–∞–≥–æ–ª–æ–≤–∫–∏ –Ω–∞ Vercel –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è`

### –†–µ–∑—É–ª—å—Ç–∞—Ç:
‚úÖ **CSP –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –¥–ª—è –≤—Å–µ—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º**

---

## üìã 5. –ê–£–î–ò–¢ –ù–ê –î–£–ë–õ–ò–†–£–Æ–©–ò–ô –ö–û–î

### 5.1. –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã—Ö–æ–¥–∞ (logout)

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:**
- `views/admin.ejs` (—Å—Ç—Ä–æ–∫–∏ 428-443)
- `views/cabinet.ejs` (—Å—Ç—Ä–æ–∫–∏ 285-300)
- `views/index.ejs` (–≤–µ—Ä–æ—è—Ç–Ω–æ)

**–ß—Ç–æ –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è:**
- –õ–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–æ—Ä–º—ã –≤—ã—Ö–æ–¥–∞
- –û–±—Ä–∞–±–æ—Ç—á–∏–∫ `logoutForm.addEventListener('submit', ...)`
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤—ã—Ö–æ–¥–∞
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤—ã—Ö–æ–¥–∞

**–ú–æ–∂–µ—Ç –ª–∏ –≤—ã–∑–≤–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã:** ‚ùå –ù–µ—Ç - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –í—ã–Ω–µ—Å—Ç–∏ –≤ `public/script.js` –∫–∞–∫ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é

---

### 5.2. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã —Å–æ–∑–¥–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:**
- `views/admin.ejs` (—Å—Ç—Ä–æ–∫–∏ 607-653)
- `views/cabinet.ejs` (—Å—Ç—Ä–æ–∫–∏ 306-358)

**–ß—Ç–æ –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (–º–∞–∫—Å–∏–º—É–º 5)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–æ–≤ (–º–∞–∫—Å–∏–º—É–º 5MB)
- –õ–æ–≥–∏–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã —á–µ—Ä–µ–∑ `fetch`
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞ –∏ –≤—ã–≤–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏–π

**–ú–æ–∂–µ—Ç –ª–∏ –≤—ã–∑–≤–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã:** ‚ùå –ù–µ—Ç - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –í—ã–Ω–µ—Å—Ç–∏ –æ–±—â—É—é –ª–æ–≥–∏–∫—É –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤ `public/script.js`

---

### 5.3. –ü—Ä–µ–≤—å—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (FileReader)

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:**
- `views/admin.ejs` (—Å—Ç—Ä–æ–∫–∏ 657-702)
- `views/cabinet.ejs` (—Å—Ç—Ä–æ–∫–∏ 405-456, 469-507)

**–ß—Ç–æ –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è:**
- –õ–æ–≥–∏–∫–∞ `FileReader` –¥–ª—è —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤
- –°–æ–∑–¥–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –ø—Ä–µ–≤—å—é
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å—Ç–∏–ª–µ–π –¥–ª—è –ø—Ä–µ–≤—å—é –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤

**–ú–æ–∂–µ—Ç –ª–∏ –≤—ã–∑–≤–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã:** ‚ùå –ù–µ—Ç - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ä–∞–∑–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ö

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –°–æ–∑–¥–∞—Ç—å —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é `createImagePreview(file, container)` –≤ `public/script.js`

---

### 5.4. –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ (modal)

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:**
- `views/admin.ejs` (—Å—Ç—Ä–æ–∫–∏ 398-407 - rejectModal)
- `views/cabinet.ejs` (–º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ –º–æ–≥—É—Ç –±—ã—Ç—å)
- `views/index.ejs` (–º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ –º–æ–≥—É—Ç –±—ã—Ç—å)

**–ß—Ç–æ –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è:**
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ HTML –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
- –õ–æ–≥–∏–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è/–∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
- –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ –∫–ª–∏–∫—É –Ω–∞ —Ñ–æ–Ω

**–ú–æ–∂–µ—Ç –ª–∏ –≤—ã–∑–≤–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã:** ‚ùå –ù–µ—Ç - –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ä–∞–∑–Ω—ã–µ –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –°–æ–∑–¥–∞—Ç—å —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –∫–ª–∞—Å—Å/—Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω

---

### 5.5. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º (confirm)

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:**
- `views/admin.ejs` (–º–Ω–æ–∂–µ—Å—Ç–≤–æ –º–µ—Å—Ç: toggle-visibility, approve, reject)
- `views/cabinet.ejs` (–º–æ–∂–µ—Ç –±—ã—Ç—å)

**–ß—Ç–æ –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ `confirm()` –ø–µ—Ä–µ–¥ –¥–µ–π—Å—Ç–≤–∏–µ–º
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
- –õ–æ–≥–∏–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ –ø–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è

**–ú–æ–∂–µ—Ç –ª–∏ –≤—ã–∑–≤–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã:** ‚ùå –ù–µ—Ç - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –°–æ–∑–¥–∞—Ç—å helper —Ñ—É–Ω–∫—Ü–∏—é `confirmAction(message, callback)`

---

### 5.6. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ fetch

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:**
- –í–æ –≤—Å–µ—Ö `.ejs` —Ñ–∞–π–ª–∞—Ö, –≥–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `fetch`

**–ß—Ç–æ –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ `res.ok`
- –ü—Ä–æ–≤–µ—Ä–∫–∞ `content-type` –¥–ª—è JSON
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å–µ—Ç–∏
- –í—ã–≤–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏–π –æ–± –æ—à–∏–±–∫–∞—Ö

**–ú–æ–∂–µ—Ç –ª–∏ –≤—ã–∑–≤–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã:** ‚ùå –ù–µ—Ç - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –°–æ–∑–¥–∞—Ç—å helper —Ñ—É–Ω–∫—Ü–∏—é `safeFetch(url, options, messageElement)`

---

## üìä –ò–¢–û–ì–û–í–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –º–µ—Å—Ç–∞:
1. ‚úÖ **`productId`**: 3 –æ–±—ä—è–≤–ª–µ–Ω–∏—è ‚Üí 1 –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
2. ‚úÖ **`origin`**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –≤ 2 –º–µ—Å—Ç–∞—Ö (YT.Player –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏)
3. ‚úÖ **–î—É–±–ª–∏—Ä—É—é—â–∏–π –∫–æ–¥ –≤–∏–¥–µ–æ**: –£–¥–∞–ª—ë–Ω –∏–∑ `admin.ejs` –∏ `cabinet.ejs`
4. ‚úÖ **CSP –Ω–∞—Å—Ç—Ä–æ–π–∫–∏**: –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏

### –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –æ—à–∏–±–æ–∫:
- ‚úÖ **–û—à–∏–±–∫–∞ "Identifier 'productId' has already been declared"** - —É—Å—Ç—Ä–∞–Ω–µ–Ω–∞
- ‚úÖ **–û—à–∏–±–∫–∏ postMessage origin mismatch** - —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã
- ‚úÖ **–î—É–±–ª–∏—Ä—É—é—â–∏–π –∫–æ–¥ –≤–∏–¥–µ–æ-–ª–æ–≥–∏–∫–∏** - —É–¥–∞–ª—ë–Ω

### –ù–∞–π–¥–µ–Ω–æ –¥—É–±–ª–∏—Ä—É—é—â–µ–≥–æ –∫–æ–¥–∞ (–±–µ–∑ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π):
1. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã—Ö–æ–¥–∞ (logout)** - 2 –º–µ—Å—Ç–∞:
   - `views/admin.ejs` (—Å—Ç—Ä–æ–∫–∏ 428-443)
   - `views/cabinet.ejs` (—Å—Ç—Ä–æ–∫–∏ 285-300)

2. **–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã —Å–æ–∑–¥–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞** - 2 –º–µ—Å—Ç–∞:
   - `views/admin.ejs` (—Å—Ç—Ä–æ–∫–∏ 607-653)
   - `views/cabinet.ejs` (—Å—Ç—Ä–æ–∫–∏ 306-358)

3. **–ü—Ä–µ–≤—å—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (FileReader)** - 7 –º–µ—Å—Ç:
   - `views/admin.ejs` (—Å—Ç—Ä–æ–∫–∏ 657-702)
   - `views/cabinet.ejs` (—Å—Ç—Ä–æ–∫–∏ 405-456, 469-507)
   - `views/edit.ejs` (—Å—Ç—Ä–æ–∫–∏ 167-168)
   - `views/products/add.ejs` (—Å—Ç—Ä–æ–∫–∏ 115-116)
   - `views/user-edit-product.ejs` (—Å—Ç—Ä–æ–∫–∏ 169-170)
   - `views/products/edit.ejs` (—Å—Ç—Ä–æ–∫–∏ 160-161)

4. **–ü—Ä–µ–≤—å—é –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã (imagePreview)** - 6 –º–µ—Å—Ç:
   - `views/cabinet.ejs` (–º–Ω–æ–∂–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫)
   - `views/edit.ejs` (—Å—Ç—Ä–æ–∫–∏ 90, 151)
   - `views/products/add.ejs` (—Å—Ç—Ä–æ–∫–∏ 65, 100)
   - `views/user-edit-product.ejs` (—Å—Ç—Ä–æ–∫–∏ 90, 153)
   - `views/products/edit.ejs` (—Å—Ç—Ä–æ–∫–∏ 86, 144)

5. **–ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞** - –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–µ—Å—Ç:
   - `views/admin.ejs` (rejectModal - —Å—Ç—Ä–æ–∫–∏ 398-407)

6. **–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º (confirm)** - –º–Ω–æ–∂–µ—Å—Ç–≤–æ –º–µ—Å—Ç:
   - `views/admin.ejs` (toggle-visibility, approve, reject)

7. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ fetch** - –º–Ω–æ–∂–µ—Å—Ç–≤–æ –º–µ—Å—Ç:
   - –í–æ –≤—Å–µ—Ö `.ejs` —Ñ–∞–π–ª–∞—Ö, –≥–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `fetch`

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –¥–∞–ª—å–Ω–µ–π—à–µ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
1. –í—ã–Ω–µ—Å—Ç–∏ –æ–±—â—É—é –ª–æ–≥–∏–∫—É —Ñ–æ—Ä–º –≤ `public/script.js`
2. –°–æ–∑–¥–∞—Ç—å —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ helper —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è:
   - –ü—Ä–µ–≤—å—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
   - –ú–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
   - –û–±—Ä–∞–±–æ—Ç–∫–∏ fetch —Å –æ—à–∏–±–∫–∞–º–∏
   - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏–π

---

## üîç –ü–†–û–í–ï–†–ö–ê –ü–ï–†–ï–î –î–ï–ü–õ–û–ï–ú

1. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –≤–∏–¥–µ–æ-–ø–ª–µ–µ—Ä–æ–≤ –Ω–∞ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö
2. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ—à–∏–±–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª–∏ (productId, origin)
3. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å CSP –∑–∞–≥–æ–ª–æ–≤–∫–∏ –Ω–∞ Vercel –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è
4. ‚úÖ –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ `origin` —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –¥–æ–º–µ–Ω–æ–º –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

---

## üìù –ü–†–ò–ú–ï–ß–ê–ù–ò–Ø

- –í—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ–±—Ä–∞—Ç–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã
- –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –±–µ–∑ –ø–æ—Ç–µ—Ä—å
- –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ FIX –¥–ª—è –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –î—É–±–ª–∏—Ä—É—é—â–∏–π –∫–æ–¥ –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω, –Ω–æ –Ω–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω (—Ç–æ–ª—å–∫–æ –æ—Ç—á—ë—Ç)

